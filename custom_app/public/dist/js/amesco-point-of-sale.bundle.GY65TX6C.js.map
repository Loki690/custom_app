{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/node_modules/onscan.js/onscan.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_item_selector.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_item_cart.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_item_details.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_number_pad.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_payment.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_past_order_list.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_past_order_summary.js", "../../../../../apps/custom_app/custom_app/customapp/page/amesco_point_of_sale/amesco_pos_controller.js"],
  "sourcesContent": ["/*\n * onScan.js - scan-events for hardware barcodes scanners in javascript\n */\n;(function (global, factory) {\n    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n    typeof define === 'function' && define.amd ? define(factory()) :\n    global.onScan = factory()\n}(this, (function () {\n\tvar onScan = {\t\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tattachTo: function(oDomElement, oOptions) {\n\t\n\t\t\tif(oDomElement.scannerDetectionData !== undefined){\n\t\t\t\tthrow new Error(\"onScan.js is already initialized for DOM element \" + oDomElement);\n\t\t\t}\n\t\n\t\t\tvar oDefaults = {\n\t\t\t\tonScan: function(sScanned, iQty){}, // Callback after detection of a successfull scanning:  function(){sScancode, iCount)}()\n\t\t\t\tonScanError: function(oDebug){}, // Callback after detection of a unsuccessfull scanning (scanned string in parameter)\n\t\t\t\tonKeyProcess: function(sChar, oEvent){}, // Callback after receiving and processing a char (scanned char in parameter)\n\t\t\t\tonKeyDetect: function(iKeyCode, oEvent){}, // Callback after detecting a keyDown (key char in parameter) - in contrast to onKeyProcess, this fires for non-character keys like tab, arrows, etc. too!\n\t\t\t\tonPaste: function(sPasted, oEvent){}, // Callback after receiving a value on paste, no matter if it is a valid code or not\n\t\t\t\tkeyCodeMapper: function(oEvent) {return onScan.decodeKeyEvent(oEvent)}, // Custom function to decode a keydown event into a character. Must return decoded character or NULL if the given event should not be processed.\n\t\t\t\tonScanButtonLongPress: function(){}, // Callback after detection of a successfull scan while the scan button was pressed and held down\n\t\t\t\tscanButtonKeyCode:false, // Key code of the scanner hardware button (if the scanner button a acts as a key itself) \n\t\t\t\tscanButtonLongPressTime:500, // How long (ms) the hardware button should be pressed, until a callback gets executed\n\t\t\t\ttimeBeforeScanTest:100, // Wait duration (ms) after keypress event to check if scanning is finished\n\t\t\t\tavgTimeByChar:30, // Average time (ms) between 2 chars. Used to do difference between keyboard typing and scanning\n\t\t\t\tminLength:6, // Minimum length for a scanning\n\t\t\t\tsuffixKeyCodes:[9,13], // Chars to remove and means end of scanning\n\t\t\t\tprefixKeyCodes:[], // Chars to remove and means start of scanning\n\t\t\t\tignoreIfFocusOn:false, // do not handle scans if the currently focused element matches this selector or object\n\t\t\t\tstopPropagation:false, // Stop immediate propagation on keypress event\n\t\t\t\tpreventDefault:false, // Prevent default action on keypress event\n\t\t\t\tcaptureEvents:false, // Get the events before any listeners deeper in the DOM\n\t\t\t\treactToKeydown:true, // look for scan input in keyboard events\n\t\t\t\treactToPaste:false, // look for scan input in paste events\n\t\t\t\tsingleScanQty: 1, // Quantity of Items put out to onScan in a single scan\n\t\t\t}\n\t\t\t\t\t\t\t\t\t\n\t\t\toOptions = this._mergeOptions(oDefaults, oOptions);\n\t\n\t\t\t// initializing options and variables on DomElement\n\t\t\toDomElement.scannerDetectionData = {\n\t\t\t\t\toptions: oOptions,\n\t\t\t\t\tvars:{\n\t\t\t\t\t\tfirstCharTime: 0,\n\t\t\t\t\t\tlastCharTime: 0,\n\t\t\t\t\t\taccumulatedString: '',\n\t\t\t\t\t\ttestTimer: false,\n\t\t\t\t\t\tlongPressTimeStart: 0,\n\t\t\t\t\t\tlongPressed: false\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t};\n\t\t\t\n\t\t\t// initializing handlers (based on settings)\n\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp, oOptions.captureEvents);\n\t\t\t}\n\t\t\tif (oOptions.reactToKeydown === true || oOptions.scanButtonKeyCode !== false){\t\n\t\t\t\toDomElement.addEventListener(\"keydown\", this._handleKeyDown, oOptions.captureEvents);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\tdetachFrom: function(oDomElement) {\n\t\t\t// detaching all used events\n\t\t\tif (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t}\n\t\t\tif (oDomElement.scannerDetectionData.options.scanButtonKeyCode !== false){\n\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t}\n\t\t\toDomElement.removeEventListener(\"keydown\", this._handleKeyDown);\n\t\t\t\n\t\t\t// clearing data off DomElement\n\t\t\toDomElement.scannerDetectionData = undefined; \n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @return Object\n\t\t */\n\t\tgetOptions: function(oDomElement){\n\t\t\treturn oDomElement.scannerDetectionData.options;\t\t\t\n\t\t},\n\t\n\t\t/**\n\t\t * \n\t\t * @param DomElement oDomElement\n\t\t * @param Object oOptions\n\t\t * @return self\n\t\t */\n\t\tsetOptions: function(oDomElement, oOptions){\n\t\t\t// check if some handlers need to be changed based on possible option changes\n\t\t\tswitch (oDomElement.scannerDetectionData.options.reactToPaste){\n\t\t\t\tcase true: \n\t\t\t\t\tif (oOptions.reactToPaste === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.reactToPaste === true){\n\t\t\t\t\t\toDomElement.addEventListener(\"paste\", this._handlePaste);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tswitch (oDomElement.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tcase false:\n\t\t\t\t\tif (oOptions.scanButtonKeyCode !== false){\n\t\t\t\t\t\toDomElement.addEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault: \n\t\t\t\t\tif (oOptions.scanButtonKeyCode === false){\n\t\t\t\t\t\toDomElement.removeEventListener(\"keyup\", this._handleKeyUp);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\t// merge old and new options\n\t\t\toDomElement.scannerDetectionData.options = this._mergeOptions(oDomElement.scannerDetectionData.options, oOptions);\n\t\t\n\t\t\t// reinitiallize\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Transforms key codes into characters.\n\t\t * \n\t\t * By default, only the follwing key codes are taken into account\n\t\t * - 48-90 (letters and regular numbers)\n\t\t * - 96-105 (numeric keypad numbers)\n\t\t * - 106-111 (numeric keypad operations)\n\t\t * \n\t\t * All other keys will yield empty strings!\n\t\t * \n\t\t * The above keycodes will be decoded using the KeyboardEvent.key property on modern\n\t\t * browsers. On older browsers the method will fall back to String.fromCharCode()\n\t\t * putting the result to upper/lower case depending on KeyboardEvent.shiftKey if\n\t\t * it is set.\n\t\t * \n\t\t * @param KeyboardEvent oEvent\n\t\t * @return string\n\t\t */\n\t\tdecodeKeyEvent : function (oEvent) {\n\t\t\tvar iCode = this._getNormalizedKeyNum(oEvent);\n\t\t\tswitch (true) {\n\t\t\t\tcase iCode >= 48 && iCode <= 90: // numbers and letters\n\t\t\t\tcase iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n\t\t\t\t\tif (oEvent.key !== undefined && oEvent.key !== '') {\n\t\t\t\t\t\treturn oEvent.key;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tvar sDecoded = String.fromCharCode(iCode);\n\t\t\t\t\tswitch (oEvent.shiftKey) {\n\t\t\t\t\t\tcase false: sDecoded = sDecoded.toLowerCase(); break;\n\t\t\t\t\t\tcase true: sDecoded = sDecoded.toUpperCase(); break;\n\t\t\t\t\t}\n\t\t\t\t\treturn sDecoded;\n\t\t\t\tcase iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n\t\t\t\t\treturn 0+(iCode-96);\n\t\t\t}\n\t\t\treturn '';\n\t\t},\n\t\t\n\t\t/**\n\t\t * Simulates a scan of the provided code.\n\t     *\n\t\t * The scan code can be defined as\n\t\t * - a string - in this case no keyCode decoding is done and the code is merely validated\n\t\t * against constraints like minLenght, etc.\n\t\t * - an array of keyCodes (e.g. `[70,71,80]`) - will produce `keydown` events with corresponding\n\t\t * `keyCode` properties. NOTE: these events will have empty `key` properties, so decoding may\n\t\t * yield different results than with native events.\n\t\t * - an array of objects (e.g. `[{keyCode: 70, key: \"F\", shiftKey: true}, {keyCode: 71, key: \"g\"}]`) -\n\t\t * this way almost any event can be simulated, but it's a lot of work to do.\n\t\t *\n\t\t * @param DomElement oDomElement\n\t\t * @param string|array mStringOrArray\n\t\t * @return self\n\t\t */\n\t\tsimulate: function(oDomElement, mStringOrArray){\n\t\t\tthis._reinitialize(oDomElement);\n\t\t\tif (Array.isArray(mStringOrArray)){\n\t\t\t\tmStringOrArray.forEach(function(mKey){\n\t\t\t\t\tvar oEventProps = {};\n\t\t\t\t\tif( (typeof mKey === \"object\" || typeof mKey === 'function') && (mKey !== null) ) {\n\t\t\t\t\t\toEventProps = mKey;\n\t\t\t\t\t} else {\n\t\t\t\t\t\toEventProps.keyCode = parseInt(mKey);\n\t\t\t\t\t}\n\t\t\t\t\tvar oEvent = new KeyboardEvent('keydown', oEventProps);\n\t\t\t\t\tdocument.dispatchEvent(oEvent);\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tthis._validateScanCode(oDomElement, mStringOrArray);\n\t\t\t}\n\t\t\treturn this;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t\t * @return void\n\t\t */\n\t\t_reinitialize: function(oDomElement){\n\t\t\tvar oVars = oDomElement.scannerDetectionData.vars;\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\toVars.accumulatedString = '';\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param DomElement oDomElement\n\t     * @return boolean\n\t\t */\n\t\t_isFocusOnIgnoredElement: function(oDomElement){\n\t\t\t\n\t\t\tvar ignoreSelectors = oDomElement.scannerDetectionData.options.ignoreIfFocusOn;\n\t\n\t        if(!ignoreSelectors){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\n\t\t\tvar oFocused = document.activeElement;\n\t\t\t\n\t\t\t// checks if ignored element is an array, and if so it checks if one of the elements of it is an active one\n\t\t\tif (Array.isArray(ignoreSelectors)){\n\t\t\t\tfor(var i=0; i<ignoreSelectors.length; i++){\n\t\t\t\t\tif(oFocused.matches(ignoreSelectors[i]) === true){\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t// if the option consists of an single element, it only checks this one\n\t\t\t} else if (oFocused.matches(ignoreSelectors)){\n\t\t\t\treturn true;\t\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t// if the active element is not listed in the ignoreIfFocusOn option, return false\n\t\t    return false;\n\t    },\n\t\t\n\t    /**\n\t     * Validates the scan code accumulated by the given DOM element and fires the respective events.\n\t     * \n\t     * @private\n\t     * @param DomElement oDomElement\n\t     * @return boolean\n\t     */\n\t\t_validateScanCode: function(oDomElement, sScanCode){\n\t\t\tvar oScannerData = oDomElement.scannerDetectionData;\t\t\t\n\t\t\tvar oOptions = oScannerData.options;\n\t\t\tvar iSingleScanQty = oScannerData.options.singleScanQty;\n\t\t\tvar iFirstCharTime = oScannerData.vars.firstCharTime;\n\t\t\tvar iLastCharTime = oScannerData.vars.lastCharTime;\n\t\t\tvar oScanError = {};\n\t        var oEvent;\n\t        \n\t\t\tswitch(true){\n\t\t\t\t\n\t\t\t\t// detect codes that are too short\n\t\t\t\tcase (sScanCode.length < oOptions.minLength):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code is shorter then minimal length\"\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// detect codes that were entered too slow\t\n\t\t\t\tcase ((iLastCharTime - iFirstCharTime) > (sScanCode.length * oOptions.avgTimeByChar)):\n\t\t\t\t\toScanError = {\n\t\t\t\t\t\tmessage: \"Receieved code was not entered in time\"\n\t\t\t\t\t};\t\t\t\t\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// if a code was not filtered out earlier it is valid\t\n\t\t\t\tdefault:\n\t\t\t\t\toOptions.onScan.call(oDomElement, sScanCode, iSingleScanQty);\n\t\t\t\t\toEvent = new CustomEvent(\n\t\t\t\t\t\t'scan',\n\t\t\t\t\t\t{\t\n\t\t\t\t\t\t\tdetail: { \n\t\t\t\t\t\t\t\tscanCode: sScanCode,\n\t\t\t\t\t\t\t\tqty: iSingleScanQty\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\t\tonScan._reinitialize(oDomElement);\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\t// If an error occurred (otherwise the method would return earlier) create an object for errordetection\n\t\t\toScanError.scanCode = sScanCode;\n\t\t\toScanError.scanDuration = iLastCharTime - iFirstCharTime;\n\t\t\toScanError.avgTimeByChar = oOptions.avgTimeByChar;\n\t\t\toScanError.minLength = oOptions.minLength;\n\t\t\t\n\t\t\toOptions.onScanError.call(oDomElement, oScanError);\n\t\t\t\n\t\t\toEvent = new CustomEvent(\n\t\t\t\t'scanError', \n\t\t\t\t{detail: oScanError}\n\t\t\t);\n\t\t\toDomElement.dispatchEvent(oEvent);\n\t\t\t\n\t\t\tonScan._reinitialize(oDomElement);\n\t\t\treturn false;\n\t    },\n\t\n\t    /**\n\t     * @private\n\t     * @param Object oDefaults\n\t     * @param Object oOptions\n\t     * @return Object\n\t     */\n\t\t_mergeOptions: function(oDefaults, oOptions){\n\t\t\tvar oExtended = {};\n\t\t\tvar prop;\n\t\t\tfor (prop in oDefaults){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oDefaults, prop)){\n\t\t\t\t\toExtended[prop] = oDefaults[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\tfor (prop in oOptions){\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(oOptions, prop)){\n\t\t\t\t\toExtended[prop] = oOptions[prop];\n\t\t\t\t}\n\t\t\t}\t\t\t\n\t\t\treturn oExtended;\n\t\t},\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return int\n\t\t * @see https://www.w3schools.com/jsref/event_key_keycode.asp\n\t\t */\n\t\t_getNormalizedKeyNum: function(e){\n\t\t\treturn e.which || e.keyCode;\n\t\t},\n\t\n\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyDown: function(e){\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar bScanFinished = false;\n\t\t\t\n\t\t\tif (oOptions.onKeyDetect.call(this, iKeyCode, e) === false) {\n\t\t\t\treturn;\n\t\t\t}\t\t\n\t\t\t\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\t\t\t\n\t        // If it's just the button of the scanner, ignore it and wait for the real input\n\t\t    if(oOptions.scanButtonKeyCode !== false && iKeyCode==oOptions.scanButtonKeyCode) {\n\t\t\t\t\n\t\t\t\t// if the button was first pressed, start a timeout for the callback, which gets interrupted if the scanbutton gets released\n\t\t\t\tif (!oVars.longPressed){\n\t\t\t\t\toVars.longPressTimer = setTimeout( oOptions.onScanButtonLongPress, oOptions.scanButtonLongPressTime, this);\n\t\t\t\t\toVars.longPressed = true;\n\t\t\t\t}\n\t\n\t\t\t\treturn;\n\t        }\n\t\t\t\n\t\t\tswitch(true){\n\t\t\t\t// If it's not the first character and we encounter a terminating character, trigger scan process\n\t\t\t\tcase (oVars.firstCharTime && oOptions.suffixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=true;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// If it's the first character and we encountered one of the starting characters, don't process the scan\t\n\t\t\t\tcase (!oVars.firstCharTime && oOptions.prefixKeyCodes.indexOf(iKeyCode)!==-1):\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t// Otherwise, just add the character to the scan string we're building\t\n\t\t\t\tdefault:\n\t\t\t\t\tvar character = oOptions.keyCodeMapper.call(this, e);\n\t\t\t\t\tif (character === null){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\toVars.accumulatedString += character;\n\t\t\t\t\t\n\t\t\t\t\tif (oOptions.preventDefault) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tbScanFinished=false;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t        \n\t\t\tif(!oVars.firstCharTime){\n\t\t\t\toVars.firstCharTime=Date.now();\n\t\t\t}\n\t\t\t\n\t\t\toVars.lastCharTime=Date.now();\n\t\n\t\t\tif(oVars.testTimer){ \n\t\t\t\tclearTimeout(oVars.testTimer);\n\t\t\t}\n\t\t\t\n\t\t\tif(bScanFinished){\n\t\t\t\tonScan._validateScanCode(this, oVars.accumulatedString);\n\t\t\t\toVars.testTimer=false;\n\t\t\t} else {\n\t\t\t\toVars.testTimer=setTimeout(onScan._validateScanCode, oOptions.timeBeforeScanTest, this, oVars.accumulatedString);\n\t\t\t}\n\t\n\t\t\toOptions.onKeyProcess.call(this, character, e);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param Event e\n\t\t * @return void\n\t\t */\n\t\t_handlePaste: function(e){\n\t\n\t\t\tvar oOptions = this.scannerDetectionData.options;\n\t\t\tvar oVars = this.scannerDetectionData.vars;\n\t\t\tvar sPasteString = (event.clipboardData || window.clipboardData).getData('text');\n\t\t\t\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\te.preventDefault();\n\n\t\t\tif (oOptions.stopPropagation) {\n\t\t\t\te.stopImmediatePropagation();\n\t\t\t}\n\t\t\t\t\t\t\n\t\t\toOptions.onPaste.call(this, sPasteString, event);\n\t\t\t\n\t\t\toVars.firstCharTime = 0;\n\t\t\toVars.lastCharTime = 0;\n\t\t\t\n\t\t\t// validate the string\n\t\t\tonScan._validateScanCode(this, sPasteString);\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * @param KeyboardEvent e\n\t\t * @return void\n\t\t */\n\t\t_handleKeyUp: function(e){\n\t\t\t// if the focus is on an ignored element, abort\n\t\t\tif (onScan._isFocusOnIgnoredElement(this)){\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tvar iKeyCode = onScan._getNormalizedKeyNum(e);\n\t\t\t\n\t\t\t// if hardware key is not being pressed anymore stop the timeout and reset\n\t\t\tif (iKeyCode == this.scannerDetectionData.options.scanButtonKeyCode){\n\t\t\t\tclearTimeout(this.scannerDetectionData.vars.longPressTimer);\n\t\t\t\tthis.scannerDetectionData.vars.longPressed = false;\n\t\t\t}\n\t\t\treturn;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE the scanner is currently in the middle of a scan sequence.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisScanInProgressFor: function(oDomElement) {\n\t\t\treturn oDomElement.scannerDetectionData.vars.firstCharTime > 0;\n\t\t},\n\t\t\n\t\t/**\n\t\t * Returns TRUE if onScan is attached to the given DOM element and FALSE otherwise.\n\t\t * \n\t\t * @param DomElement\n\t\t * @return boolean\n\t\t */\n\t\tisAttachedTo: function(oDomElement) {\n\t\t\treturn (oDomElement.scannerDetectionData !== undefined);\n\t\t}\n\t};\n\t\n\treturn onScan;\n})));", "import onScan from \"onscan.js\";\ncustom_app.PointOfSale.ItemSelector = class {\n    constructor({ frm, wrapper, events, pos_profile, settings }) {\n        this.wrapper = wrapper;\n        this.events = events;\n        this.pos_profile = pos_profile;\n        this.hide_images = settings.hide_images;\n        this.auto_add_item = settings.auto_add_item_to_cart;\n\n        this.init_component();\n    }\n\n    init_component() {\n        this.prepare_dom();\n        this.load_items_data();\n        this.make_search_bar();\n        this.bind_events();\n        this.attach_shortcuts();\n\t\tthis.inject_css(); \n    }\n\t//For highlight items \n\tinject_css() {\n\t\tconst css = `\n\t\t\t.highlight {\n\t\t\t\tbackground-color: #0289f7;\n                color: white;\n                font-weight: bold;\n\t\t\t}\n            .text{\n                font-size: 1em;\n                font-weight: semi-bold;\n            }\n            .text-description{\n                font-size: 1em;\n                font-weight: semi-bold;\n            }\n            .quantity-field{\n                width: 1rem;\n                height: 10rem;\n            }\n            .custom-quantity-field {\n                width: 200px; /* Adjust the width as needed */\n            }\n\t\t`;\n\t\tconst style = document.createElement('style');\n\t\tstyle.type = 'text/css';\n\t\tif (style.styleSheet) {\n\t\t\tstyle.styleSheet.cssText = css;\n\t\t} else {\n\t\t\tstyle.appendChild(document.createTextNode(css));\n\t\t}\n\t\tdocument.head.appendChild(style);\n\t}\n\n    \n    prepare_dom() {\n        const selectedWarehouse = localStorage.getItem('selected_warehouse');\n        this.wrapper.append(\n            `<section class=\"items-selector\" style=\"margin-top:0rem; grid-column: span 4 / span 4;\">\n                <div class=\"filter-section\" style=\"display: flex; align-items: center; gap: 10px;\">\n                    <div class=\"label\" style=\"flex: 1;\">\n                        ${__(\"All Items\")} ${selectedWarehouse ? selectedWarehouse : \"\"}\n                    </div>\n                    <div class=\"search-field\" style=\"flex: 2;\">\n                        <input type=\"text\" placeholder=\"Search by item code, serial number or barcode\" style=\"width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;\">\n                    </div>\n                    <div class=\"item-group-field\" style=\"flex: 1;\">\n                        <input type=\"text\" placeholder=\"Select item group\" style=\"width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;\">\n                    </div>\n                </div>\n                <div class=\"table-responsive\">\n                    <table class=\"table items-table\">\n                        <thead style=\"position: sticky; top: 0; background-color: #fff; z-index: 1; font-size:11px;\">\n                            <tr>\n                                <th>Item Code</th>\n                                <th>Name</th>\n                                <th>Generic Name</th>\n                                <th>Vat Type</th>\n                                <th>Price</th>\n                                <th>UOM</th>\n                                <th>QOH</th>\n                            </tr>\n                        </thead>\n                        <tbody class=\"items-container\"></tbody>\n                    </table>\n                </div>\n            </section>`\n        );\n    \n        this.$component = this.wrapper.find(\".items-selector\");\n        this.$items_container = this.$component.find(\".items-container\");\n    }\n    \n\n    async load_items_data() {\n        if (!this.item_group) {\n            const res = await frappe.db.get_value(\"Item Group\", { lft: 1, is_group: 1 }, \"name\");\n            this.parent_item_group = res.message.name;\n        }\n        if (!this.price_list) {\n            const res = await frappe.db.get_value(\"POS Profile\", this.pos_profile, \"selling_price_list\");\n            this.price_list = res.message.selling_price_list;\n        }\n    \n        // Set the UOM to PC\n        this.selected_uom = \"PC\";\n        if (this.item_uom) {\n            this.item_uom.set_value(\"PC\");\n            this.item_uom.refresh();\n        }\n    \n        // Retrieve and render items immediately after setting the values\n        const { message } = await this.get_items({});\n        this.render_item_list(message.items);\n    \n        // Trigger the filter function to apply the UOM filter\n        this.filter_items({ uom: this.selected_uom });\n\n\n    }\n\n    get_items({ start = 0, page_length = 20, search_term = \"\" }) {\n        const doc = this.events.get_frm().doc;\n    \n        // Use fallback default values\n        const price_list = (doc && doc.selling_price_list) || this.price_list || 'default_price_list'; // Adjust default value as needed\n        let item_group = (doc && doc.item_group) || this.item_group || 'default_item_group'; // Adjust default value as needed\n    \n        // Get the selected warehouse from local storage\n        \n\n        const selected_warehouse = localStorage.getItem('selected_warehouse');\n    \n        // Validate item_group and price_list to ensure they are not empty\n        if (!price_list) {\n            console.error(\"Price list is required but missing.\");\n            // Optionally: Show a message to the user without triggering a popup\n            frappe.msgprint({\n                title: __('Error'),\n                message: __('Price list is required but missing.'),\n                indicator: 'red'\n            });\n            return Promise.reject(new Error(\"Price list is required but missing.\"));\n        }\n    \n        if (!item_group) {\n            console.error(\"Item group is required but missing.\");\n            // Optionally: Show a message to the user without triggering a popup\n            frappe.msgprint({\n                title: __('Error'),\n                message: __('Item group is required but missing.'),\n                indicator: 'red'\n            });\n            return Promise.reject(new Error(\"Item group is required but missing.\"));\n        }\n\n        // Make the API call with the validated parameters\n        return frappe.call({\n            method: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.get_items\",\n            freeze: true,\n            args: {\n                start,\n                page_length,\n                price_list,\n                item_group,\n                search_term,\n                pos_profile: this.pos_profile,\n                selected_warehouse\n            },\n        });\n    }\n\n\n\n   \t//Camille\n       render_item_list(items) {\n        // Clear the current items in the container\n        this.$items_container.html(\"\");\n        \n        // Set the class property items to the provided items\n        this.items = items;\n    \n        // Render each item and append it to the container\n        items.forEach((item) => {\n            const item_html = this.get_item_html(item);\n            this.$items_container.append(item_html);\n        });\n    \n        // Set highlighted_row_index to -1 to ensure no item is highlighted by default\n        this.highlighted_row_index = -1;\n    \n        // Ensure no item is highlighted\n        this.highlight_row(this.highlighted_row_index);\n    \n        // Log the items to the console for debugging\n        // console.log(\"Rendered Items: \", items);\n    }\n\n    get_item_html(item) {\n        const me = this;\n\n        const { item_code, item_image, serial_no, batch_no, barcode, actual_qty, uom, price_list_rate, description, latest_expiry_date, batch_number, custom_is_vatable, custom_generic_name, item_group } = item;\n        const precision = flt(price_list_rate, 2) % 1 != 0 ? 2 : 0;\n        let indicator_color;\n        let qty_to_display = actual_qty;\n\n        // console.log(\"Actual QTY \", qty_to_display)\n\n        if (uom !== \"PC\") {\n            return \"\"; // Skip rendering if UOM is not 'PC'\n        }\n\n\n        if (item.is_stock_item) {\n            indicator_color = actual_qty > 10 ? \"green\" : actual_qty <= 0 ? \"red\" : \"orange\";\n\n            // if (Math.round(qty_to_display) > 999) {\n            //     qty_to_display = Math.round(qty_to_display) / 1000;\n            //     qty_to_display = qty_to_display.toFixed(1) + \"K\";\n            // }\n\n        } else {\n            indicator_color = \"\";\n            qty_to_display = \"\";\n        }\n        const tax_rate = 0.12;\n\t\tconst no_vat = price_list_rate / (1 + tax_rate);\n\n\n        const item_description = description ? description : \"Description not available\";\n\n        return `<tr class=\"item-wrapper\" style=\"border-bottom: 1px solid #ddd; font-size: 12px;\" \n        onmouseover=\"this.style.backgroundColor='#0289f7'; this.style.color='white'; this.style.fontWeight='bold';\"\n        onmouseout=\"this.style.backgroundColor=''; this.style.color=''; this.style.fontWeight='';\"\n            data-item-code=\"${escape(item_code)}\" data-serial-no=\"${escape(serial_no)}\"\n            data-batch-no=\"${escape(batch_no)}\" data-uom=\"${escape(uom)}\"\n            data-rate=\"${escape(price_list_rate || 0)}\" data-description=\"${escape(item_description)}\" data-qty=\"${qty_to_display}\">\n            <td class=\"item-code\" style=\" width: 1rem;\">${item_code}</td> \n             <td class=\"item-name\" style=\"width: 15rem; white-space: normal; overflow: hidden; text-overflow: ellipsis;\">${item.item_name}</td>\n            <td class=\"item-name\" style=\"width: 8rem; white-space: normal; overflow: hidden; text-overflow: ellipsis;\">${custom_generic_name ? custom_generic_name : ''}</td>\n            <td class=\"item-vat\" style=\" width: 10%;\">${custom_is_vatable == 0 ? \"VAT-Exempt\" : \"VATable\"}</td>\n            <td class=\"item-rate\" style=\" width:8%;\">${format_currency(price_list_rate, item.currency)}</td>\n            <td class=\"item-uom\" style=\" width: 5%;\">${uom}</td>\n            <td class=\"item-qty\" style=\" width: 8%;\"><span class=\"indicator-pill whitespace-nowrap ${indicator_color}\">${actual_qty}</span></td>\n        </tr>`;\n    }\n\n    handle_broken_image($img) {\n        const item_abbr = $($img).attr(\"alt\");\n        $($img).parent().replaceWith(`<div class=\"item-display abbr\">${item_abbr}</div>`);\n    }\n    make_search_bar() {\n\t\tconst me = this;\n\t\tconst doc = me.events.get_frm().doc;\n\t\tthis.$component.find(\".search-field\").html(\"\");\n\t\tthis.$component.find(\".item-group-field\").html(\"\");\n        // this.$component.find(\".item-uoms\").html(\"\");\n\t\t//branch field\n\t\t// this.$component.find(\".branch-field\").html(\"\");\n\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Search\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\"Search by item code, serial number, barcode, generic name or description\"),\n\t\t\t},\n\t\t\tparent: this.$component.find(\".search-field\"),\n\t\t\trender_input: true,\n\t\t});\n\n        this.search_field.$input.on('input', () => {\n            let value = this.search_field.get_value().trim(); // Get and trim the input value\n            // if (!value) {\n            //     // If the value is empty, call load_items_data\n            //     this.load_items_data();\n            // }\n        });\n\n\t\tthis.item_group_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Item Group\"),\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Item Group\",\n\t\t\t\tplaceholder: __(\"Select item group\"),\n\t\t\t\tonchange: function () {\n\t\t\t\t\tme.item_group = this.value;\n\t\t\t\t\t!me.item_group && (me.item_group = me.parent_item_group);\n\t\t\t\t\tme.filter_items();\n\t\t\t\t},\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tquery: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.item_group_query\",\n\t\t\t\t\t\tfilters: {\n\t\t\t\t\t\t\tpos_profile: doc ? doc.pos_profile : \"\",\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find(\".item-group-field\"),\n\t\t\trender_input: true,\n\t\t});\n\n        this.item_group_field.$input.on('input', () => {\n            let value = this.item_group_field.get_value().trim(); // Get and trim the input value\n            // if (!value) {\n            //     // If the value is empty, call load_items_data\n            //     this.load_items_data();\n            // }\n        });\n\n\n        // this.item_uom = frappe.ui.form.make_control({\n        //     df: {\n        //         label: __(\"UOM\"),\n        //         fieldtype: \"Link\",\n        //         options: \"UOM\",\n        //         placeholder: __(\"Select UOM\"),\n        //         onchange: function () {\n        //             me.selected_uom = this.value;\n        //             me.filter_items({ uom: me.selected_uom });\n        //         },\n        //     },\n        //     parent: this.$component.find(\".item-uoms\"),\n        //     render_input: true,\n        // });\n\n     \n\n        // // this.item_uom.set_value(\"PC\");\n        // this.item_uom.refresh();\n       \n\n        // this.item_uom.toggle_label(false);\n\t\tthis.search_field.toggle_label(false);\n\t\tthis.item_group_field.toggle_label(false);\n\n\t\tthis.attach_clear_btn();\n\t}\n\n    attach_clear_btn() {\n\t\tthis.search_field.$wrapper.find(\".control-input\").append(\n\t\t\t`<span class=\"link-btn\" style=\"top: 2px;\">\n\t\t\t\t<a class=\"btn-open no-decoration\" title=\"${__(\"Clear\")}\">\n\t\t\t\t\t${frappe.utils.icon(\"close\", \"sm\")}\n\t\t\t\t</a>\n\t\t\t</span>`\n\t\t);\n\n\t\tthis.$clear_search_btn = this.search_field.$wrapper.find(\".link-btn\");\n\n\t\tthis.$clear_search_btn.on(\"click\", \"a\", () => {\n\t\t\tthis.set_search_value(\"\");\n\t\t\tthis.search_field.set_focus();\n            // this.load_items_data();\n\t\t});\n\t}\n\n    set_search_value(value) {\n        $(this.search_field.$input[0]).val(value).trigger(\"input\");\n    }\n    \n    \n    bind_events() {\n        const me = this;\n        window.onScan = onScan;\n    \n        onScan.decodeKeyEvent = function(oEvent) {\n            var iCode = this._getNormalizedKeyNum(oEvent);\n            switch (true) {\n                case iCode >= 48 && iCode <= 90: // numbers and letters\n                case iCode >= 106 && iCode <= 111: // operations on numeric keypad (+, -, etc.)\n                case (iCode >= 160 && iCode <= 164) || iCode == 170: // ^ ! # $ *\n                case iCode >= 186 && iCode <= 194: // (; = , - . / `)\n                case iCode >= 219 && iCode <= 222: // ([ \\ ] ')\n                case iCode == 32: // spacebar\n                    if (oEvent.key !== undefined && oEvent.key !== \"\") {\n                        return oEvent.key;\n                    }\n    \n                    var sDecoded = String.fromCharCode(iCode);\n                    switch (oEvent.shiftKey) {\n                        case false:\n                            sDecoded = sDecoded.toLowerCase();\n                            break;\n                        case true:\n                            sDecoded = sDecoded.toUpperCase();\n                            break;\n                    }\n                    return sDecoded;\n                case iCode >= 96 && iCode <= 105: // numbers on numeric keypad\n                    return 0 + (iCode - 96);\n            }\n            return \"\";\n        };\n    \n        onScan.attachTo(document, {\n            onScan: (sScancode) => {\n                if (this.search_field && this.$component.is(\":visible\")) {\n                    this.search_field.set_focus();\n                    this.set_search_value(sScancode);\n                    this.barcode_scanned = true;\n                }\n            },\n        });\n\n\n\n        let selectedUOM;\n        this.$component.on(\"click\", \".item-wrapper\", async function () {\n            const $item = $(this);\n            me.selectedItem = $item;\n            const item_code = unescape($item.attr(\"data-item-code\"));\n            const uom = unescape($item.attr(\"data-uom\"));\n            const rate = parseFloat(unescape($item.attr(\"data-rate\")));\n            const description = unescape($item.attr(\"data-description\"));\n            const qty = parseFloat(unescape($item.attr(\"data-qty\")));\n            const pos_profile = me.events.get_pos_profile();\n\n            // Debugging logs\n            // console.log(\"Item Clicked:\", item_code, uom, rate, description, qty);\n\n            frappe.call({\n                method: 'custom_app.customapp.page.packing_list.packing_list.get_item_uom_prices',\n                args: {\n                    item_code: item_code\n                },\n                callback: function (response) {\n                    if (response.message) {\n                        const uomPrices = response.message.uom_prices;\n                        // console.log(\"UOM Prices:\", uomPrices);\n\n                        const uomOptions = Object.keys(uomPrices).filter(uom => uom && uom !== \"null\").map(uom => ({\n                            label: uom,\n                            value: uom\n                        }));\n\n                        let defaultUOM = uom;\n                        if (!uomPrices.hasOwnProperty(defaultUOM)) {\n                            defaultUOM = uomOptions.length > 0 ? uomOptions[0].value : null;\n                            if (!defaultUOM) {\n                                frappe.msgprint(__('No valid UOMs found for this item.'));\n                                return;\n                            }\n                        }\n\n                        const defaultRate = uomPrices[defaultUOM];\n\n                        const dialog = new frappe.ui.Dialog({\n                            title: __(\"Item Details\"),\n                            fields: [\n                                {\n                                    fieldtype: \"HTML\",\n                                    title: __(\"Item Details\"),\n                                    options: `\n                                        <div class=\"row\">\n                                            <div class=\"col-lg\">\n                                                <div class=\"form-group\">\n                                                    <label class=\"control-label\">Item Code</label>\n                                                    <input class=\"form-control\" readonly data-fieldname=\"description\" type=\"text\" value=\"${item_code}\"/>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    `\n                                },\n                                {\n                                    fieldtype: \"HTML\",\n                                    title: __(\"Item Details\"),\n                                    options: `\n                                        <div class=\"row\">\n                                            <div class=\"col-lg\">\n                                                <div class=\"form-group\">\n                                                    <label class=\"control-label\">Item Description</label>\n                                                    <input class=\"form-control\" readonly data-fieldname=\"description\" type=\"text\" value=\"${description}\"/>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    `\n                                },\n                                {\n                                    fieldtype: \"HTML\",\n                                    label: __(\"Quantity\"),\n                                    options: `\n                                        <div class=\"row\">\n                                            <div class=\"col-lg\">\n                                                <div class=\"form-group\">\n                                                    <label class=\"control-label\">${__(\"Quantity\")}</label>\n                                                    <input class=\"form-control\" type=\"number\" data-fieldname=\"quantity\" required value=\"1\" min=\"1\" /> </div>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    `\n                                },\n                                {\n                                    fieldtype: 'Select',\n                                    label: __(\"UOM\"),\n                                    fieldname: 'uom',\n                                    options: uomOptions,\n                                    default: defaultUOM\n                                },\n                                {\n                                    fieldtype: \"HTML\",\n                                    label: __(\"Amount\"),\n                                    options: `\n                                        <div class=\"row\">\n                                            <div class=\"col-lg\">\n                                                <div class=\"form-group\">\n                                                    <label class=\"control-label\">Amount</label>\n                                                    <input class=\"form-control\" data-fieldname=\"total_amount\" value=\"${defaultRate.toFixed(2)}\" readonly />\n                                                </div>\n                                            </div>\n                                        </div>\n                                    `\n                                },\n                                        {\n                                    label: 'Branch Item INVTY',\n                                    fieldtype: 'Button',\n                                    btn_size: 'sm', // xs, sm, lg\n                                    click: function () {\n                                        // Step 1: Fetch the list of warehouses\n                                        let warehouses = [];\n                                        // const current_wareouse = // frappe.db.get_value(\"POS Profile\", this.pos_profile, warehouse)\n                                        // console.log(\"Current Warehouse: \", current_wareouse)\n\n                                        frappe.call({\n                                            method: \"frappe.client.get_list\",\n                                            args: {\n                                                doctype: \"Warehouse\",\n                                                fields: [\"name\", \"warehouse_type\", \"parent_warehouse\"],\n                                                limit_page_length: 0 // Fetch all items without limit\n                                            },\n                                            callback: function (response) {\n                                                warehouses = response.message;\n\n                                                // Step 2: Fetch item quantity for each warehouse\n                                                let warehouse_data_promises = warehouses.map(warehouse => {\n                                                    return new Promise((resolve, reject) => {\n                                                        frappe.call({\n                                                            method: \"custom_app.customapp.page.packing_list.packing_list.get_item_qty_per_warehouse\",\n                                                            args: {\n                                                                warehouse: warehouse.name,\n                                                                item_code: item_code // Replace with your item code variable\n                                                            },\n                                                            callback: function (response) {\n                                                                warehouse.actual_qty = response.message;\n                                                                resolve(warehouse);\n                                                            },\n                                                            error: function (error) {\n                                                                reject(error);\n                                                            }\n                                                        });\n                                                    });\n                                                });\n\n                                                Promise.all(warehouse_data_promises).then(warehouses_with_qty => {\n                                                    // Filter out warehouses with zero quantity\n                                                    warehouses_with_qty = warehouses_with_qty.filter(warehouse => warehouse.actual_qty > 0);\n                                                \n                                                    const dialog = new frappe.ui.Dialog({\n                                                        title: `${item_code} ${description}`,\n                                                        fields: [\n                                                            {\n                                                                fieldtype: 'HTML',\n                                                                fieldname: 'warehouse_table_html',\n                                                                options: renderWarehousesTable(warehouses_with_qty)\n                                                            }\n                                                        ],\n                                                        primary_action_label: __(\"Ok\"),\n                                                        primary_action: function () {\n                                                            dialog.hide();\n                                                        }\n                                                    });\n                                                \n                                                    // Show the dialog and adjust its width\n                                                    dialog.show();\n                                                \n                                                    // Adjust dialog width and enable scrolling for the table\n                                                    $(dialog.$wrapper).css({\n                                                        \"max-height\": \"80vh\", // Adjust max height as needed\n                                                        \"overflow-y\": \"auto\" // Enable vertical scrolling\n                                                    });\n                                                \n                                                    // Ensure the table within the dialog is scrollable\n                                                    $(dialog.fields_dict.warehouse_table_html.$wrapper).css({\n                                                        \"max-height\": \"60vh\", // Adjust table max height as needed\n                                                        \"overflow-y\": \"auto\" // Enable vertical scrolling for the table\n                                                    });\n                                                \n                                                }).catch(error => {\n                                                    console.error(\"Error fetching warehouse data:\", error);\n                                                });\n                                                \n                                                function renderWarehousesTable(data) {\n                                                    // Start building the HTML table\n                                                    let tableHtml = '<table class=\"table table-bordered\">';\n                                                    tableHtml += '<thead><tr>';\n                                                    tableHtml += '<th>Name</th>';\n                                                    tableHtml += '<th>Quantity</th>';\n                                                    tableHtml += '</tr></thead>';\n                                                    tableHtml += '<tbody>';\n                                                \n                                                    // Populate table rows with data\n                                                    data.forEach(row => {\n                                                        tableHtml += '<tr>';\n                                                        tableHtml += `<td>${row.name}</td>`;\n                                                        tableHtml += `<td>${row.actual_qty}</td>`;\n                                                        tableHtml += '</tr>';\n                                                    });\n                                                \n                                                    tableHtml += '</tbody>';\n                                                    tableHtml += '</table>';\n                                                \n                                                    return tableHtml;\n                                                }\n                                                \n                                            }\n                                        });\n                                    },\n                                }\n\n\n                            ],\n                            primary_action_label: __(\"Ok\"),\n                            primary_action: function () {\n                                const quantity = parseFloat(dialog.wrapper.find('input[data-fieldname=\"quantity\"]').val());\n                                const selectedUOM = dialog.wrapper.find('select[data-fieldname=\"uom\"]').val();\n                                const totalAmount = parseFloat(dialog.wrapper.find('input[data-fieldname=\"total_amount\"]').val());\n\n                                if (!quantity || quantity <= 0) {\n                                    frappe.msgprint(__(\"Please enter a valid quantity.\"));\n                                    return;\n                                }\n\n                                if (!me.selectedItem) {\n                                    frappe.msgprint(__(\"No item selected.\"));\n                                    return;\n                                }\n\n                                if (quantity > qty) {\n                                    frappe.msgprint(__(\"Entered Quantity Exceeded\"));\n                                    return;\n                                }\n\n                                frappe.call({\n                                    method: 'custom_app.customapp.page.packing_list.packing_list.get_item_uom_conversion',\n                                    args: {\n                                        item_code: item_code,\n                                        uom_code: selectedUOM\n                                    },\n                                    callback: function (response) {\n                                        if (response.message) {\n                                            let conversion_factor = response.message;\n        \n                                            // Adjust the quantity based on the conversion factor\n                                            const converted_quantity = quantity * conversion_factor;\n        \n                                            // Check if the converted quantity exceeds the available quantity\n                                            if (converted_quantity > qty) {\n                                                frappe.msgprint(__(\"Entered Quantity Exceeded\"));\n                                                return;\n                                            }\n\n                                            me.selectedItem.find(\".item-uom\").text(selectedUOM);\n            \n                                            const itemCode = unescape(me.selectedItem.attr(\"data-item-code\"));\n                                            const batchNo = unescape(me.selectedItem.attr(\"data-batch-no\"));\n                                            const serialNo = unescape(me.selectedItem.attr(\"data-serial-no\"));\n\n                                            me.events.item_selected({\n                                                field: \"qty\",\n                                                value: \"+\" + quantity,\n                                                item: { item_code: itemCode, batch_no: batchNo, serial_no: serialNo, uom: selectedUOM, quantity, rate: totalAmount },\n                                            });\n\n                                            me.search_field.set_focus();\n\n                                            dialog.hide();\n        \n        \n                                        } else {\n                                            frappe.msgprint(__(\"Failed to fetch UOM conversion factor.\"));\n                                        }\n                                    }\n                                });\n                            }\n\n                        });\n\n                     \n                        dialog.on_page_show = function() {\n                            setTimeout(() => {\n                                const $quantityField = dialog.wrapper.find('input[data-fieldname=\"quantity\"]');\n                                $quantityField.focus();\n                                $quantityField.select(); // Selects the text inside the field for easy replacement\n                            }, 300); // Use a small delay to ensure the element is in the DOM\n                        };\n            \n                        dialog.show();\n                    \n                        // Set the default UOM and amount fields\n                        dialog.wrapper.find('select[data-fieldname=\"uom\"]').val(defaultUOM);\n                        dialog.wrapper.find('input[data-fieldname=\"total_amount\"]').val(defaultRate.toFixed(2));\n                        \n\n                        dialog.wrapper.find('input[data-fieldname=\"quantity\"]').on('input', function () {\n                            const quantity = parseFloat($(this).val());\n                            const selectedUOM = dialog.wrapper.find('select[data-fieldname=\"uom\"]').val();\n                            const rate = uomPrices[selectedUOM];\n                            if (!isNaN(quantity)) {\n                                const totalAmount = (quantity * rate).toFixed(2);\n                                dialog.wrapper.find('input[data-fieldname=\"total_amount\"]').val(totalAmount);\n                            } else {\n                                dialog.wrapper.find('input[data-fieldname=\"total_amount\"]').val(rate.toFixed(2));\n                            }\n                        });\n\n                        dialog.wrapper.find('select[data-fieldname=\"uom\"]').on('change', function () {\n                            const selectedUOM = $(this).val();\n                            const rate = uomPrices[selectedUOM];\n                            const quantity = parseFloat(dialog.wrapper.find('input[data-fieldname=\"quantity\"]').val());\n                            if (!isNaN(quantity)) {\n                                const totalAmount = (quantity * rate).toFixed(2);\n                                dialog.wrapper.find('input[data-fieldname=\"total_amount\"]').val(totalAmount);\n                            } else {\n                                dialog.wrapper.find('input[data-fieldname=\"total_amount\"]').val(rate.toFixed(2));\n                            }\n                        });\n\n                        dialog.wrapper.find('input[data-fieldname=\"quantity\"]').on('keypress', function(e) {\n                            if (e.which === 13) { // Enter key pressed\n                                e.preventDefault();\n                                dialog.primary_action();\n                            }\n                        });\n                    }\n                }\n            });\n        });\n       \n          \n        \n       \n\n\n        // this.$component.on(\"click\", \".item-wrapper\", function () {\n\t\t// \tconst $item = $(this);\n\t\t// \tconst item_code = unescape($item.attr(\"data-item-code\"));\n\t\t// \tlet batch_no = unescape($item.attr(\"data-batch-no\"));\n\t\t// \tlet serial_no = unescape($item.attr(\"data-serial-no\"));\n\t\t// \tlet uom = unescape($item.attr(\"data-uom\"));\n\t\t// \tlet rate = unescape($item.attr(\"data-rate\"));\n\n\t\t// \t// escape(undefined) returns \"undefined\" then unescape returns \"undefined\"\n\t\t// \tbatch_no = batch_no === \"undefined\" ? undefined : batch_no;\n\t\t// \tserial_no = serial_no === \"undefined\" ? undefined : serial_no;\n\t\t// \tuom = uom === \"undefined\" ? undefined : uom;\n\t\t// \trate = rate === \"undefined\" ? undefined : rate;\n\n\t\t// \tme.events.item_selected({\n\t\t// \t\tfield: \"qty\",\n\t\t// \t\tvalue: \"+1\",\n\t\t// \t\titem: { item_code, batch_no, serial_no, uom, rate },\n\t\t// \t});\n\t\t// \tme.search_field.set_focus();\n\t\t// });\n      \n        this.search_field.$input.on(\"input\", (e) => {\n            clearTimeout(this.last_search);\n            this.last_search = setTimeout(() => {\n                const search_term = e.target.value;\n                this.filter_items({ search_term });\n            }, 300);\n\n            this.$clear_search_btn.toggle(Boolean(this.search_field.$input.val()));\n        });\n\n        this.search_field.$input.on(\"focus\", () => {\n            this.$clear_search_btn.toggle(Boolean(this.search_field.$input.val()));\n        });\n\n         this.$component.on(\"keydown\", (e) => {\n            const key = e.which || e.keyCode;\n            const isCtrlPressed = e.ctrlKey; \n            switch (key) {\n                case 38: // up arrow\n                    e.preventDefault();\n                    this.navigate_up();\n                    break;\n                case 40: // down arrow\n                    e.preventDefault();\n                    this.navigate_down();\n                    break;\n                case 9: // tab\n                    e.preventDefault();\n                    this.navigate_down();\n                    this.focus_next_field();\n                    break;\n                // case 32: // enter\n                //     e.preventDefault();\n                //     this.select_highlighted_item();\n                //     break;\n                case 13: // enter\n                    if (isCtrlPressed) {\n                        // Handle Ctrl + Enter as a checkout shortcut\n                        break\n                    } else {\n                        // Regular Enter key behavior\n                        e.preventDefault();\n                        this.select_highlighted_item();\n                    }\n                    break;\n                \n            }\n        });\n    }\n    \n\n    \n\n\n    attach_shortcuts() {\n        const ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n        this.search_field.parent.attr(\"title\", `${ctrl_label}+S`);\n        frappe.ui.keys.add_shortcut({\n            shortcut: \"ctrl+s\",\n            action: () => this.search_field.set_focus(),\n            condition: () => this.$component.is(\":visible\"),\n            description: __(\"Focus on search input\"),\n            ignore_inputs: true,\n            page: cur_page.page.page,\n        });\n        this.item_group_field.parent.attr(\"title\", `${ctrl_label}+G`);\n        frappe.ui.keys.add_shortcut({\n            shortcut: \"ctrl+g\",\n            action: () => this.item_group_field.set_focus(),\n            condition: () => this.$component.is(\":visible\"),\n            description: __(\"Focus on Item Group filter\"),\n            ignore_inputs: true,\n            page: cur_page.page.page,\n        });\n    \n        document.addEventListener(\"keydown\", (e) => {\n            if (e.key === \"Enter\" && e.ctrlKey) {\n                e.preventDefault();\n                // Add your checkout logic here for Ctrl + Shift + Enter\n                console.log(\"Ctrl + Enter pressed for checkout\");\n                return false;\n            }\n        });\n        \n        \n        frappe.ui.keys.on(\"enter\", (e) => {\n\n            if (e.ctrlKey) return; // Skip handling if Shift + Enter is pressed\n        \n            const selector_is_visible = this.$component.is(\":visible\");\n            const dialog_is_open = document.querySelector(\".modal.show\");\n        \n            if (!selector_is_visible || this.search_field.get_value() === \"\") return;\n        \n            if (this.items.length == 0 && this.barcode_scanned) {\n                frappe.show_alert({\n                    message: __(\"No items found. Scan barcode again.\"),\n                    indicator: \"orange\",\n                });\n                frappe.utils.play_sound(\"error\");\n                this.barcode_scanned = false;\n                this.set_search_value(\"\");\n            }\n        \n            if (dialog_is_open && document.activeElement.tagName === \"SELECT\") {\n                // Trigger action to add the selected item to the cart\n                this.selectedItem.find(\".item-uom\").text(dialog.wrapper.find('select[data-fieldname=\"uom\"]').val());\n        \n                const itemCode = unescape(this.selectedItem.attr(\"data-item-code\"));\n                const batchNo = unescape(this.selectedItem.attr(\"data-batch-no\"));\n                const serialNo = unescape(this.selectedItem.attr(\"data-serial-no\"));\n        \n                this.events.item_selected({\n                    field: \"qty\",\n                    value: quantity,\n                    item: { item_code: itemCode, batch_no: batchNo, serial_no: serialNo, uom: selectedUOM, quantity, rate },\n                });\n        \n                this.search_field.set_focus();\n            }\n        });\n        \n    }\n    \n    // The rest of your class definition...\n \n    navigate_up() {\n        if (this.highlighted_row_index > -1) {\n            this.highlighted_row_index--;\n            this.highlight_row(this.highlighted_row_index);\n        }\n    }\n\n    navigate_down() {\n        if (this.highlighted_row_index < this.items.length - 1) {\n            this.highlighted_row_index++;\n            this.highlight_row(this.highlighted_row_index);\n        }\n    }\n\n    highlight_row(index) {\n        // Ensure no highlight initially\n        if (index === -1) {\n            this.$items_container.find(\".item-wrapper\").removeClass(\"highlight\");\n            return;\n        }\n\n        // Remove highlight from all items\n        this.$items_container.find(\".item-wrapper\").removeClass(\"highlight\");\n\n        // Highlight the item at the current index\n        if (index >= 0 && index < this.items.length) {\n            this.$items_container.find(\".item-wrapper\").eq(index).addClass(\"highlight\");\n        }\n    }\n\n    select_highlighted_item() {\n        // Check if a click action is already in progress\n        if (this.isClicking) return;\n    \n        // Ensure highlighted_row_index is valid\n        if (this.highlighted_row_index === -1) {\n            frappe.msgprint({\n                title: __(\"No Item Highlighted\"),\n                indicator: \"orange\",\n                message: __(\"Please select an item to highlight before proceeding.\")\n            });\n            return;\n        }\n    \n        // Set the isClicking flag to true to indicate that a click action is in progress\n        this.isClicking = true;\n    \n        // Proceed to select the highlighted item\n        const highlightedItem = this.$items_container.find(\".item-wrapper\").eq(this.highlighted_row_index);\n        if (highlightedItem.length) {\n            highlightedItem.click(); // Simulate click action\n        }\n    \n        // Reset the isClicking flag after a short delay to allow for the click action to complete\n        setTimeout(() => {\n            this.isClicking = false;\n        }, 1000); // Adjust the delay (in milliseconds) as needed\n    }\n    \n    \n    \n\n\t//end here\n\n    filter_items({ search_term = \"\", uom = \"\" } = {}) {\n        if (search_term) {\n            search_term = search_term.toLowerCase();\n    \n            this.search_index = this.search_index || {};\n            if (this.search_index[search_term]) {\n                const items = this.search_index[search_term];\n                this.items = items;\n                if (uom) {\n                    this.items = this.items.filter(item => item.uom === uom);\n                }\n                this.render_item_list(this.items);\n                this.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n                return;\n            }\n        }\n    \n        this.get_items({ search_term }).then(({ message }) => {\n            let { items, serial_no, batch_no, barcode } = message;\n            if (search_term && !barcode) {\n                this.search_index[search_term] = items;\n            }\n    \n            // Filter by UOM if specified\n            if (uom) {\n                items = items.filter(item => item.uom === uom);\n            }\n    \n            this.items = items;\n            this.render_item_list(items);\n            this.auto_add_item && this.items.length == 1 && this.add_filtered_item_to_cart();\n        });\n    }\n\n    \n\n    add_filtered_item_to_cart() {\n        this.$items_container.find(\".item-wrapper\").click();\n        this.set_search_value(\"\");\n    }\n\n\tresize_selector(minimize) {\n        if (minimize) {\n            this.$component.css({\n                \"opacity\": \"0\",               // Make the component invisible\n                \"pointer-events\": \"none\",     // Make the component non-interactive\n                \"grid-column\": \"span 1 / span 1\",\n                \"grid-template-columns\": \"repeat(13, minmax(0, 1fr))\"\n            });\n        } else {\n            this.$component.css({\n                \"opacity\": \"1\",               // Make the component visible\n                \"pointer-events\": \"auto\",     // Make the component interactive\n                \"grid-column\": \"span 4 / span 4\"\n            });\n\n            this.$component.find(\".filter-section\")\n                .css(\"grid-template-columns\", \"repeat(12, minmax(0, 1fr))\");\n\n            this.$component.find(\".search-field\").css(\"margin\", \"0px var(--margin-sm)\");\n\n            this.$items_container.css(\"grid-template-columns\", \"repeat(4, minmax(0, 1fr))\");\n        }\n    }\n\n    toggle_component(show) {\n        this.set_search_value(\"\");\n        this.$component.css(\"display\", show ? \"flex\" : \"none\");\n    }\n};", "custom_app.PointOfSale.ItemCart = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.customer_info = undefined;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allowed_customer_groups = settings.customer_groups;\n\t\tthis.allowed_doctor_groups = settings.doctor_groups; \n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(`<section class=\"customer-cart-container\" style=\"grid-column: span 6/ span 6; margin-top: 0rem;\"\"></section>`);\n\n\t\tthis.$component = this.wrapper.find(\".customer-cart-container\");\n\t}\n\n\tinit_child_components() {\n\t\tthis.init_customer_selector();\n\t\tthis.init_doctor_selector();\n\t\tthis.init_cart_components();\n\t}\n\n\tinit_customer_selector() {\n\t\tthis.$component.append(`<div class=\"customer-section\"></div>`);\n\t\tthis.$customer_section = this.$component.find(\".customer-section\");\n\t\tthis.make_customer_selector();\n\t}\n\n\tinit_doctor_selector() {\n\t\tthis.$component.append(`<div class=\"doctor-section\" style=\"display: flex;\n\t\tflex-direction: column;\n\t\tpadding: var(--padding-md) var(--padding-lg);\n\t\toverflow: visible; background-color: var(--fg-color);\n\t\tbox-shadow: var(--shadow-base);\n\t\tborder-radius: var(--border-radius-md);\n\t  }; margin-top: 1em;\"></div>`);\n\t\tthis.$doctor_section = this.$component.find(\".doctor-section\");\n\t\tthis.make_doctor_selector();\n\t}\n\n\treset_customer_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value(\"customer\", \"\");\n\t\tthis.make_customer_selector();\n\t\tthis.customer_field.set_focus();\n\t}\n\n\treset_doctor_selector() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.set_value(\"doctor\", \"\");\n\t\tthis.make_doctor_selector();\n\t\tthis.doctor_field.set_focus();\n\t}\n\n\tinit_cart_components() {\n\t\tthis.$component.append(\n\t\t\t`<div class=\"cart-container\">\n\t\t\t\t<div class=\"abs-cart-container\">\n\t\t\t\t\t<div class=\"cart-label\" >${__(\"Item Cart\")}</div>\n\t\t\t\t\t<div class=\"cart-header\">\n\t\t\t\t\t\t<div class=\"name-header\">${__(\"Item\")}</div>\n\n\t\t\t\t\t\t<div class=\"qty-header\">${__(\"Vat Type\")}</div>\n\t\t\t\t\t\t<div class=\"qty-header\">${__(\"Price\")}</div>\n\t\t\t\t\t\t<div class=\"qty-header\" >${__(\"Disc %\")}</div>\n\n\t\t\t\t\t\t<div class=\"qty-header\">${__(\"Quantity\")}</div>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<div class=\"rate-amount-header\">${__(\"Amount\")}</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"cart-items-section\"></div>\n\t\t\t\t\t<div class=\"cart-totals-section\"></div>\n\t\t\t\t\t<div class=\"numpad-section\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\t\tthis.$cart_container = this.$component.find(\".cart-container\");\n\n\t\tthis.make_cart_totals_section();\n\t\tthis.make_cart_items_section();\n\t\tthis.make_cart_numpad();\n\t}\n\n\tmake_cart_items_section() {\n\t\tthis.$cart_header = this.$component.find(\".cart-header\");\n\t\tthis.$cart_items_wrapper = this.$component.find(\".cart-items-section\");\n\n\t\tthis.make_no_items_placeholder();\n\t}\n\n\tmake_no_items_placeholder() {\n\t\tthis.$cart_header.css(\"display\", \"none\");\n\t\tthis.$cart_items_wrapper.html(`<div class=\"no-item-wrapper\">${__(\"No items in cart\")}</div>`);\n\t}\n\n\tget_discount_icon() {\n\t\treturn `<svg class=\"discount-icon\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t\t\t<path d=\"M19 15.6213C19 15.2235 19.158 14.842 19.4393 14.5607L20.9393 13.0607C21.5251 12.4749 21.5251 11.5251 20.9393 10.9393L19.4393 9.43934C19.158 9.15804 19 8.7765 19 8.37868V6.5C19 5.67157 18.3284 5 17.5 5H15.6213C15.2235 5 14.842 4.84196 14.5607 4.56066L13.0607 3.06066C12.4749 2.47487 11.5251 2.47487 10.9393 3.06066L9.43934 4.56066C9.15804 4.84196 8.7765 5 8.37868 5H6.5C5.67157 5 5 5.67157 5 6.5V8.37868C5 8.7765 4.84196 9.15804 4.56066 9.43934L3.06066 10.9393C2.47487 11.5251 2.47487 12.4749 3.06066 13.0607L4.56066 14.5607C4.84196 14.842 5 15.2235 5 15.6213V17.5C5 18.3284 5.67157 19 6.5 19H8.37868C8.7765 19 9.15804 19.158 9.43934 19.4393L10.9393 20.9393C11.5251 21.5251 12.4749 21.5251 13.0607 20.9393L14.5607 19.4393C14.842 19.158 15.2235 19 15.6213 19H17.5C18.3284 19 19 18.3284 19 17.5V15.6213Z\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15 9L9 15\" stroke-miterlimit=\"10\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M10.5 9.5C10.5 10.0523 10.0523 10.5 9.5 10.5C8.94772 10.5 8.5 10.0523 8.5 9.5C8.5 8.94772 8.94772 8.5 9.5 8.5C10.0523 8.5 10.5 8.94772 10.5 9.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t\t<path d=\"M15.5 14.5C15.5 15.0523 15.0523 15.5 14.5 15.5C13.9477 15.5 13.5 15.0523 13.5 14.5C13.5 13.9477 13.9477 13.5 14.5 13.5C15.0523 13.5 15.5 13.9477 15.5 14.5Z\" fill=\"white\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n\t\t\t</svg>`;\n\t}\n\n\tmake_cart_totals_section() {\n\t\tthis.$totals_section = this.$component.find(\".cart-totals-section\");\n\n\t\tthis.$totals_section.append(\n\t\t\t`\n\t\t\t<div class=\"item-qty-total-container\">\n\t\t\t\t<div class=\"item-qty-total-label\">${__(\"Total Items\")}</div>\n\t\t\t\t<div class=\"item-qty-total-value\">0.00</div>\n\t\t\t</div>\n\t\t\t<div class=\"vatable-sales-container\"></div>\n\t\t\t<div class=\"vat-exempt-container\"></div>\n\t\t\t<div class=\"zero-rated-container\"></div>\n\t\t\t\n\t\t\t\n\t\t\t<div class=\"ex-total-container\"></div>\n\t\t\t\t<div class=\"net-total-container\" style=\"line-height: 0rem; font-size:12px;\">\n\t\t\t\t<div class=\"net-total-label\">${__(\"Sub Total:\")}</div>\n\t\t\t\t<div class=\"net-total-value\" style=\"font-size:12px;\">0.00</div>\n\t\t\t</div>\n\n\t\t <div class=\"taxes-container\"></div>\n\t\t <div class=\"vat-container\"></div>\n\t\t<div class=\"total-vat-container\"></div>\n\t\t\t<div class=\"grand-total-container\" style=\"line-height: 0rem;\">\n\t\t\t\t<div>${__(\"Total\")}</div>\n\t\t\t\t<div>0.00</div>\n\t\t\t</div> \n\n\t\t\t<div class=\"checkout-btn\">${__(\"Order\")}</div>\n\t\t\t<div class=\"edit-cart-btn\">${__(\"Edit Cart\")}</div>`\n\t\t);\n\n\t\tthis.$add_discount_elem = this.$component.find(\".add-discount-wrapper\");\n\t}\n\n\tmake_cart_numpad() {\n\t\tthis.$numpad_section = this.$component.find(\".numpad-section\");\n\n\t\tthis.number_pad = new custom_app.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad_section,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: this.on_numpad_event.bind(this),\n\t\t\t},\n\t\t\tcols: 5,\n\t\t\tkeys: [\n\t\t\t\t// [1, 2, 3, \"Quantity\"],\n\t\t\t\t// [4, 5, 6, \"Discount\"],\n\t\t\t\t// [7, 8, 9, \"Rate\"],\n\t\t\t\t// [\".\", 0, \"Delete\", \"Remove\"],\n\t\t\t\t[\"Discount\", \"Quantity\",\"\", \"Remove\"],\n\t\t\t],\n\t\t\tcss_classes: [\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2 remove-btn\"],\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2\"],\n\t\t\t\t[\"\", \"\", \"\", \"col-span-2\"],\n\t\t\t\t// [\"\", \"\", \"\", \"col-span-2 remove-btn\"],\n\t\t\t],\n\t\t\tfieldnames_map: { Quantity: \"qty\", Discount: \"discount_percentage\" },\n\t\t});\n\n\n\t\tthis.$numpad_section.prepend(\n\t\t\t`<div class=\"numpad-totals\">\n\t\t\t<span class=\"numpad-item-qty-total\"></span>\n\t\t\t\t<span class=\"numpad-net-total\"></span>\n\t\t\t\t<span class=\"numpad-grand-total\"></span>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis.$numpad_section.append(\n\t\t\t`<div class=\"numpad-btn checkout-btn\" data-button-value=\"checkout\">${__(\"Checkout\")}</div>`\n\t\t);\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.$customer_section.on(\"click\", \".reset-customer-btn\", function () {\n\t\t\tme.reset_customer_selector();\n\t\t});\n\n\t\tthis.$customer_section.on(\"click\", \".close-details-btn\", function () {\n\t\t\tme.toggle_customer_info(false);\n\t\t});\n\n\t\tthis.$customer_section.on(\"click\", \".customer-display\", function (e) {\n\t\t\tif ($(e.target).closest(\".reset-customer-btn\").length) return;\n\n\t\t\tconst show = me.$cart_container.is(\":visible\");\n\t\t\tme.toggle_customer_info(show);\n\t\t});\n\n\t\t//Doctors\n\n\t\tthis.$doctor_section.on(\"click\", \".reset-doctor-btn\", function () {\n\t\t\tme.reset_doctor_selector();\n\t\t});\n\n\t\tthis.$doctor_section.on(\"click\", \".close-details-btn\", function () {\n\t\t\tme.toggle_doctor_info(false);\n\t\t});\n\n\t\tthis.$doctor_section.on(\"click\", \".doctor-display\", function (e) {\n\t\t\tif ($(e.target).closest(\".reset-doctor-btn\").length) return;\n\t\t\tconst show = me.$cart_container.is(\":visible\");\n\t\t\tme.toggle_doctor_info(show);\n\t\t});\n\n\t\t\n\t\tthis.$cart_items_wrapper.on(\"click\", \".cart-item-wrapper\", function () {\n            const $cart_item = $(this);\n            me.toggle_item_highlight(this);\n            const payment_section_hidden = !me.$totals_section.find(\".edit-cart-btn\").is(\":visible\");\n            if (!payment_section_hidden) {\n                // payment section is visible\n                // edit cart first and then open item details section\n                me.$totals_section.find(\".edit-cart-btn\").click();\n                return;\n            }\n            const item_row_name = unescape($cart_item.attr(\"data-row-name\"));\n            me.events.cart_item_clicked({ name: item_row_name });\n            this.numpad_value = \"\";\n        });\n\n\t\tthis.$component.on(\"click\", \".checkout-btn\", async function () {\n\t\t\tif ($(this).attr(\"style\").indexOf(\"--blue-500\") == -1) return;\n\n\t\t\tawait me.events.checkout();\n\t\t\tme.toggle_checkout_btn(false);\n\n\t\t\tme.allow_discount_change && me.$add_discount_elem.removeClass(\"d-none\");\n\t\t});\n\n\t\tthis.$totals_section.on(\"click\", \".edit-cart-btn\", () => {\n\t\t\t// Destroy any previous instances of the dialog\n\t\t\t\n\t\t\tif (this.passwordDialog) {\n\t\t\t\tthis.passwordDialog.$wrapper.remove();\n\t\t\t\tdelete this.passwordDialog;\n\t\t\t}\n\t\t\n\t\t\n\t\t\t// Create and show the password dialog\n\t\t\tthis.passwordDialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Enter OIC Password'),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\t\tfieldname: 'password_html',\n\t\t\t\t\t\toptions: `\n\t\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t\t<label for=\"password_field\">${__('Password')}</label>\n\t\t\t\t\t\t\t\t<input type=\"password\" id=\"password_field\" class=\"form-control\" required>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action_label: __('Ok'),\n\t\t\t\tprimary_action: () => {\n\t\t\t\t\t// Retrieve the password value from the HTML field\n\t\t\t\t\tlet password = document.getElementById('password_field').value;\n\t\t\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"custom_app.customapp.page.packing_list.packing_list.confirm_user_password\",\n\t\t\t\t\t\targs: { password: password },\n\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\tif (r.message && r.message.name) {\n\t\t\t\t\t\t\t\t// OIC authentication successful, proceed with editing the cart\n\t\t\t\t\t\t\t\tthis.events.edit_cart();\n\t\t\t\t\t\t\t\tthis.toggle_checkout_btn(true);\n\t\t\t\t\t\t\t\tthis.passwordDialog.hide();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Show alert for incorrect password or unauthorized user\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t\n\t\t\t});\n\t\t\n\t\t\tthis.passwordDialog.show();\n\t\n\t\n\t\t\t// Ensure the password field gains focus every time the dialog is opened\n\t\t\tthis.passwordDialog.$wrapper.on('shown.bs.modal', function () {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tdocument.getElementById('password_field').focus();\n\t\t\t\t}, 100); // Slight delay to ensure field is rendered before focusing\n\t\t\t});\n\t\t});\n\t\t\n\n\n\t\t\n\t\tthis.$component.on(\"click\", \".add-discount-wrapper\", () => {\n\t\t\t// Check if OIC authentication is required\n\t\t\tif (!this.is_oic_authenticated) {\n\t\t\t\t// OIC authentication required, show password dialog\n\t\t\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\t\t\ttitle: __('Enter OIC Password'),\n\t\t\t\t\tfields: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\t\t\treqd: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\tprimary_action_label: __('Add Discount'),\n\t\t\t\t\tprimary_action: (values) => {\n\t\t\t\t\t\tlet password = values.password;\n\t\t\t\t\t\tlet role = \"oic\";\n\t\t\n\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t\t\t\t\t\t\targs: { password: password, role: role },\n\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\t\t// OIC authentication successful, proceed with editing the cart\n\t\t\t\t\t\t\t\t\tthis.is_oic_authenticated = true;\n\t\t\t\t\t\t\t\t\tthis.show_discount_control();\n\t\t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t// Show alert for incorrect password or unauthorized user\n\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\n\t\t\t\tpasswordDialog.show();\n\t\t\t} else {\n\t\t\t\t// OIC authenticated, proceed with showing the discount control\n\t\t\t\tconst can_edit_discount = this.$add_discount_elem.find(\".edit-discount-btn\").length;\n\t\t\t\tif (!this.discount_field || can_edit_discount) this.show_discount_control();\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Event handler for editing the discount field\n\t\tthis.$add_discount_elem.find(\".edit-discount-btn\").on(\"click\", () => {\n\t\t\t// Reset OIC authentication flag and prompt for authentication\n\t\t\tthis.is_oic_authenticated = false;\n\t\t\tthis.$component.trigger(\"click\", \".add-discount-wrapper\");\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"paid_amount\", (frm) => {\n\t\t\t// called when discount is applied\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\n\t\tdocument.addEventListener('keydown', function(event) {\n\t\t\t// List of key codes to prevent\n\t\t\tconst keysToPrevent = {\n\t\t\t\t// Prevent F5 (refresh)\n\t\t\t\t116: true, \n\t\t\t\t// Prevent Ctrl+R (refresh)\n\t\t\t\t'Ctrl+82': true,\n\t\t\t\t\t\t// Prevent Ctrl+Shift+R (refresh)\n\t\t\t\t'Ctrl+16+82': true,\n\t\t\t\t// Prevent Ctrl+S (save)\n\t\t\t\t'Ctrl+83': true,\n\t\t\t\t// Prevent Ctrl+P (print)\n\t\t\t\t'Ctrl+80': true,\n\t\t\t\t// Prevent Ctrl+W (close tab)\n\t\t\t\t'Ctrl+87': true,\n\t\t\t\t// Prevent Ctrl+Shift+I (Developer Tools)\n\t\t\t\t'Ctrl+Shift+73': true,\n\t\t\t\t  // Prevent Ctrl+J (Downloads)\n\t\t\t\t'Ctrl+74': true,\n\t\t\t\t\t  // Prevent Ctrl+E\n\t\t\t\t'Ctrl+69': true,\n\t\t\t\t\t\t\t  // Prevent Ctrl+Q\n\t\t\t\t// 'Ctrl+18+81': true,\n\t\t\t};\n\t\t\n\t\t\t// Generate the key identifier\n\t\t\tconst key = (event.ctrlKey ? 'Ctrl+' : '') + \n\t\t\t\t\t\t(event.shiftKey ? 'Shift+' : '') + \n\t\t\t\t\t\t(event.altKey ? 'Alt+' : '') + \n\t\t\t\t\t\tevent.keyCode;\n\t\t\n\t\t\tif (keysToPrevent[key] || keysToPrevent[event.keyCode]) {\n\t\t\t\tevent.preventDefault();\n\t\t\t}\n\t\t});\n\t\t\n\t\t\n\t\tfor (let row of this.number_pad.keys) {\n\t\t\tfor (let btn of row) {\n\t\t\t\tif (typeof btn !== \"string\") continue; // do not make shortcuts for numbers\n\n\t\t\t\tlet shortcut_key = `ctrl+${frappe.scrub(String(btn))[0]}`;\n\t\t\t\tif (btn === \"Delete\") shortcut_key = \"ctrl+backspace\";\n\t\t\t\tif (btn === \"Remove\") shortcut_key = \"ctrl+x\";\n\t\t\t\tif (btn === \"Quantity\") shortcut_key = \"ctrl+q\";\n\t\t\t\tif (btn === \"Rate\") shortcut_key = \"ctrl+a\";\n\t\t\t\tif (btn === \".\") shortcut_key = \"ctrl+>\";\n\n\t\t\t\t// to account for fieldname map\n\t\t\t\tconst fieldname = this.number_pad.fieldnames[btn]\n\t\t\t\t\t? this.number_pad.fieldnames[btn]\n\t\t\t\t\t: typeof btn === \"string\"\n\t\t\t\t\t? frappe.scrub(btn)\n\t\t\t\t\t: btn;\n\n\t\t\t\tlet shortcut_label = shortcut_key.split(\"+\").map(frappe.utils.to_title_case).join(\"+\");\n\t\t\t\tshortcut_label = frappe.utils.is_mac() ? shortcut_label.replace(\"Ctrl\", \"\u2318\") : shortcut_label;\n\t\t\t\tthis.$numpad_section\n\t\t\t\t\t.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`)\n\t\t\t\t\t.attr(\"title\", shortcut_label);\n\n\t\t\t\tfrappe.ui.keys.on(`${shortcut_key}`, () => {\n\t\t\t\t\tconst cart_is_visible = this.$component.is(\":visible\");\n\t\t\t\t\tif (cart_is_visible && this.item_is_selected && this.$numpad_section.is(\":visible\")) {\n\t\t\t\t\t\tthis.$numpad_section.find(`.numpad-btn[data-button-value=\"${fieldname}\"]`).click();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\n\t\t\t}\n\t\t}\n\t\tconst ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n\t\tthis.$component.find(\".checkout-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+enter\",\n\t\t\taction: () => this.$component.find(\".checkout-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && !this.$totals_section.find(\".edit-cart-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Checkout Order / Submit Order / New Order\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\n\n\t\tthis.$component.find(\".edit-cart-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.on(\"ctrl+e\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tconst checkout_btn_invisible = !this.$totals_section.find(\".checkout-btn\").is(\"visible\");\n\t\t\tif (item_cart_visible && checkout_btn_invisible) {\n\t\t\t\tthis.$component.find(\".edit-cart-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$component.find(\".add-discount-wrapper\").attr(\"title\", `${ctrl_label}+D`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+d\",\n\t\t\taction: () => this.$component.find(\".add-discount-wrapper\").click(),\n\t\t\tcondition: () => this.$add_discount_elem.is(\":visible\"),\n\t\t\tdescription: __(\"Add Order Discount\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_cart_visible = this.$component.is(\":visible\");\n\t\t\tif (item_cart_visible && this.discount_field && this.discount_field.parent.is(\":visible\")) {\n\t\t\t\tthis.discount_field.set_value(0);\n\t\t\t}\n\t\t});\n\n\t\tthis.doctor_field.parent.attr(\"title\", `${ctrl_label}+R`);\n        frappe.ui.keys.add_shortcut({\n            shortcut: \"ctrl+r\",\n            action: () => this.doctor_field.set_focus(),\n            condition: () => this.$component.is(\":visible\"),\n            description: __(\"Doctor\"),\n            ignore_inputs: true,\n            page: cur_page.page.page,\n        });\n\n\t\tthis.customer_field.parent.attr(\"title\", `${ctrl_label}+M`);\n        frappe.ui.keys.add_shortcut({\n            shortcut: \"ctrl+m\",\n            action: () => this.customer_field.set_focus(),\n            condition: () => this.$component.is(\":visible\"),\n            description: __(\"Customer\"),\n            ignore_inputs: true,\n            page: cur_page.page.page,\n        });\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'ctrl+<', // Choose an appropriate shortcut key\n\t\t\taction: () => {\n\t\t\t\tthis.reset_customer_selector();\n\t\t\t},\n\t\t\tcondition: () => true, // Adjust this condition as needed\n\t\t\tdescription: __('Reset Customer Selector'),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page // Replace with your actual page context\n\t\t});\n\n\t}\n\n\ttoggle_item_highlight(item) {\n\t\tconst $cart_item = $(item);\n\t\tconst item_is_highlighted = $cart_item.attr(\"style\") == \"background-color:var(--gray-50);\";\n\n\t\tif (!item || item_is_highlighted) {\n\t\t\tthis.item_is_selected = false;\n\t\t\tthis.$cart_container.find(\".cart-item-wrapper\").css(\"background-color\", \"\");\n\t\t} else {\n\t\t\t$cart_item.css(\"background-color\", \"var(--control-bg)\");\n\t\t\tthis.item_is_selected = true;\n\t\t\tthis.$cart_container.find(\".cart-item-wrapper\").not(item).css(\"background-color\", \"\");\n\t\t}\n\t}\n\n\tmake_customer_selector() {\n\t\tthis.$customer_section.html(`\n\t\t\t<div class=\"customer-field\"></div>\n\t\t`);\n\t\tconst me = this;\n\t\tconst allowed_customer_group = this.allowed_customer_groups || [];\n\t\tlet filters = {};\n\t\tif (allowed_customer_group.length) {\n\t\t\tfilters = {\n\t\t\t\tcustomer_group: [\"in\", allowed_customer_group],\n\t\t\t};\n\t\t}\n\t\tthis.customer_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Customer\"),\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Customer\",\n\t\t\t\tplaceholder: __(\"Search by customer name, phone, email.\"),\n\t\t\t\tget_query: function () {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tfilters: filters,\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tonchange: function () {\n\t\t\t\t\tif (this.value) {\n\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, \"customer\", this.value);\n\t\t\t\t\t\tfrm.script_manager.trigger(\"customer\", frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t() => me.fetch_customer_details(this.value),\n\t\t\t\t\t\t\t\t() => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t() => me.update_customer_section(),\n\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$customer_section.find(\".customer-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.customer_field.toggle_label(false);\n\t}\n\n\n\t//Doctors\n\n\tmake_doctor_selector() {\n\t\tthis.$doctor_section.html(`\n\n\t\t\t<div class=\"doctor-field\" tabindex=\"0\"></div>\n\n\t\t`);\n\t\tconst me = this;\n\t\tconst allowed_doctor_group = this.allowed_doctor_groups || [];\n\t\tlet filters = {};\n\t\tif (allowed_doctor_group.length) {\n\t\t\tfilters = {\n\t\t\t\tdoctor_group: [\"in\", allowed_doctor_group],\n\t\t\t};\n}\n\t\tthis.doctor_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Doctor\"),\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Doctor\",\n\t\t\t\tplaceholder: __(\"Doctor\"),\n\t\t\t\tonchange: function () {\n\t\t\t\t\tif (this.value) {\n\t\t\t\t\t\tconst frm = me.events.get_frm();\n\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, \"custom_doctors_information\", this.value);\n\t\t\t\t\t\tfrm.script_manager.trigger(\"custom_doctors_information\", frm.doc.doctype, frm.doc.name).then(() => {\n\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t// () => me.fetch_customer_details(this.value),\n\t\t\t\t\t\t\t\t// () => me.events.customer_details_updated(me.customer_info),\n\t\t\t\t\t\t\t\t// () => me.update_customer_section(),\n\t\t\t\t\t\t\t\t// () => me.update_totals_section(),\n\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$doctor_section.find(\".doctor-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.doctor_field.toggle_label(false);\n\t}\n\n\n\tfetch_customer_details(customer) {\n\t\tif (customer) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db\n\t\t\t\t\t.get_value(\"Customer\", customer, [\"email_id\", \"customer_name\", \"mobile_no\" , \"image\", \"loyalty_program\",\n\t\t\t\t\t\"custom_osca_id\", \"custom_pwd_id\", \"customer_group\"])\n\t\t\t\t\t.then(({ message }) => {\n\t\t\t\t\t\tconst { loyalty_program } = message;\n\t\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\t\tif (loyalty_program) {\n\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\tmethod: \"erpnext.accounts.doctype.loyalty_program.loyalty_program.get_loyalty_program_details_with_points\",\n\t\t\t\t\t\t\t\targs: { customer, loyalty_program, silent: true },\n\t\t\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\t\t\tconst { loyalty_points, conversion_factor } = r.message;\n\t\t\t\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\t\t\t\tthis.customer_info = {\n\t\t\t\t\t\t\t\t\t\t\t...message,\n\t\t\t\t\t\t\t\t\t\t\tcustomer,\n\t\t\t\t\t\t\t\t\t\t\tloyalty_points,\n\t\t\t\t\t\t\t\t\t\t\tconversion_factor,\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.customer_info = { ...message, customer };\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.customer_info = {};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\n\tfetch_doctor_details(doctor) {\n\t\tif (doctor) {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tfrappe.db\n\t\t\t\t\t.get_value(\"Doctor\", doctor, [\"first_name\", \"last_name\", \"prc_number\", \"image\"])\n\t\t\t\t\t.then(({ message }) => {\n\t\t\t\t\t\t// const { loyalty_program } = message;\n\t\t\t\t\t\t// if loyalty program then fetch loyalty points too\n\t\t\t\t\t\tthis.doctor_info = { ...message, doctor };\n\t\t\t\t\t\tconsole.log(this.doctor_info);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t});\n\t\t} else {\n\t\t\treturn new Promise((resolve) => {\n\t\t\t\tthis.doctor_info = {};\n\t\t\t\tresolve();\n\t\t\t});\n\t\t}\n\t}\n\n\tshow_discount_control() {\n\t\tthis.$add_discount_elem.css({ padding: \"0px\", border: \"none\" });\n\t\tthis.$add_discount_elem.html(`<div class=\"add-discount-field\"></div>`);\n\t\tconst me = this;\n\t\tconst frm = me.events.get_frm();\n\t\tlet discount = frm.doc.additional_discount_percentage;\n\n\t\tthis.discount_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Discount\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: discount ? discount + \"%\" : __(\"Enter discount percentage.\"),\n\t\t\t\tinput_class: \"input-xs\",\n\t\t\t\tonchange: function () {\n\t\t\t\t\tif (flt(this.value) != 0) {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tfrm.doc.doctype,\n\t\t\t\t\t\t\tfrm.doc.name,\n\t\t\t\t\t\t\t\"additional_discount_percentage\",\n\t\t\t\t\t\t\tflt(this.value)\n\t\t\t\t\t\t);\n\t\t\t\t\t\tme.hide_discount_control(this.value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\t\tfrm.doc.doctype,\n\t\t\t\t\t\t\tfrm.doc.name,\n\t\t\t\t\t\t\t\"additional_discount_percentage\",\n\t\t\t\t\t\t\t0\n\t\t\t\t\t\t);\n\t\t\t\t\t\tme.$add_discount_elem.css({\n\t\t\t\t\t\t\tborder: \"1px dashed var(--gray-500)\",\n\t\t\t\t\t\t\tpadding: \"var(--padding-sm) var(--padding-md)\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\tme.$add_discount_elem.html(`${me.get_discount_icon()} ${__(\"Add Discount\")}`);\n\t\t\t\t\t\tme.discount_field = undefined;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$add_discount_elem.find(\".add-discount-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.discount_field.toggle_label(false);\n\t\tthis.discount_field.set_focus();\n\t}\n\n\thide_discount_control(discount) {\n\t\tif (!discount) {\n\t\t\tthis.$add_discount_elem.css({ padding: \"0px\", border: \"none\" });\n\t\t\tthis.$add_discount_elem.html(`<div class=\"add-discount-field\"></div>`);\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css({\n\t\t\t\tborder: \"1px dashed var(--dark-green-500)\",\n\t\t\t\tpadding: \"var(--padding-sm) var(--padding-md)\",\n\t\t\t});\n\t\t\tthis.$add_discount_elem.html(\n\t\t\t\t`<div class=\"edit-discount-btn\">\n\t\t\t\t\t${this.get_discount_icon()} ${__(\"Additional\")}&nbsp;${String(discount).bold()}% ${__(\"discount applied\")}\n\t\t\t\t</div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tupdate_customer_section() {\n\t\tconst me = this;\n\t\tconst { customer, email_id = \"\", mobile_no = \"\", image, customer_name = \"\", customer_group = \"\" } = this.customer_info || {};\n\n\t\tif (customer) {\n\t\t\tthis.$customer_section.html(\n\t\t\t\t`<div class=\"customer-details\">\n\t\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t\t<div class=\"customer-name\"> ${customer_name} -  ${customer_group} </div>\n\t\t\t\t\t\t\t${get_customer_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t} else {\n\t\t\t// reset customer selector\n\t\t\tthis.reset_customer_selector();\n\t\t}\n\n\t\tfunction get_customer_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${__(\"Click to add email / phone\")}</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"customer-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"customer-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\n\n\t}\n\n\t//doctor\n\n\tupdate_doctor_section() {\n\t\tconst me = this;\n\t\tconst { doctor, first_name = \"\", last_name = \"\", prc_number = \"\", image } = this.doctor_info || {};\n\n\t\tif (doctor) {\n\t\t\tthis.$doctor_section.html(\n\t\t\t\t`<div class=\"doctor-details\">\n\t\t\t\t\t<div class=\"doctor-display\">\n\t\t\t\t\t\t${this.get_doctor_image()}\n\t\t\t\t\t\t<div class=\"doctor-name-desc\">\n\t\t\t\t\t\t\t<div class=\"doctor-name\">${doctor}</div>\n\t\t\t\t\t\t\t${get_doctor_description()}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"reset-doctors-btn\" data-doctors=\"${escape(doctors)}\">\n\t\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t} else {\n\t\t\t// reset doctor selector\n\t\t\tthis.reset_doctor_selector();\n\t\t}\n\n\t\tfunction get_doctor_description() {\n\t\t\tif (!email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"doctor-desc\">${__(\"Click to add email / phone\")}</div>`;\n\t\t\t} else if (email_id && !mobile_no) {\n\t\t\t\treturn `<div class=\"doctor-desc\">${email_id}</div>`;\n\t\t\t} else if (mobile_no && !email_id) {\n\t\t\t\treturn `<div class=\"doctor-desc\">${mobile_no}</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"doctorvv-desc\">${email_id} - ${mobile_no}</div>`;\n\t\t\t}\n\t\t}\n\n\t}\n\n\tget_customer_image() {\n\t\tconst { customer, image } = this.customer_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"customer-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"customer-image customer-abbr\">${frappe.get_abbr(customer)}</div>`;\n\t\t}\n\t}\n\n\tget_doctor_image() {\n\t\tconst { doctor, image } = this.doctor_info || {};\n\t\tif (image) {\n\t\t\treturn `<div class=\"doctor-image\"><img src=\"${image}\" alt=\"${image}\"\"></div>`;\n\t\t} else {\n\t\t\treturn `<div class=\"doctor-image doctor-abbr\">${frappe.get_abbr(doctor)}</div>`;\n\t\t}\n\t}\n\n\tupdate_totals_section(frm) {\n\t\tif (!frm) frm = this.events.get_frm();\n\t\t// console.log(frm.doc);\n\t\t\n\t\tthis.render_vatable_sales(frm.doc.custom_vatable_sales);\n\t\tthis.render_vat_exempt_sales(frm.doc.custom_vat_exempt_sales);\n\t\tthis.render_zero_rated_sales(frm.doc.custom_zero_rated_sales);\n\t\t// this.render_vat(frm.doc.custom_vat_amount)\n\t\t// this.render_ex_total(frm.doc.custom_ex_total)\n\t\tthis.render_net_total(frm.doc.net_total);\n\t\tthis.render_total_item_qty(frm.doc.items);\n\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? frm.doc.grand_total\n\t\t\t: frm.doc.rounded_total;\n\t\t\t\n\t\tthis.render_grand_total(grand_total);\n\t\t// this.render_taxes(frm.doc.taxes);\n\t\tthis.render_total_vat(frm.doc.total_taxes_and_charges);\n\t}\n\n\trender_net_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".net-total-container\")\n\t\t\t.html(`<div style=\"font-size:12px;\">${__(\"Sub Total\")}</div> <div>${format_currency(value, currency)}</div>`);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-net-total\")\n\t\t\t.html(`<div>${__(\"Sub Total\")}: <span>${format_currency(value, currency)}</span></div>`);\n\t}\n\n\trender_vatable_sales(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".vatable-sales-container\")\n\t\t\t.html(`\n\t\t\t\t<div style=\"display: flex; align-items: center; width: 100%; font-size:12px;\">\n\t\t\t\t\t<span style=\"flex: 1;\">\n\t\t\t\t\t\t${__(\"VATable Sales\")}: \n\t\t\t\t\t</span>\n\t\t\t\t\t<span style=\"flex-shrink: 0;  \">${format_currency(value, currency)}</span>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t}\n\t\n\n\trender_vat_exempt_sales(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".vat-exempt-container\")\n\t\t\t.html(`\n\t\t\t\t<div style=\"display: flex; align-items: center; width: 100%; font-size:12px;\">\n\t\t\t\t\t<span style=\"flex: 1;\">\n\t\t\t\t\t\t${__(\"VAT-Exempt Sales\")}: \n\t\t\t\t\t</span>\n\t\t\t\t\t<span style=\"flex-shrink: 0;\">${format_currency(value, currency)}</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t}\n\n\trender_zero_rated_sales(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".zero-rated-container\")\n\t\t\t.html(`\n\t\t\t\t<div style=\"display: flex; align-items: center; width: 100%; font-size:12px;\">\n\t\t\t\t\t<span style=\"flex: 1;\">\n\t\t\t\t\t\t${__(\"Zero Rated Sales\")}: \n\t\t\t\t\t</span>\n\t\t\t\t\t<span style=\"flex-shrink: 0;\">${format_currency(value, currency)}</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t}\n\n\trender_vat(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".vat-container\")\n\t\t\t.html(`\n\t\t\t\t<div style=\"display: flex; align-items: center; width: 100%; font-size:12px;\">\n\t\t\t\t\t<span style=\"flex: 1;\">\n\t\t\t\t\t\t${__(\"VAT 12%\")}:\n\t\t\t\t\t</span>\n\t\t\t\t\t<span style=\"flex-shrink: 0;\">${format_currency(value, currency)}</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t}\n\n\trender_total_vat(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".total-vat-container\")\n\t\t\t.html(`\n\t\t\t\t<div style=\"display: flex; justify-content: space-between; font-size:12px;\">\n\t\t\t\t\t<span style=\"flex: 1;\">${__(\"Total VAT\")}: </span>\n\t\t\t\t\t<span style=\"flex-shrink: 0;\">${format_currency(value, currency)}</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t}\n\n\trender_ex_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".ex-total-container\")\n\t\t\t.html(`\n\t\t\t\t<div style=\"display: flex; align-items: center; width: 100%; font-size:10px;>\n\t\t\t\t\t<span style=\"flex: 1;\">\n\t\t\t\t\t\t${__(\"Ex Total\")}: \n\t\t\t\t\t</span>\n\t\t\t\t\t<span style=\"flex-shrink: 0;\">${format_currency(value, currency)}</span>\n\t\t\t\t</div>\n\t\t\t`);\n\t}\n\n\n\n\trender_total_item_qty(items) {\n\t\tvar total_item_qty = 0;\n\t\titems.map((item) => {\n\t\t\ttotal_item_qty = total_item_qty + item.qty;\n\t\t});\n\n\t\tthis.$totals_section\n\t\t\t.find(\".item-qty-total-container\")\n\t\t\t.html(`<div>${__(\"Total Quantity\")}</div><div>${total_item_qty}</div>`);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-item-qty-total\")\n\t\t\t.html(`<div>${__(\"Total Quantity\")}: <span>${total_item_qty}</span></div>`);\n\t}\n\n\trender_grand_total(value) {\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tthis.$totals_section\n\t\t\t.find(\".grand-total-container\")\n\t\t\t.html(`<div style=\"font-size:14px;\">${__(\"Total\")}</div><div>${format_currency(value, currency)}</div>`);\n\n\t\tthis.$numpad_section\n\t\t\t.find(\".numpad-grand-total\")\n\t\t\t.html(`<div>${__(\"Total\")}: <span>${format_currency(value, currency)}</span></div>`);\n\t}\n\n\trender_taxes(taxes) {\n\t\tif (taxes && taxes.length) {\n\t\t\tconst currency = this.events.get_frm().doc.currency;\n\t\t\tconst taxes_html = taxes\n\t\t\t\t.map((t) => {\n\t\t\t\t\tif (t.tax_amount_after_discount_amount == 0.0) return;\n\t\t\t\t\t// if tax rate is 0, don't print it.\n\t\t\t\t\tconst description = /[0-9]+/.test(t.description)\n\t\t\t\t\t\t? t.description\n\t\t\t\t\t\t: t.rate != 0\n\t\t\t\t\t\t? `${t.description} @ ${t.rate}%`\n\t\t\t\t\t\t: t.description;\n\t\t\t\t\treturn `<div class=\"tax-row\">\n\t\t\t\t\t<div class=\"tax-label\">${description}</div>\n\t\t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, currency)}</div>\n\t\t\t\t</div>`;\n\t\t\t\t})\n\t\t\t\t.join(\"\");\n\t\t\tthis.$totals_section.find(\".taxes-container\").css(\"display\", \"flex\").html(taxes_html);\n\t\t} else {\n\t\t\tthis.$totals_section.find(\".taxes-container\").css(\"display\", \"none\").html(\"\");\n\t\t}\n\t}\n\n\tget_cart_item({ name }) {\n\t\tconst item_selector = `.cart-item-wrapper[data-row-name=\"${escape(name)}\"]`;\n\t\treturn this.$cart_items_wrapper.find(item_selector);\n\t}\n\n\tget_item_from_frm(item) {\n\t\tconst doc = this.events.get_frm().doc;\n\t\treturn doc.items.find((i) => i.name == item.name);\n\t}\n\n\tupdate_item_html(item, remove_item) {\n\t\tconst $item = this.get_cart_item(item);\n\t\t// Retrieve current cart items from local storage\n\t\tlet cartItems = JSON.parse(localStorage.getItem('posCartItems')) || [];\n\t\n\t\tif (remove_item) {\n\t\t\tif ($item) {\n\t\t\t\t$item.next().remove();\n\t\t\t\t$item.remove();\n\t\n\t\t\t\t// Remove the item from the local storage cart items\n\t\t\t\tcartItems = cartItems.filter(cartItem => cartItem.item_code !== item.item_code);\n\t\t\t\t\n\t\t\t\tlocalStorage.setItem('posCartItems', JSON.stringify(cartItems));\n\t\n\t\t\t\tthis.remove_customer(); // Call remove_customer function after removing item\n\t\t\t\tthis.set_cash_customer(); // Set customer to \"Cash\" after removing item\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t]);\n\t\t\t}\n\t\t} else {\n\t\t\tconst item_row = this.get_item_from_frm(item);\n\n\t\t\tthis.render_cart_item(item_row, $item);\n\t\n\t\t\t// Add or update the item in the local storage cart items\n\t\t\tconst existingItemIndex = cartItems.findIndex(cartItem => cartItem.item_code === item.item_code);\n\t\t\tif (existingItemIndex > -1) {\n\t\t\t\tcartItems[existingItemIndex] = item; // Update existing item\n\t\t\t} else {\n\t\t\t\tcartItems.push(item); // Add new item\n\t\t\t}\n\t\t\tlocalStorage.setItem('posCartItems', JSON.stringify(cartItems));\n\t\t\t// console.log('cartItems', cartItems)\n\t\t}\n\t\n\t\tconst no_of_cart_items = this.$cart_items_wrapper.find(\".cart-item-wrapper\").length;\n\t\tthis.highlight_checkout_btn(no_of_cart_items > 0);\n\t\tthis.update_empty_cart_section(no_of_cart_items);\n\t}\n\n\n\tremove_customer() {\n\t\tconst frm = this.events.get_frm();\n\t\t// Get the current value of the \"customer\" field\n\t\tconst currentCustomer = frm.doc.customer;\n\t\n\t\t// Set the value of \"custom_customer_2\" to the current customer\n\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, \"custom_customer_2\", currentCustomer);\n\t\n\t\t// Clear the \"customer\" field\n\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, \"customer\", '');\n\t\t// Update the customer section\n\t\tthis.update_customer_section();\n\t}\n\n\tset_cash_customer() {\n\t\tconst frm = this.events.get_frm();\n\t\n\t\t// Get the value of \"custom_customer_2\"\n\t\tconst customCustomer2Value = frm.doc.custom_customer_2;\n\t\n\t\t// Set the value of \"customer\" to the value of \"custom_customer_2\"\n\t\tfrappe.model.set_value(frm.doc.doctype, frm.doc.name, \"customer\", customCustomer2Value);\n\t\t// Update the customer section\n\t\tthis.update_customer_section();\n\t}\n\n\trender_cart_item(item_data, $item_to_update) {\n\n\t\t// console.log(\"Item Data: \",item_data)\n\n\t\tconst currency = this.events.get_frm().doc.currency;\n\t\tconst me = this;\n\t\tconst customer_group = me.events.get_frm().doc.customer_group\n\t\tconst tax_rate = 0.12;\n\t\tconst no_vat = item_data.price_list_rate / (1 + tax_rate);\n\n\t\t// const item_doc = frappe.get_doc('Item', item_data.item_name)\n\t\t// console.log(\"Item Doc: \", item_doc);\n\n\t\tif (!$item_to_update.length) {\n\t\t\tthis.$cart_items_wrapper.append(\n\t\t\t\t`<div class=\"cart-item-wrapper\" tabindex=\"0\" data-row-name=\"${escape(item_data.name)}\" style=\"font-size: 12px; padding: 5px;\">\n\t\t\t\t\t<div class=\"separator\" style=\"height: 0.8px; background-color: #e0e0e0; margin: 4px 0;\"></div>`\n\t\t\t);\n\t\t\t$item_to_update = this.get_cart_item(item_data);\n\t\t}\n\t\t\n\t\t$item_to_update.html(\n\t\t\t`${get_item_image_html()}\n\t\t\t<div class=\"item-name-desc\" style=\"font-size: 10px;\">\n\t\t\t\t<div class=\"item-name\" style=\"font-size: 12px;\">\n\t\t\t\t\t${item_data.item_name}\n\t\t\t\t</div>\n\t\t\t\t${get_description_html()}\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"item-vat mx-3\" style=\"font-size: 10px;\">\n\t\t\t\t<strong>${getVatType(item_data)}</strong>\n\t\t\t</div> \n\t\t\t\n\t\t\t<div class=\"item-vat mx-3\" style=\"font-size: 10px;\">\n\t\t\t\t<strong>${format_currency(item_data.price_list_rate, currency)}</strong>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div class=\"item-discount mx-3\" style=\"font-size: 10px;\">\n\t\t\t\t<strong>${Math.round(item_data.discount_percentage)}%</strong>\n\t\t\t</div>\n\t\t\t${get_rate_discount_html(customer_group)}`\n\t\t);\n\t\t\n\n\t\tset_dynamic_rate_header_width();\n\n\t\tfunction set_dynamic_rate_header_width() {\n\t\t\tconst rate_cols = Array.from(me.$cart_items_wrapper.find(\".item-rate-amount\"));\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", \"\");\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", \"\");\n\t\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\t\tif ($(elm).width() > max_width) max_width = $(elm).width();\n\t\t\t\treturn max_width;\n\t\t\t}, 0);\n\n\t\t\tmax_width += 1;\n\t\t\tif (max_width === 1) max_width = \"\";\n\n\t\t\tme.$cart_header.find(\".rate-amount-header\").css(\"width\", max_width);\n\t\t\tme.$cart_items_wrapper.find(\".item-rate-amount\").css(\"width\", max_width);\n\t\t}\n\n\t\tfunction getVatType(item_data) {\n\t\t\tif (item_data.custom_vat_exempt_amount && item_data.custom_vat_exempt_amount != 0) {\n\t\t\t\treturn 'VAT-E';\n\t\t\t} else if (item_data.custom_vatable_amount && item_data.custom_vatable_amount != 0) {\n\t\t\t\treturn 'VAT';\n\t\t\t} else if (item_data.custom_zero_rated_amount && item_data.custom_zero_rated_amount != 0) {\n\t\t\t\treturn 'ZR';\n\t\t\t}else if (item_data.custom_free === 1) {\n\t\t\t\t\treturn 'FREE';\n\t\t\t\t\n\t\t\t} else {\n\n\t\t\t\treturn 'Unknown';\n\t\t\t}\n\t\t}\n\n\n\t\tfunction get_rate_discount_html(customer_group) {\n\n\n\t\t\tif (customer_group === \"Zero Rated\") {\n\n\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\" style=\"font-size:10px;\"><span>${item_data.qty || 0} ${item_data.uom}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"font-size:11px;\">${format_currency(item_data.custom_zero_rated_amount, currency)}</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\n\n\n\t\t\t} else if (customer_group === \"Senior Citizen\" || customer_group === \"PWD\") {\n\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t<div class=\"item-qty\" style=\"font-size:10px;\"><span>${item_data.qty || 0} ${item_data.uom}</span></div>\n\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"font-size:11px;\">${format_currency(\n\t\t\t\t\t\t\t\titem_data.pricing_rules === '[\\n \"PRLE-0005330\"\\n]' ? item_data.amount : \n\t\t\t\t\t\t\t\t(item_data.pricing_rules === \"\" ? item_data.amount : \n\t\t\t\t\t\t\t\t\t(item_data.custom_vatable_amount ? item_data.custom_vatable_amount : item_data.custom_vat_exempt_amount)\n\t\t\t\t\t\t\t\t), currency\n\t\t\t\t\t\t\t)}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\tif (item_data.rate && item_data.amount && item_data.rate !== item_data.amount) {\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\" style=\"font-size:10px;\"><span>${item_data.qty || 0} ${item_data.uom}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"font-size:11px;\">${format_currency(item_data.amount, currency)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t} else {\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<div class=\"item-qty-rate\">\n\t\t\t\t\t\t\t<div class=\"item-qty\" style=\"font-size:10px;\"><span>${item_data.qty || 0} ${item_data.uom}</span></div>\n\t\t\t\t\t\t\t<div class=\"item-rate-amount\">\n\t\t\t\t\t\t\t\t<div class=\"item-rate\" style=\"font-size:11px;\">${format_currency(item_data.rate, currency)}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction get_description_html() {\n\t\t\tif (item_data.description) {\n\t\t\t\tif (item_data.description.indexOf(\"<div>\") !== -1) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\titem_data.description = $(item_data.description).text();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\titem_data.description = item_data.description\n\t\t\t\t\t\t\t.replace(/<div>/g, \" \")\n\t\t\t\t\t\t\t.replace(/<\\/div>/g, \" \")\n\t\t\t\t\t\t\t.replace(/ +/g, \" \");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem_data.description = frappe.ellipsis(item_data.description, 45);\n\t\t\t\treturn `<div class=\"item-desc\" style=\"font-size:10px;\">${item_data.description}</div>`;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tfunction get_item_image_html() {\n\t\t\tconst { image, item_name } = item_data;\n\t\t\tif (!me.hide_images && image) {\n\t\t\t\treturn `\n\t\t\t\t\t<div class=\"item-image\">\n\t\t\t\t\t\t<img\n\t\t\t\t\t\t\tonerror=\"cur_pos.cart.handle_broken_image(this)\"\n\t\t\t\t\t\t\tsrc=\"${image}\" alt=\"${frappe.get_abbr(item_name)}\">\n\t\t\t\t\t</div>`;\n\t\t\t} else {\n\t\t\t\treturn `<div class=\"item-image item-abbr\">${frappe.get_abbr(item_name)}</div>`;\n\t\t\t}\n\t\t}\n\n\t\t// Event listener for handling keydown events on cart items\n\t\tthis.$cart_items_wrapper.off('keydown', '.cart-item-wrapper').on('keydown', '.cart-item-wrapper', function (event) {\n\t\t\tconst $items = me.$cart_items_wrapper.find('.cart-item-wrapper');\n\t\t\tconst currentIndex = $items.index($(this));\n\t\t\tlet nextIndex = currentIndex;\n\n\t\t\tswitch (event.which) {\n\t\t\t\tcase 13: // Enter key\n\t\t\t\t\t$(this).click(); // Trigger click event immediately on Enter key press\n\t\t\t\t\tbreak;\n\t\t\t\tcase 38: // Up arrow key\n\t\t\t\t\tnextIndex = currentIndex > 0 ? currentIndex - 1 : $items.length - 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 40: // Down arrow key\n\t\t\t\t\tnextIndex = currentIndex < $items.length - 1 ? currentIndex + 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn; // Exit if other keys are pressed\n\t\t\t}\n\n\t\t\t$items.eq(nextIndex).focus(); // Move focus to the next item\n\t\t});\n\n\t\t// Add Ctrl+C shortcut to focus on the first cart item\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'ctrl+c',\n\t\t\taction: () => {\n\t\t\t\tconst $items = me.$cart_items_wrapper.find('.cart-item-wrapper');\n\t\t\t\tif ($items.length) {\n\t\t\t\t\t$items.first().focus(); // Focus on the first cart item\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => me.$cart_items_wrapper.is(':visible'),\n\t\t\tdescription: __('Activate Cart Item Focus'),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page // Replace with your actual page context\n\t\t});\n\t}\n\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr(\"alt\");\n\t\t$($img).parent().replaceWith(`<div class=\"item-image item-abbr\">${item_abbr}</div>`);\n\t}\n\n\tupdate_selector_value_in_cart_item(selector, value, item) {\n\t\tconst $item_to_update = this.get_cart_item(item);\n\t\t$item_to_update.attr(`data-${selector}`, escape(value));\n\t}\n\n\ttoggle_checkout_btn(show_checkout) {\n\t\tif (show_checkout) {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"flex\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"none\");\n\t\t} else {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"none\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"flex\");\n\t\t}\n\t}\n\n\thighlight_checkout_btn(toggle) {\n\t\tif (toggle) {\n\t\t\tthis.$add_discount_elem.css(\"display\", \"flex\");\n\t\t\tthis.$cart_container.find(\".checkout-btn\").css({\n\t\t\t\t\"background-color\": \"var(--blue-500)\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$add_discount_elem.css(\"display\", \"none\");\n\t\t\tthis.$cart_container.find(\".checkout-btn\").css({\n\t\t\t\t\"background-color\": \"var(--blue-200)\",\n\t\t\t});\n\t\t}\n\t}\n\n\tupdate_empty_cart_section(no_of_cart_items) {\n\t\tconst $no_item_element = this.$cart_items_wrapper.find(\".no-item-wrapper\");\n\n\t\t// if cart has items and no item is present\n\t\tno_of_cart_items > 0 &&\n\t\t\t$no_item_element &&\n\t\t\t$no_item_element.remove() &&\n\t\t\tthis.$cart_header.css(\"display\", \"flex\");\n\n\t\tno_of_cart_items === 0 && !$no_item_element.length && this.make_no_items_placeholder();\n\t}\n\n\ton_numpad_event($btn) {\n\t\tconst current_action = $btn.attr(\"data-button-value\");\n\t\tconst action_is_field_edit = [\"qty\", \"discount_percentage\", \"rate\"].includes(current_action);\n\t\tconst action_is_allowed = action_is_field_edit\n\t\t\t? (current_action == \"rate\" && this.allow_rate_change) ||\n\t\t\t  (current_action == \"discount_percentage\" && this.allow_discount_change) ||\n\t\t\t  current_action == \"qty\"\n\t\t\t: true;\n\n\t\tconst action_is_pressed_twice = this.prev_action === current_action;\n\t\tconst first_click_event = !this.prev_action;\n\t\tconst field_to_edit_changed = this.prev_action && this.prev_action != current_action;\n\n\t\tif (action_is_field_edit) {\n\t\t\tif (!action_is_allowed) {\n\t\t\t\tconst label = current_action == \"rate\" ? \"Rate\".bold() : \"Discount\".bold();\n\t\t\t\tconst message = __(\"Editing {0} is not allowed as per POS Profile settings\", [label]);\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\tmessage: message,\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (first_click_event || field_to_edit_changed) {\n\t\t\t\tthis.prev_action = current_action;\n\t\t\t} else if (action_is_pressed_twice) {\n\t\t\t\tthis.prev_action = undefined;\n\t\t\t}\n\t\t\tthis.numpad_value = \"\";\n\t\t} else if (current_action === \"checkout\") {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else if (current_action === \"remove\") {\n\t\t\tthis.prev_action = undefined;\n\t\t\tthis.toggle_item_highlight();\n\t\t\tthis.events.numpad_event(undefined, current_action);\n\t\t\treturn;\n\t\t} else {\n\t\t\tthis.numpad_value =\n\t\t\t\tcurrent_action === \"delete\"\n\t\t\t\t\t? this.numpad_value.slice(0, -1)\n\t\t\t\t\t: this.numpad_value + current_action;\n\t\t\tthis.numpad_value = this.numpad_value || 0;\n\t\t}\n\n\t\tconst first_click_event_is_not_field_edit = !action_is_field_edit && first_click_event;\n\n\t\tif (first_click_event_is_not_field_edit) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tindicator: \"red\",\n\t\t\t\tmessage: __(\"Please select a field to edit from numpad\"),\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (flt(this.numpad_value) > 100 && this.prev_action === \"discount_percentage\") {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Discount cannot be greater than 100%\"),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\tthis.numpad_value = current_action;\n\t\t}\n\n\t\tthis.highlight_numpad_btn($btn, current_action);\n\t\tthis.events.numpad_event(this.numpad_value, this.prev_action);\n\t}\n\n\thighlight_numpad_btn($btn, curr_action) {\n\t\tconst curr_action_is_highlighted = $btn.hasClass(\"highlighted-numpad-btn\");\n\t\tconst curr_action_is_action = [\"qty\", \"discount_percentage\", \"rate\", \"done\"].includes(curr_action);\n\n\t\tif (!curr_action_is_highlighted) {\n\t\t\t$btn.addClass(\"highlighted-numpad-btn\");\n\t\t}\n\t\tif (this.prev_action === curr_action && curr_action_is_highlighted) {\n\t\t\t// if Qty is pressed twice\n\t\t\t$btn.removeClass(\"highlighted-numpad-btn\");\n\t\t}\n\t\tif (this.prev_action && this.prev_action !== curr_action && curr_action_is_action) {\n\t\t\t// Order: Qty -> Rate then remove Qty highlight\n\t\t\tconst prev_btn = $(`[data-button-value='${this.prev_action}']`);\n\t\t\tprev_btn.removeClass(\"highlighted-numpad-btn\");\n\t\t}\n\t\tif (!curr_action_is_action || curr_action === \"done\") {\n\t\t\t// if numbers are clicked\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass(\"highlighted-numpad-btn\");\n\t\t\t}, 200);\n\t\t}\n\t}\n\n\ttoggle_numpad(show) {\n\t\tif (show) {\n\t\t\tthis.$totals_section.css(\"display\", \"none\");\n\t\t\tthis.$numpad_section.css(\"display\", \"flex\");\n\t\t} else {\n\t\t\tthis.$totals_section.css(\"display\", \"flex\");\n\t\t\tthis.$numpad_section.css(\"display\", \"none\");\n\t\t}\n\t\tthis.reset_numpad();\n\t}\n\n\treset_numpad() {\n\t\tthis.numpad_value = \"\";\n\t\tthis.prev_action = undefined;\n\t\tthis.$numpad_section.find(\".highlighted-numpad-btn\").removeClass(\"highlighted-numpad-btn\");\n\t}\n\n\ttoggle_numpad_field_edit(fieldname) {\n\t\tif ([\"qty\", \"discount_percentage\", \"rate\"].includes(fieldname)) {\n\t\t\tthis.$numpad_section.find(`[data-button-value=\"${fieldname}\"]`).click();\n\t\t}\n\t}\n\n\ttoggle_customer_info(show) {\n\t\tif (show) {\n\t\t\tconst { customer } = this.customer_info || {};\n\n\t\t\tthis.$cart_container.css(\"display\", \"none\");\n\t\t\tthis.$customer_section.css({\n\t\t\t\theight: \"100%\",\n\t\t\t\t\"padding-top\": \"0px\",\n\t\t\t});\n\t\t\tthis.$customer_section.find(\".customer-details\").html(\n\t\t\t\t`<div class=\"header\">\n\t\t\t\t\t<div class=\"label\">Contact Details</div>\n\t\t\t\t\t<div class=\"close-details-btn\">\n\t\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-display\">\n\t\t\t\t\t${this.get_customer_image()}\n\t\t\t\t\t<div class=\"customer-name-desc\">\n\t\t\t\t\t\t<div class=\"customer-name\">${customer}</div>\n\t\t\t\t\t\t<div class=\"customer-desc\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"customer-fields-container\">\n\t\t\t\t\t<div class=\"email_id-field\"></div>\n\t\t\t\t\t<div class=\"mobile_no-field\"></div>\n\t\t\t\t\t<div class=\"custom_osca_id-field\"></div>\n\t\t\t\t\t<div class=\"custom_pwd_id-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_program-field\"></div>\n\t\t\t\t\t<div class=\"loyalty_points-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"transactions-label\">Recent Transactions</div>`\n\t\t\t);\n\t\t\t// transactions need to be in diff div from sticky elem for scrolling\n\t\t\tthis.$customer_section.append(`<div class=\"customer-transactions\"></div>`);\n\n\t\t\tthis.render_customer_fields();\n\t\t\tthis.fetch_customer_transactions();\n\t\t} else {\n\t\t\tthis.$cart_container.css(\"display\", \"flex\");\n\t\t\tthis.$customer_section.css({\n\t\t\t\theight: \"\",\n\t\t\t\t\"padding-top\": \"\",\n\t\t\t});\n\n\t\t\tthis.update_customer_section();\n\t\t}\n\t}\n\n\trender_customer_fields() {\n\t\tconst $customer_form = this.$customer_section.find(\".customer-fields-container\");\n\n\t\tconst dfs = [\n\t\t\t{\n\t\t\t\tfieldname: \"email_id\",\n\t\t\t\tlabel: __(\"Email\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\toptions: \"email\",\n\t\t\t\tplaceholder: __(\"Enter customer's email\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"mobile_no\",\n\t\t\t\tlabel: __(\"Phone Number\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\"Enter customer's phone number\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"loyalty_program\",\n\t\t\t\tlabel: __(\"Loyalty Program\"),\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\toptions: \"Loyalty Program\",\n\t\t\t\tplaceholder: __(\"Select Loyalty Program\"),\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"loyalty_points\",\n\t\t\t\tlabel: __(\"Loyalty Points\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"custom_osca_id\",\n\t\t\t\tlabel: __(\"OSCA ID\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"custom_pwd_id\",\n\t\t\t\tlabel: __(\"PWD ID\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tread_only: 1,\n\t\t\t},\n\t\t];\n\n\t\tconst me = this;\n\t\tdfs.forEach((df) => {\n\t\t\tthis[`customer_${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\tdf: { ...df, onchange: handle_customer_field_change },\n\t\t\t\tparent: $customer_form.find(`.${df.fieldname}-field`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`customer_${df.fieldname}_field`].set_value(this.customer_info[df.fieldname]);\n\t\t});\n\n\t\tfunction handle_customer_field_change() {\n\t\t\tconst current_value = me.customer_info[this.df.fieldname];\n\t\t\tconst current_customer = me.customer_info.customer;\n\n\t\t\tif (this.value && current_value != this.value && this.df.fieldname != \"loyalty_points\") {\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.set_customer_info\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tfieldname: this.df.fieldname,\n\t\t\t\t\t\tcustomer: current_customer,\n\t\t\t\t\t\tvalue: this.value,\n\t\t\t\t\t},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (!r.exc) {\n\t\t\t\t\t\t\tme.customer_info[this.df.fieldname] = this.value;\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Customer contact updated successfully.\"),\n\t\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tfetch_customer_transactions() {\n\t\tfrappe.db\n\t\t\t.get_list(\"POS Invoice\", {\n\t\t\t\tfilters: { customer: this.customer_info.customer, docstatus: 1 },\n\t\t\t\tfields: [\"name\", \"grand_total\", \"status\", \"posting_date\", \"posting_time\", \"currency\", \"custom_invoice_series\"],\n\t\t\t\tlimit: 20,\n\t\t\t})\n\t\t\t.then((res) => {\n\t\t\t\tconst transaction_container = this.$customer_section.find(\".customer-transactions\");\n\n\t\t\t\tif (!res.length) {\n\t\t\t\t\ttransaction_container.html(\n\t\t\t\t\t\t`<div class=\"no-transactions-placeholder\">No recent transactions found</div>`\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst elapsed_time = moment(res[0].posting_date + \" \" + res[0].posting_time).fromNow();\n\t\t\t\tthis.$customer_section.find(\".customer-desc\").html(`Last transacted ${elapsed_time}`);\n\n\t\t\t\tres.forEach((invoice) => {\n\t\t\t\t\tconst posting_datetime = moment(invoice.posting_date + \" \" + invoice.posting_time).format(\n\t\t\t\t\t\t\"Do MMMM, h:mma\"\n\t\t\t\t\t);\n\t\t\t\t\tlet indicator_color = {\n\t\t\t\t\t\tPaid: \"green\",\n\t\t\t\t\t\tDraft: \"red\",\n\t\t\t\t\t\tReturn: \"gray\",\n\t\t\t\t\t\tConsolidated: \"blue\",\n\t\t\t\t\t};\n\n\t\t\t\t\ttransaction_container.append(\n\t\t\t\t\t\t`<div class=\"invoice-wrapper\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t\t\t<div class=\"invoice-name\">${invoice.custom_invoice_series}</div>\n\t\t\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t\t\t<div class=\"invoice-total\">\n\t\t\t\t\t\t\t\t${format_currency(invoice.grand_total, invoice.currency, 0) || 0}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class=\"invoice-status\">\n\t\t\t\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color[invoice.status]}\">\n\t\t\t\t\t\t\t\t\t<span>${invoice.status}</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"seperator\"></div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tattach_refresh_field_event(frm) {\n\t\t$(frm.wrapper).off(\"refresh-fields\");\n\t\t$(frm.wrapper).on(\"refresh-fields\", () => {\n\t\t\tif (frm.doc.items.length) {\n\t\t\t\tthis.$cart_items_wrapper.html(\"\");\n\t\t\t\tfrm.doc.items.forEach((item) => {\n\t\t\t\t\tthis.update_item_html(item);\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis.update_totals_section(frm);\n\t\t});\n\t}\n\n\tload_invoice() {\n\t\tconst frm = this.events.get_frm();\n\n\t\tthis.attach_refresh_field_event(frm);\n\n\t\tthis.fetch_customer_details(frm.doc.customer).then(() => {\n\t\t\tthis.events.customer_details_updated(this.customer_info);\n\t\t\tthis.update_customer_section();\n\t\t});\n\n\t\tthis.$cart_items_wrapper.html(\"\");\n\t\tif (frm.doc.items.length) {\n\t\t\tfrm.doc.items.forEach((item) => {\n\t\t\t\tthis.update_item_html(item);\n\t\t\t});\n\t\t} else {\n\t\t\tthis.make_no_items_placeholder();\n\t\t\tthis.highlight_checkout_btn(false);\n\t\t}\n\n\t\tthis.update_totals_section(frm);\n\n\t\tif (frm.doc.docstatus === 1) {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"none\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"none\");\n\t\t} else {\n\t\t\tthis.$totals_section.find(\".checkout-btn\").css(\"display\", \"flex\");\n\t\t\tthis.$totals_section.find(\".edit-cart-btn\").css(\"display\", \"none\");\n\t\t}\n\n\t\tthis.toggle_component(true);\n\t}\n\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css(\"display\", \"flex\") : this.$component.css(\"display\", \"none\");\n\t}\n};", "custom_app.PointOfSale.ItemDetails = class {\n\tconstructor({ wrapper, events, settings }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.hide_images = settings.hide_images;\n\t\tthis.allow_rate_change = settings.allow_rate_change;\n\t\tthis.allow_discount_change = settings.allow_discount_change;\n\t\tthis.current_item = {};\n\n\t\tthis.init_component();\n\t}\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_child_components();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(`<section class=\"item-details-container\" style=\"grid-column:span 3 / span 3;\"></section>`);\n\n\t\tthis.$component = this.wrapper.find(\".item-details-container\");\n\t}\n\n\tinit_child_components() {\n\t\tthis.$component.html(\n\t\t\t`<div class=\"item-details-header\">\n\t\t\t\t<div class=\"label\">${__(\"Item Details\")}</div>\n\t\t\t\t<div class=\"close-btn\">\n\t\t\t\t\t<svg width=\"32\" height=\"32\" viewBox=\"0 0 14 14\" fill=\"none\">\n\t\t\t\t\t\t<path d=\"M4.93764 4.93759L7.00003 6.99998M9.06243 9.06238L7.00003 6.99998M7.00003 6.99998L4.93764 9.06238L9.06243 4.93759\" stroke=\"#8D99A6\"/>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"item-display\">\n\t\t\t\t<div class=\"item-name-desc-price\">\n\t\t\t\t\t<div class=\"item-name\"></div>\n\t\t\t\t\t<div class=\"item-desc\"></div>\n\t\t\t\t\t<div class=\"item-price\"></div>\n\t\t\t\t\t<div class=\"expiry-date\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"item-image\"></div>\n\t\t\t</div>\n\t\t\t<div class=\"discount-section\"></div>\n\t\t\t<div class=\"form-container\"></div>\n\t\t\t<div class=\"serial-batch-container\"></div>`\n\t\t);\n\n\t\tthis.$item_name = this.$component.find(\".item-name\");\n\t\tthis.$item_description = this.$component.find(\".item-desc\");\n\t\tthis.$item_price = this.$component.find(\".item-price\");\n\t\tthis.$item_image = this.$component.find(\".item-image\");\n\t\tthis.$form_container = this.$component.find(\".form-container\");\n\t\tthis.$dicount_section = this.$component.find(\".discount-section\");\n\t\tthis.$serial_batch_container = this.$component.find(\".serial-batch-container\");\n\t}\n\n\n\n\tcompare_with_current_item(item) {\n\t\t// returns true if `item` is currently being edited\n\n\t\treturn item && item.name == this.current_item.name;\n\t}\n\n\tasync toggle_item_details_section(item) {\n\t\tconst current_item_changed = !this.compare_with_current_item(item);\n\n\t\t// if item is null or highlighted cart item is clicked twice\n\t\tconst hide_item_details = !Boolean(item) || !current_item_changed;\n\n\t\tif ((!hide_item_details && current_item_changed) || hide_item_details) {\n\t\t\t// if item details is being closed OR if item details is opened but item is changed\n\t\t\t// in both cases, if the current item is a serialized item, then validate and remove the item\n\t\t\tawait this.validate_serial_batch_item();\n\t\t}\n\n\t\tthis.events.toggle_item_selector(!hide_item_details);\n\t\tthis.toggle_component(!hide_item_details);\n\n\t\tif (item && current_item_changed) {\n\t\t\tthis.doctype = item.doctype;\n\t\t\tthis.item_meta = frappe.get_meta(this.doctype);\n\t\t\tthis.name = item.name;\n\t\t\tthis.item_row = item;\n\t\t\tthis.currency = this.events.get_frm().doc.currency;\n\n\t\t\tthis.current_item = item;\n\n\t\t\tthis.render_dom(item);\n\t\t\tthis.render_discount_dom(item);\n\t\t\tthis.render_form(item);\n\t\t\tthis.events.highlight_cart_item(item);\n\t\t} else {\n\t\t\tthis.current_item = {};\n\t\t}\n\t}\n\n\tvalidate_serial_batch_item() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst item_row = doc.items.find((item) => item.name === this.name);\n\n\t\tif (!item_row) return;\n\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_bundle_selected = !item_row.serial_and_batch_bundle;\n\n\t\tif ((serialized && no_bundle_selected) || (batched && no_bundle_selected)) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"Item is removed since no serial / batch no selected.\"),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"cancel\");\n\t\t\treturn this.events.remove_item_from_cart();\n\t\t}\n\t}\n\n\trender_dom(item) {\n\t\tlet { item_name, description, image, price_list_rate, } = item;\n\n\t\tfunction get_description_html() {\n\t\t\tif (description) {\n\t\t\t\tdescription =\n\t\t\t\t\tdescription.indexOf(\"...\") === -1 && description.length > 140\n\t\t\t\t\t\t? description.substr(0, 139) + \"...\"\n\t\t\t\t\t\t: description;\n\t\t\t\treturn description;\n\t\t\t}\n\t\t\treturn ``;\n\t\t}\n\n\t\tthis.$item_name.html(item_name);\n\t\tthis.$item_description.html(get_description_html());\n\t\tthis.$item_price.html(format_currency(price_list_rate, this.currency));\n\t\tif (!this.hide_images && image) {\n\t\t\tthis.$item_image.html(\n\t\t\t\t`<img\n\t\t\t\t\tonerror=\"cur_pos.item_details.handle_broken_image(this)\"\n\t\t\t\t\tclass=\"h-full\" src=\"${image}\"\n\t\t\t\t\talt=\"${frappe.get_abbr(item_name)}\"\n\t\t\t\t\tstyle=\"object-fit: cover;\">`\n\t\t\t);\n\t\t\t//camille\n\t\t} else {\n\t\t\tthis.$item_image.html(`<div class=\"item-abbr\">${frappe.get_abbr(item_name)}</div>`);\n\t\t}\n\n\t}\n\n\thandle_broken_image($img) {\n\t\tconst item_abbr = $($img).attr(\"alt\");\n\t\t$($img).replaceWith(`<div class=\"item-abbr\">${item_abbr}</div>`);\n\t}\n\n\trender_discount_dom(item) {\n\t\tif (item.discount_percentage) {\n\t\t\tthis.$dicount_section.html(\n\t\t\t\t`<div class=\"item-rate\">${format_currency(item.price_list_rate, this.currency)}</div>\n\t\t\t\t<div class=\"item-discount\">${item.discount_percentage}% off</div>`\n\t\t\t);\n\t\t\tthis.$item_price.html(format_currency(item.rate, this.currency));\n\t\t} else {\n\t\t\tthis.$dicount_section.html(``);\n\t\t}\n\t}\n\t\n\trender_form(item) {\n\t\tconst fields_to_display = this.get_form_fields(item);\n\t\tthis.$form_container.html(\"\");\n\t\n\t\t// Store the original rate\n\t\tthis.original_rate = item.rate;\n\t\n\t\tfields_to_display.forEach((fieldname, idx) => {\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"${fieldname}-control\" data-fieldname=\"${fieldname}\"></div>`\n\t\t\t);\n\t\n\t\t\tconst field_meta = this.item_meta.fields.find((df) => df.fieldname === fieldname);\n\t\t\tif (fieldname === \"discount_percentage\") {\n\t\t\t\tfield_meta.label = __(\"Discount (%)\");\n\t\t\t}\n\t\n\t\t\tconst me = this;\n\t\n\t\t\tthis[`${fieldname}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\t...field_meta,\n\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\tif (fieldname === \"uom\") {\n\t\t\t\t\t\t\t// If the selected field is UOM, calculate and display the conversion factor\n\t\t\t\t\t\t\tme.calculate_conversion_factor(this.value, item);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.events.form_updated(me.current_item, fieldname, this.value);\n\t\t\t\t\t\tme.is_oic_authenticated = false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tparent: this.$form_container.find(`.${fieldname}-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\t\n\t\t\tthis[`${fieldname}_control`].set_value(item[fieldname]);\n\t\n\t\t\t// Add event listener for discount_percentage and discount_amount field click\n\t\t\tif (fieldname === \"discount_percentage\" || fieldname === \"discount_amount\" || fieldname === \"rate\") {\n\t\t\t\tthis.$form_container.find(`.${fieldname}-control input`).on(\"focus\", function () {\n\t\t\t\t\tif (!me.is_oic_authenticated) {\n\t\t\t\t\t\tme.oic_authentication(fieldname, item);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\n\n\t\t});\n\t\n\t\tthis.make_auto_serial_selection_btn(item);\n\t\tthis.bind_custom_control_change_event();\n\t}\n\t\n\tcalculate_conversion_factor(selected_uom, item) {\n\t\tconst default_uom = item.stock_uom;\n\t\tconst conversion_factor = frappe.convert_uom(1, default_uom, selected_uom);\n\t\tconst amount = item.rate * conversion_factor;\n\t\n\t\t// Update the amount field\n\t\tthis.$item_price.html(format_currency(amount, this.currency));\n\t}\n\t\n\t\t// Function to trigger OTP authentication\n\t\toic_authentication(fieldname, item) {\n\t\t\tconst me = this;\n\t\t\tconst doc = me.events.get_frm()\n\t\t\t// Show password dialog for OIC authentication\n\t\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\t\ttitle: __('Authorization Required OIC'),\n\t\t\t\tfields: [\n\t\t\t\t\t{\n\t\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\t\treqd: 1\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action_label: __('Authorize'),\n\t\t\t\tprimary_action: (values) => {\n\t\t\t\t\tlet password = values.password;\n\t\t\t\n\t\t\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t\t\t\t\t\targs: { password: password},\n\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tif (r.message.name) {\n\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\tmessage: __('Verified'),\n\t\t\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\n\t\t\t\t\t\t\t\t\tme.enable_discount_input(fieldname);\n\t\t\t\t\t\t\t\t\tme.set_discount_log(doc, item, r)\n\t\t\t\t\t\t\t\t\tme.is_oic_authenticated = true;\n\t\t\n\t\t\t\t\t\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\tmessage: __('Incorrect password'),\n\t\t\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// Show alert for incorrect password or unauthorized user\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\t\tpasswordDialog.show();\n\t\t}\n\n\t\t\n\t\n\t\n\t\t\n\tset_discount_log(doc, item, r) {\n\t\tlet current_discount_log = doc.doc.custom_manual_dicsount || '';\n\t\tlet discount_log = `${item.item_code} - ${r.message.full_name} - ${frappe.datetime.now_datetime()}\\n`;\n\t\tlet updated_discount_log = current_discount_log + discount_log;\n\t\tdoc.set_value('custom_manual_dicsount', updated_discount_log);\n\t}\n\n\n\t// Function to enable input to discount_percentage field after OTP authentication\n\tenable_discount_input(fieldname) {\n\t\tthis.$form_container.find(`.${fieldname}-control input`).prop(\"disabled\", false);\n\t}\n\n\tget_form_fields(item) {\n\t\tconst fields = [\n\t\t\t\"custom_free\",\n\t\t\t\"qty\",\n\t\t\t'price_list_rate',\n\t\t\t\"rate\",\n\t\t\t\"uom\",\n\t\t\t// \"custom_expiry_date\",\n\t\t\t//\"conversion_factor\",\n\t\t\t\"discount_percentage\",\n\t\t\t\"discount_amount\", \n\t\t\t\"custom_batch_number\",\n\t\t\t\"custom_batch_expiry\",\n\t\t\t//\"custom_item_discount_amount\",\n\t\t\t//\"warehouse\",\n\t\t\t//\"actual_qty\",\n\t\t\t//\"price_list_rate\",\n\t\t\t// \"is_free_item\",\n\n\t\t\t'custom_vat_amount',\n\t\t\t'custom_vatable_amount',\n\t\t\t'custom_vat_exempt_amount',\n\t\t\t'custom_zero_rated_amount',\n\t\t\t//\"custom_free\",\n\t\t\t\"custom_remarks\",\n\t\t];\n\t\tif (item.has_serial_no) fields.push(\"serial_no\");\n\t\tif (item.has_batch_no) fields.push(\"batch_no\");\n\t\treturn fields;\n\t}\n\t\n\n\tmake_auto_serial_selection_btn(item) {\n\t\tif (item.has_serial_no || item.has_batch_no) {\n\t\t\tconst label = item.has_serial_no ? __(\"Select Serial No\") : __(\"Select Batch No\");\n\t\t\tthis.$form_container.append(\n\t\t\t\t`<div class=\"btn btn-sm btn-secondary auto-fetch-btn\">${label}</div>`\n\t\t\t);\n\t\t\tthis.$form_container.find(\".serial_no-control\").find(\"textarea\").css(\"height\", \"6rem\");\n\t\t}\n\t}\n\n\tbind_custom_control_change_event() {\n\t\tconst me = this;\n\t\t\n\n\t\t// Ensure frm.doc is checked for existence before accessing it\n\t\t\n\t\t// if (this.rate_control) {\n\t\t// \tthis.rate_control.df.onchange = function () {\n\t\t// \t\tif (this.value || flt(this.value) === 0) {\n\t\t// \t\t\tme.events.form_updated(me.current_item, \"rate\", this.value).then(() => {\n\t\t// \t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t// \t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t// \t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t// \t\t\t\tme.render_discount_dom(item_row);\n\t\t// \t\t\t});\n\t\t// \t\t}\n\t\t// \t};\n\t\t// \tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t// \tthis.rate_control.refresh();\n\t\t// }\n\n\t\t// if (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t// \tthis.discount_percentage_control.df.read_only = 1;\n\t\t// \tthis.discount_percentage_control.refresh();\n\t\t// }\n\n\n\t\tif (this.rate_control) {\n\t\t\t\n\t\t\tconst frm = me.events.get_frm();\n\t\t\t// Remove any existing onchange handler to avoid multiple handlers being attached\n\t\t\tthis.rate_control.df.onchange = null;\n\t\t\n\t\t\tthis.rate_control.df.onchange = function () {\n\t\t\t\tif (this.value || flt(this.value) === 0) {\n\t\t\t\t\t// Debounce to prevent multiple rapid changes from causing issues\n\t\t\t\t\tif (this._debounce) {\n\t\t\t\t\t\tclearTimeout(this._debounce);\n\t\t\t\t\t}\n\t\t\t\t\tthis._debounce = setTimeout(() => {\n\t\t\t\t\t\tme.events.form_updated(me.current_item, \"rate\", this.value).then(() => {\n\t\t\t\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\t\t\t\tconst doc = me.events.get_frm().doc;\n\t\t\t\t\t\t\tme.$item_price.html(format_currency(item_row.rate, doc.currency));\n\t\t\t\t\t\t\tme.render_discount_dom(item_row);\n\t\t\t\t\t\t});\n\t\t\t\t\t}, 200); // Adjust the debounce time as needed\n\t\t\t\t}\n\t\t\t};\n\t\t\t\n\n\t\t\tif (frm.doc.customer_group === 'Senior Citizen') {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tthis.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\t\tthis.rate_control.refresh();\n\t\t\t}\n\t\t\t\n\t\t\t// this.rate_control.df.read_only = !this.allow_rate_change;\n\t\t\t// this.rate_control.refresh();\n\t\t}\n\t\t// Ensure frm.doc is checked for existence before accessing it\n\t\t\n\t\t\n\t\t// if (this.discount_percentage_control && !this.allow_discount_change) {\n\t\t// \tthis.discount_percentage_control.df.read_only = 1;\n\t\t// \tthis.discount_percentage_control.refresh();\n\t\t// }\n\n\t\tif (me.events && me.events.get_frm() && me.events.get_frm().doc) {\n\t\t\tconst frm = me.events.get_frm();\n\t\t\tif (frm.doc.customer_group === 'Senior Citizen'|| frm.doc.customer_group === 'PWD' ) {\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tif (me.discount_percentage_control && !me.allow_discount_change) {\n\t\t\t\t\tme.discount_percentage_control.df.read_only = 1;\n\t\t\t\t\tme.discount_percentage_control.refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (this.warehouse_control) {\n\t\t\tthis.warehouse_control.df.reqd = 1;\n\t\t\tthis.warehouse_control.df.onchange = function () {\n\t\t\t\tif (this.value) {\n\t\t\t\t\tme.events.form_updated(me.current_item, \"warehouse\", this.value).then(() => {\n\t\t\t\t\t\tme.item_stock_map = me.events.get_item_stock_map();\n\t\t\t\t\t\tconst available_qty = me.item_stock_map[me.item_row.item_code][this.value][0];\n\t\t\t\t\t\tconst is_stock_item = Boolean(\n\t\t\t\t\t\t\tme.item_stock_map[me.item_row.item_code][this.value][1]\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (available_qty === undefined) {\n\t\t\t\t\t\t\tme.events.get_available_stock(me.item_row.item_code, this.value).then(() => {\n\t\t\t\t\t\t\t\t// item stock map is updated now reset warehouse\n\t\t\t\t\t\t\t\tme.warehouse_control.set_value(this.value);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (available_qty === 0 && is_stock_item) {\n\t\t\t\t\t\t\tme.warehouse_control.set_value(\"\");\n\t\t\t\t\t\t\tconst bold_item_code = me.item_row.item_code.bold();\n\t\t\t\t\t\t\tconst bold_warehouse = this.value.bold();\n\t\t\t\t\t\t\tfrappe.throw(\n\t\t\t\t\t\t\t\t__(\"Item Code: {0} is not available under warehouse {1}.\", [\n\t\t\t\t\t\t\t\t\tbold_item_code,\n\t\t\t\t\t\t\t\t\tbold_warehouse,\n\t\t\t\t\t\t\t\t])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tme.actual_qty_control.set_value(available_qty);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.warehouse_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tfilters: { company: this.events.get_frm().doc.company },\n\t\t\t\t};\n\t\t\t};\n\t\t\tthis.warehouse_control.refresh();\n\t\t}\n\n\t\tif (this.serial_no_control) {\n\t\t\tthis.serial_no_control.df.reqd = 1;\n\t\t\tthis.serial_no_control.df.onchange = async function () {\n\t\t\t\t!me.current_item.batch_no && (await me.auto_update_batch_no());\n\t\t\t\tme.events.form_updated(me.current_item, \"serial_no\", this.value);\n\t\t\t};\n\t\t\tthis.serial_no_control.refresh();\n\t\t}\n\n\t\tif (this.batch_no_control) {\n\t\t\tthis.batch_no_control.df.reqd = 1;\n\t\t\tthis.batch_no_control.df.get_query = () => {\n\t\t\t\treturn {\n\t\t\t\t\tquery: \"erpnext.controllers.queries.get_batch_no\",\n\t\t\t\t\tfilters: {\n\t\t\t\t\t\titem_code: me.item_row.item_code,\n\t\t\t\t\t\twarehouse: me.item_row.warehouse,\n\t\t\t\t\t\tposting_date: me.events.get_frm().doc.posting_date,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t};\n\t\t\tthis.batch_no_control.refresh();\n\t\t}\n\n\t\tif (this.uom_control) {\n\t\t\tthis.uom_control.df.onchange = function () {\n\t\t\t\tme.events.form_updated(me.current_item, \"uom\", this.value);\n\n\t\t\t\tconst item_row = frappe.get_doc(me.doctype, me.name);\n\t\t\t\tme.conversion_factor_control.df.read_only = item_row.stock_uom == this.value;\n\t\t\t\tme.conversion_factor_control.refresh();\n\t\t\t};\n\t\t}\n\n\t\tfrappe.model.on(\"POS Invoice Item\", \"*\", (fieldname, value, item_row) => {\n\t\t\tconst field_control = this[`${fieldname}_control`];\n\t\t\tconst item_row_is_being_edited = this.compare_with_current_item(item_row);\n\n\t\t\tif (item_row_is_being_edited && field_control && field_control.get_value() !== value) {\n\t\t\t\tfield_control.set_value(value);\n\t\t\t\tcur_pos.update_cart_html(item_row);\n\t\t\t}\n\t\t});\n\t}\n\n\tasync auto_update_batch_no() {\n\t\tif (this.serial_no_control && this.batch_no_control) {\n\t\t\tconst selected_serial_nos = this.serial_no_control\n\t\t\t\t.get_value()\n\t\t\t\t.split(`\\n`)\n\t\t\t\t.filter((s) => s);\n\t\t\tif (!selected_serial_nos.length) return;\n\n\t\t\t// find batch nos of the selected serial no\n\t\t\tconst serials_with_batch_no = await frappe.db.get_list(\"Serial No\", {\n\t\t\t\tfilters: { name: [\"in\", selected_serial_nos] },\n\t\t\t\tfields: [\"batch_no\", \"name\"],\n\t\t\t});\n\t\t\tconst batch_serial_map = serials_with_batch_no.reduce((acc, r) => {\n\t\t\t\tif (!acc[r.batch_no]) {\n\t\t\t\t\tacc[r.batch_no] = [];\n\t\t\t\t}\n\t\t\t\tacc[r.batch_no] = [...acc[r.batch_no], r.name];\n\t\t\t\treturn acc;\n\t\t\t}, {});\n\t\t\t// set current item's batch no and serial no\n\t\t\tconst batch_no = Object.keys(batch_serial_map)[0];\n\t\t\tconst batch_serial_nos = batch_serial_map[batch_no].join(`\\n`);\n\t\t\t// eg. 10 selected serial no. -> 5 belongs to first batch other 5 belongs to second batch\n\t\t\tconst serial_nos_belongs_to_other_batch =\n\t\t\t\tselected_serial_nos.length !== batch_serial_map[batch_no].length;\n\n\t\t\tconst current_batch_no = this.batch_no_control.get_value();\n\t\t\tcurrent_batch_no != batch_no && (await this.batch_no_control.set_value(batch_no));\n\n\t\t\tif (serial_nos_belongs_to_other_batch) {\n\t\t\t\tthis.serial_no_control.set_value(batch_serial_nos);\n\t\t\t\tthis.qty_control.set_value(batch_serial_map[batch_no].length);\n\n\t\t\t\tdelete batch_serial_map[batch_no];\n\t\t\t\tthis.events.clone_new_batch_item_in_frm(batch_serial_map, this.current_item);\n\t\t\t}\n\t\t}\n\t}\n\n\tbind_events() {\n\t\tthis.bind_auto_serial_fetch_event();\n\t\tthis.bind_fields_to_numpad_fields();\n\n\t\tthis.$component.on(\"click\", \".close-btn\", () => {\n\t\t\tthis.events.close_item_details();\n\t\t});\n\t}\n\n\tattach_shortcuts() {\n\t\tthis.wrapper.find(\".close-btn\").attr(\"title\", \"Esc\");\n\t\tfrappe.ui.keys.on(\"escape\", () => {\n\t\t\tconst item_details_visible = this.$component.is(\":visible\");\n\t\t\tif (item_details_visible) {\n\t\t\t\tthis.events.close_item_details();\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_fields_to_numpad_fields() {\n\t\tconst me = this;\n\t\tthis.$form_container.on(\"click\", \".input-with-feedback\", function () {\n\t\t\tconst fieldname = $(this).attr(\"data-fieldname\");\n\t\t\tif (this.last_field_focused != fieldname) {\n\t\t\t\tme.events.item_field_focused(fieldname);\n\t\t\t\tthis.last_field_focused = fieldname;\n\t\t\t}\n\t\t});\n\t}\n\n\tbind_auto_serial_fetch_event() {\n\t\tthis.$form_container.on(\"click\", \".auto-fetch-btn\", () => {\n\t\t\tlet frm = this.events.get_frm();\n\t\t\tlet item_row = this.item_row;\n\t\t\titem_row.type_of_transaction = \"Outward\";\n\n\t\t\tnew erpnext.SerialBatchPackageSelector(frm, item_row, (r) => {\n\t\t\t\tif (r) {\n\t\t\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, {\n\t\t\t\t\t\tserial_and_batch_bundle: r.name,\n\t\t\t\t\t\tqty: Math.abs(r.total_qty),\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css(\"display\", \"flex\") : this.$component.css(\"display\", \"none\");\n\t}\n};", "custom_app.PointOfSale.NumberPad = class {\n\tconstructor({ wrapper, events, cols, keys, css_classes, fieldnames_map }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.cols = cols;\n\t\tthis.keys = keys;\n\t\tthis.css_classes = css_classes || [];\n\t\tthis.fieldnames = fieldnames_map || {};\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tconst { cols, keys, css_classes, fieldnames } = this;\n\n\t\tfunction get_keys() {\n\t\t\treturn keys.reduce((a, row, i) => {\n\t\t\t\treturn (\n\t\t\t\t\ta +\n\t\t\t\t\trow.reduce((a2, number, j) => {\n\t\t\t\t\t\tconst class_to_append = css_classes && css_classes[i] ? css_classes[i][j] : \"\";\n\t\t\t\t\t\tconst fieldname =\n\t\t\t\t\t\t\tfieldnames && fieldnames[number]\n\t\t\t\t\t\t\t\t? fieldnames[number]\n\t\t\t\t\t\t\t\t: typeof number === \"string\"\n\t\t\t\t\t\t\t\t? frappe.scrub(number)\n\t\t\t\t\t\t\t\t: number;\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\ta2 +\n\t\t\t\t\t\t\t`<div class=\"numpad-btn ${class_to_append}\" data-button-value=\"${fieldname}\">${__(\n\t\t\t\t\t\t\t\tnumber\n\t\t\t\t\t\t\t)}</div>`\n\t\t\t\t\t\t);\n\t\t\t\t\t}, \"\")\n\t\t\t\t);\n\t\t\t}, \"\");\n\t\t}\n\n\t\tthis.wrapper.html(\n\t\t\t`<div class=\"numpad-container\">\n\t\t\t\t${get_keys()}\n\t\t\t</div>`\n\t\t);\n\t}\n\n\tbind_events() {\n\t\tconst me = this;\n\t\tthis.wrapper.on(\"click\", \".numpad-btn\", function () {\n\t\t\tconst $btn = $(this);\n\t\t\tme.events.numpad_event($btn);\n\t\t});\n\t}\n};\n", "/* eslint-disable no-unused-vars */\ncustom_app.PointOfSale.Payment = class {\n\tconstructor({ events, wrapper }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\t// this.initialize_numpad();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"payment-container\" style=\"grid-column:span 4 / span 4;\">\n\t\t\t\t<div class=\"fields-numpad-container\">\n\t\t\t\t\t<div class=\"fields-section\">\n\t\t\t\t\t\t<div class=\"section-label payment-section\">${__(\"Payment Method\")}</div>\n\t\t\t\t\t\t<div class=\"payment-modes\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"totals-section\">\n\t\t\t\t\t<div class=\"totals\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"submit-order-btn\">${__(\"Complete Order\")}</div>\n\t\t\t</section>`\n\t\t);\n\t\tthis.$component = this.wrapper.find(\".payment-container\");\n\t\tthis.$payment_modes = this.$component.find(\".payment-modes\");\n\t\tthis.$totals_section = this.$component.find(\".totals-section\");\n\t\tthis.$totals = this.$component.find(\".totals\");\n\t\tthis.$numpad = this.$component.find(\".number-pad\");\n\t\tthis.$invoice_fields_section = this.$component.find(\".fields-section\");\n\t}\n\n\tmake_invoice_fields_control() {\n\t\tfrappe.db.get_doc(\"POS Settings\", undefined).then((doc) => {\n\t\t\tconst fields = doc.invoice_fields;\n\t\t\tif (!fields.length) return;\n\n\t\t\tthis.$invoice_fields = this.$invoice_fields_section.find(\".invoice-fields\");\n\t\t\tthis.$invoice_fields.html(\"\");\n\t\t\tconst frm = this.events.get_frm();\n\n\t\t\tfields.forEach((df) => {\n\t\t\t\tthis.$invoice_fields.append(\n\t\t\t\t\t`<div class=\"invoice_detail_field ${df.fieldname}-field\" data-fieldname=\"${df.fieldname}\"></div>`\n\t\t\t\t);\n\t\t\t\tlet df_events = {\n\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\tfrm.set_value(this.df.fieldname, this.get_value());\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t\tif (df.fieldtype == \"Button\") {\n\t\t\t\t\tdf_events = {\n\t\t\t\t\t\tclick: function () {\n\t\t\t\t\t\t\tif (frm.script_manager.has_handlers(df.fieldname, frm.doc.doctype)) {\n\t\t\t\t\t\t\t\tfrm.script_manager.trigger(df.fieldname, frm.doc.doctype, frm.doc.docname);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis[`${df.fieldname}_field`] = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\t...df,\n\t\t\t\t\t\t...df_events,\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$invoice_fields.find(`.${df.fieldname}-field`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tthis[`${df.fieldname}_field`].set_value(frm.doc[df.fieldname]);\n\t\t\t});\n\t\t});\n\t}\n\n\tinitialize_numpad() {\n\t\tconst me = this;\n\t\tthis.number_pad = new erpnext.PointOfSale.NumberPad({\n\t\t\twrapper: this.$numpad,\n\t\t\tevents: {\n\t\t\t\tnumpad_event: function ($btn) {\n\t\t\t\t\tme.on_numpad_clicked($btn);\n\t\t\t\t},\n\t\t\t},\n\t\t\tcols: 3,\n\t\t\tkeys: [\n\t\t\t\t[1, 2, 3],\n\t\t\t\t[4, 5, 6],\n\t\t\t\t[7, 8, 9],\n\t\t\t\t[\".\", 0, \"Delete\"],\n\t\t\t],\n\t\t});\n\n\t\tthis.numpad_value = \"\";\n\t}\n\n\ton_numpad_clicked($btn) {\n\t\tconst button_value = $btn.attr(\"data-button-value\");\n\n\t\thighlight_numpad_btn($btn);\n\t\tthis.numpad_value =\n\t\t\tbutton_value === \"delete\" ? this.numpad_value.slice(0, -1) : this.numpad_value + button_value;\n\t\tthis.selected_mode.$input.get(0).focus();\n\t\tthis.selected_mode.set_value(this.numpad_value);\n\n\t\tfunction highlight_numpad_btn($btn) {\n\t\t\t$btn.addClass(\"shadow-base-inner bg-selected\");\n\t\t\tsetTimeout(() => {\n\t\t\t\t$btn.removeClass(\"shadow-base-inner bg-selected\");\n\t\t\t}, 100);\n\t\t}\n\t}\n\t\n\tbind_events() {\n\t\tconst me = this;\n\n\t\tfunction hideAllFields() {\n\t\t\t$(`.mode-of-payment-control`).hide();\n\t\t\t$(`.mobile-number`).hide();\n\t\t\t$(`.approval-code`).hide();\n\t\t\t$(`.reference-number`).hide();\n\t\t\t$(`.bank-name`).hide();\n\t\t\t$(`.holder-name`).hide();\n\t\t\t$(`.card_type_control`).hide();\n\t\t\t$(`.card-number`).hide();\n\t\t\t$(`.expiry-date`).hide();\n\t\t\t$(`.confirmation-code`).hide();\n\t\t\t$(`.cash-shortcuts`).hide();\n\t\t\t$(`.check-name`).hide();\n\t\t\t$(`.check-number`).hide();\n\t\t\t$(`.check-date`).hide();\n\t\t\t$(`.actual-gov-one`).hide();\n\t\t\t$(`.actual-gov-two`).hide();\n\t\t\t$(`.payment-type`).hide();\n\t\t\t$(`.bank-type`).hide();\n\t\t\t$(`.qr-reference-number`).hide();\n\t\t\t$(`.customer`).hide();\n\t\t\t$(`.charge-invoice-number`).hide();\n\t\t\t$(`.po-number`).hide();\n\t\t\t$(`.representative`).hide();\n\t\t\t$(`.id-number`).hide();\n\t\t\t$(`.approved-by`).hide();\n\t\t\t$(`.gift-code`).hide();\n\t\t\t$(`.button-code`).hide();\n\t\t\t$(`.amesco-code`).hide();\n\t\t\t$(`.button-amesco-plus`).hide();\n\t\t\t$(`.save-button`).hide();\n\t\t\t$(`.discard-button`).hide();\n\t\t\t$(`.cash-button`).hide();\n\t\t\tme.$payment_modes.find(`.pay-amount`).css(\"display\", \"inline\");\n\t\t\tme.$payment_modes.find(`.loyalty-amount-name`).hide();\n\t\t}\n\t\n\t\tfunction focusAndHighlightAmountField(mode_clicked) {\n\t\t\tconst $amountField = mode_clicked.find(\".frappe-control.input-max-width[data-fieldtype='Currency'] input\");\n\t\t\t$amountField.focus();\n\t\t\t$amountField[0].setSelectionRange(0, $amountField.val().length);\n\t\t}\n\n\t\tthis.$payment_modes.on(\"click\", \".mode-of-payment\", function (e) {\n\t\t\tconst mode_clicked = $(this);\n\t\t\tif (!$(e.target).is(mode_clicked)) return;\n\t\n\t\t\tconst scrollLeft = mode_clicked.offset().left - me.$payment_modes.offset().left + me.$payment_modes.scrollLeft();\n\t\t\tme.$payment_modes.animate({ scrollLeft });\n\t\n\t\t\tconst mode = mode_clicked.attr(\"data-mode\");\n\t\n\t\t\t// Hide all fields first\n\t\t\thideAllFields();\n\t\n\t\t\t// Remove highlight from all mode-of-payments\n\t\t\t$(\".mode-of-payment\").removeClass(\"border-primary\");\n\t\n\t\t\tif (mode_clicked.hasClass(\"border-primary\")) {\n\t\t\t\t// Clicked one is selected then unselect it\n\t\t\t\tmode_clicked.removeClass(\"border-primary\");\n\t\t\t\thideAllFields();\n\t\t\t} else {\n\t\t\t\t// Clicked one is not selected then select it\n\t\t\t\tmode_clicked.addClass(\"border-primary\");\n\t\n\t\t\t\t// Show relevant fields based on mode\n\t\t\t\tmode_clicked.find(\".mode-of-payment-control\").css(\"display\", \"flex\");\n\t\t\t\tmode_clicked.find(\".cash-button\").css(\"display\", \"flex\");\n\t\t\t\tif (mode === \"gcash\" || mode === \"paymaya\") {\n\t\t\t\t\tmode_clicked.find(\".mobile-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".reference-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"cards\" || mode === \"debit_card\" || mode === \"credit_card\") {\n\t\t\t\t\tmode_clicked.find(\".bank-name\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".holder-name\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".card_type_control\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".card-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".expiry-date\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".approval-code\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"cheque\") {\n\t\t\t\t\tmode_clicked.find(\".bank-name\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".check-name\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".check-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".check-date\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"2307g\") {\n\t\t\t\t\tmode_clicked.find(\".actual-gov-one\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"2307\") {\n\t\t\t\t\tmode_clicked.find(\".actual-gov-two\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"qr_payment\") {\n\t\t\t\t\tmode_clicked.find(\".payment-type\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".bank-type\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".qr-reference-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"charge\") {\n\t\t\t\t\tmode_clicked.find(\".customer\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".charge-invoice-number\").css(\"display\",\"flex\");\n\t\t\t\t\tmode_clicked.find(\".po-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".representative\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".id-number\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".approved-by\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".save-button\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"gift_certificate\") {\n\t\t\t\t\tmode_clicked.find(\".gift-code\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".button-code\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} else if (mode === \"amesco_plus\") {\n\t\t\t\t\tmode_clicked.find(\".amesco-code\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".button-amesco-plus\").css(\"display\", \"flex\");\n\t\t\t\t\tmode_clicked.find(\".discard-button\").css(\"display\", \"flex\");\n\t\t\t\t} \n\t\t\t\tfocusAndHighlightAmountField(mode_clicked);\n\t\t\t\t// me.selected_mode = me[`${mode}_control`];\n\t\t\t\tme.selected_mode && me.selected_mode.$input.get();\n\t\t\t\tme.auto_set_remaining_amount();\n\t\t\t}\n\t\t});\n\n\t\t// Hide all fields if clicking outside mode-of-payment\n\t\t$(document).on(\"click\", function (e) {\n\t\t\tconst target = $(e.target);\n\t\t\tif (!target.closest(\".mode-of-payment\").length) {\n\t\t\t\thideAllFields();\n\t\t\t\t$(\".mode-of-payment\").removeClass(\"border-primary\");\n\t\t\t}\n\t\t});\n\n\n\t\t\n\t\t\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"contact_mobile\", (frm) => {\n\t\t\tconst contact = frm.doc.contact_mobile;\n\t\t\tconst request_button = $(this.request_for_payment_field?.$input[0]);\n\t\t\tif (contact) {\n\t\t\t\trequest_button.removeClass(\"btn-default\").addClass(\"btn-primary\");\n\t\t\t} else {\n\t\t\t\trequest_button.removeClass(\"btn-primary\").addClass(\"btn-default\");\n\t\t\t}\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"coupon_code\", (frm) => {\n\t\t\tif (frm.doc.coupon_code && !frm.applying_pos_coupon_code) {\n\t\t\t\tif (!frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrm.applying_pos_coupon_code = true;\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => (frm.doc.ignore_pricing_rule = 1),\n\t\t\t\t\t\t() => frm.trigger(\"ignore_pricing_rule\"),\n\t\t\t\t\t\t() => (frm.doc.ignore_pricing_rule = 0),\n\t\t\t\t\t\t() => frm.trigger(\"apply_pricing_rule\"),\n\t\t\t\t\t\t() => frm.save(),\n\t\t\t\t\t\t() => this.update_totals_section(frm.doc),\n\t\t\t\t\t\t() => (frm.applying_pos_coupon_code = false),\n\t\t\t\t\t]);\n\t\t\t\t} else if (frm.doc.ignore_pricing_rule) {\n\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\tmessage: __(\"Ignore Pricing Rule is enabled. Cannot apply coupon code.\"),\n\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.setup_listener_for_payments();\n\n\t\tthis.$payment_modes.on(\"click\", \".shortcut\", function () {\n\t\t\tconst value = $(this).attr(\"data-value\");\n\t\t\tme.selected_mode.set_value(value);\n\t\t});\n\n\t\tthis.$component.on(\"click\", \".submit-order-btn\", () => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst paid_amount = parseFloat(doc.paid_amount).toFixed(2);  // Convert to 2 decimal places\n\t\t\tconst items = doc.items;\n\t\t\tconst payments = doc.payments;\n\t\t\t\n\t\t\n\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t? parseFloat(doc.grand_total).toFixed(2)  // Convert to 2 decimal places\n\t\t\t\t: parseFloat(doc.rounded_total).toFixed(2);  // Convert to 2 decimal places\n\t\t\n\t\t\t// Validate that there are items and a non-zero paid amount\n\t\t\tif (paid_amount === 0 || !items.length) {\n\t\t\t\tconst message = items.length\n\t\t\t\t\t? __(\"You cannot submit the order without payment.\")\n\t\t\t\t\t: __(\"You cannot submit an empty order.\");\n\t\t\t\tfrappe.show_alert({ message, indicator: \"orange\" });\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\n\t\t\tconst total_paid_amount = payments.reduce((sum, p) => sum + (p.amount || 0), 0);\n\n\t\t\t// Round to 2 decimal places to avoid floating-point precision issues\n\t\t\tconst rounded_total_paid = parseFloat(total_paid_amount).toFixed(2);\n\t\t\tconst rounded_grand_total = parseFloat(grand_total).toFixed(2);\n\n\t\t\tconst cash_payment_present = payments.some(p => p.mode_of_payment === 'Cash' || p.mode_of_payment === 'Gift Certificate' && p.amount > 0);\n\n\t\t\t// Compare the rounded values\n\t\t\tif (parseFloat(rounded_total_paid) > parseFloat(rounded_grand_total) && !cash_payment_present) {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"Paid amount cannot be greater than the grand total for non-cash payments.\"),\n\t\t\t\t\tindicator: \"orange\"\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\n\t\t\t// Validate fields based on payment method\n\t\t\tif (!validate_payment_methods(doc)) {\n\t\t\t\treturn; // Stop submission if validation fails\n\t\t\t}\n\t\t\n\t\t\t// If all validations pass, submit the invoice\n\t\t\tthis.events.submit_invoice();\n\t\t});\n\t\t\n\t\t/**\n\t\t * Function to validate required fields based on the selected payment methods\n\t\t */\n\t\tfunction validate_payment_methods(doc) {\n\t\t\tlet has_error = false;\n\t\t\n\t\t\t// Iterate over payment modes in the payment entry\n\t\t\tdoc.payments.forEach(p => {\n\t\t\t\tconst payment_method = p.mode_of_payment ? p.mode_of_payment.trim() : null; // Ensure it's defined and trimmed\n\t\t\t\tconst amount = p.amount || 0; // Get the amount for this payment method\n\t\t\t\t\n\n\t\t\t\t// Only validate if the payment method has an amount\n\t\t\t\tif (amount > 0) {\n\t\t\t\t\tif (!payment_method) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"No payment method selected.\"),\n\t\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\t// Use switch case to handle validation for each payment method\n\t\t\t\t\tswitch (payment_method) {\n\n\t\t\t\t\t\tcase 'Cash':\n\t\t\t\t\t\t\tconst cash_missing_fields = validate_fields(['amount'], p);\n\t\t\t\t\t\t\tif (cash_missing_fields.length) {\n\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for Cash payment: {0}', [cash_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\n\t\t\t\t\t\tcase 'Gift Certificate':\n\t\t\t\t\t\tcase 'Amesco Plus':\n\t\t\t\t\t\t\tconst gc_missing_fields = validate_fields(['amount'], p);\n\t\t\t\t\t\t\tif (gc_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for Amesco Plus payment: {0}', [gc_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\n\t\t\t\t\t\tcase 'Charge':\n\t\t\t\t\t\t\tconst missing_fields = validate_fields(['amount', 'custom_customer', 'custom_charge_invoice_number', 'custom_po_number', 'custom_representative', 'custom_id_number'], p);\n\t\t\t\t\t\t\tif (missing_fields.length) {\n\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for Charge payment: {0}', [missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'Debit Card':\n\t\t\t\t\t\tcase 'Credit Card':\n\t\t\t\t\t\t\t\tconst debit_missing_fields = validate_fields(['amount', 'custom_bank_name', 'custom_card_name', 'custom_card_number', 'custom_card_expiration_date', 'custom_approval_code'], p);\n\t\t\t\t\t\t\t\tif (debit_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tconsole.log('Missing fields for Debit payment:', debit_missing_fields);\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for Debit/Credit payment: {0}', [debit_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\n\t\t\t\t\t\tcase  'Cheque':\n\t\t\t\t\t\tcase  'Government':\t\n\t\t\t\t\t\t\t\tconst cheque_missing_fields = validate_fields(['amount', 'custom_check_bank_name', 'custom_name_on_check', 'custom_check_number'], p);\n\t\t\t\t\t\t\t\tif (cheque_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tconsole.log('Missing fields for Cheque/Government payment:', cheque_missing_fields);\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for Cheque payment: {0}', [cheque_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase  'Cards':\n\t\t\t\t\t\t\t\tconst cards_missing_fields = validate_fields(['amount', 'custom_bank_name', 'custom_card_name', 'custom_card_type', 'custom_card_number', 'custom_card_expiration_date', 'custom_approval_code'], p);\n\t\t\t\t\t\t\t\tif (cards_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tconsole.log('Missing fields for Cards payment:', cards_missing_fields);\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for Cards payment: {0}', [cards_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase  'QR Payment':\n\t\t\t\t\t\t\t\tconst qr_missing_fields = validate_fields(['amount', 'custom_payment_type', 'custom_bank_type', 'custom_qr_reference_number'], p);\n\t\t\t\t\t\t\t\tif (qr_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tconsole.log('Missing fields for QR payment:', qr_missing_fields);\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for QR payment: {0}', [qr_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\n\t\t\t\t\t\tcase  'GCash':\n\t\t\t\t\t\tcase  'PayMaya':\n\t\t\t\t\t\t\t\tconst gcash_maya_missing_fields = validate_fields(['amount', 'reference_no'], p);\n\t\t\t\t\t\t\t\tif (gcash_maya_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tconsole.log('Missing fields for QR payment:', gcash_maya_missing_fields);\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for GCash/PayMaya payment: {0}', [gcash_maya_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase  '2307':\n\t\t\t\t\t\tcase  '2307G':\n\t\t\t\t\t\t\t\tconst gov_missing_fields = validate_fields(['amount'], p);\n\t\t\t\t\t\t\t\tif (gov_missing_fields.length) {\n\t\t\t\t\t\t\t\t\tconsole.log('Missing fields for QR payment:', gov_missing_fields);\n\t\t\t\t\t\t\t\t\tshow_validation_warning(__('The following fields are required for 2307/2307G payment: {0}', [gov_missing_fields.join(', ')]));\n\t\t\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\n\t\t\t\t\t\t// Add cases for other payment methods as needed\n\t\t\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __(\"Invalid payment method selected: {0}\", [payment_method]),\n\t\t\t\t\t\t\t\tindicator: \"orange\",\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\thas_error = true;\n\t\t\t\t\t\t\treturn false; // Stop validation\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\t\treturn !has_error; // Return true if no error found\n\t\t}\n\t\t\n\t\t/**\n\t\t * Function to validate required fields and return missing fields\n\t\t */\n\t\tfunction validate_fields(required_fields, payment_entry) {\n\t\t\tconst missing_fields = [];\n\t\t\t\n\t\t\trequired_fields.forEach(field => {\n\t\t\t\tconst value = payment_entry[field] || '';\n\t\t\t\tif (!value) {\n\t\t\t\t\tmissing_fields.push(field);\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\t\treturn missing_fields;\n\t\t}\n\t\t\n\t\t/**\n\t\t * Function to show validation warning message\n\t\t */\n\t\tfunction show_validation_warning(message) {\n\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\tmessage: message,\n\t\t\t\tindicator: 'orange',\n\t\t\t\tprimary_action: {\n\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\taction: function () {\n\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\t\t// Remove event listener when dialog is closed\n\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t$(document).off('keydown');\n\t\t\t});\n\t\t}\n\t\t\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"paid_amount\", (frm) => {\n\t\t\tthis.update_totals_section(frm.doc);\n\t\t\t// need to re calculate cash shortcuts after discount is applied\n\t\t\tconst is_cash_shortcuts_invisible = !this.$payment_modes.find(\".cash-shortcuts\").is(\":visible\");\n\t\t\tthis.attach_cash_shortcuts(frm.doc);\n\t\t\t!is_cash_shortcuts_invisible &&\n\t\t\t\tthis.$payment_modes.find(\".cash-shortcuts\").css(\"display\", \"grid\");\n\t\t\tthis.render_payment_mode_dom();\n\t\t});\n\n\t\tfrappe.ui.form.on(\"POS Invoice\", \"loyalty_amount\", (frm) => {\n\t\t\tconst formatted_currency = format_currency(frm.doc.loyalty_amount, frm.doc.currency);\n\t\t\tthis.$payment_modes.find(`.loyalty-amount-amount`).html(formatted_currency);\n\t\t});\n\n\t\tfrappe.ui.form.on(\"Sales Invoice Payment\", \"amount\", (frm, cdt, cdn) => {\n\t\t\t// for setting correct amount after loyalty points are redeemed\n\t\t\tconst default_mop = locals[cdt][cdn];\n\t\t\tconst mode = default_mop.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (this[`${mode}_control`] && this[`${mode}_control`].get_value() != default_mop.amount) {\n\t\t\t\tthis[`${mode}_control`].set_value(default_mop.amount);\n\t\t\t}\n\t\t});\n\t}\n\n\tsetup_listener_for_payments() {\n\t\tfrappe.realtime.on(\"process_phone_payment\", (data) => {\n\t\t\tconst doc = this.events.get_frm().doc;\n\t\t\tconst { response, amount, success, failure_message } = data;\n\t\t\tlet message, title;\n\n\t\t\tif (success) {\n\t\t\t\ttitle = __(\"Payment Received\");\n\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t: doc.rounded_total;\n\t\t\t\tif (amount >= grand_total) {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\tmessage = __(\"Payment of {0} received successfully.\", [\n\t\t\t\t\t\tformat_currency(amount, doc.currency, 0),\n\t\t\t\t\t]);\n\t\t\t\t\tthis.events.submit_invoice();\n\t\t\t\t\tcur_frm.reload_doc();\n\t\t\t\t} else {\n\t\t\t\t\tmessage = __(\n\t\t\t\t\t\t\"Payment of {0} received successfully. Waiting for other requests to complete...\",\n\t\t\t\t\t\t[format_currency(amount, doc.currency, 0)]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (failure_message) {\n\t\t\t\tmessage = failure_message;\n\t\t\t\ttitle = __(\"Payment Failed\");\n\t\t\t}\n\n\t\t\tfrappe.msgprint({ message: message, title: title });\n\t\t});\n\t}\n\n\tauto_set_remaining_amount() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? doc.grand_total\n\t\t\t: doc.rounded_total;\n\t\tconst remaining_amount = grand_total - doc.paid_amount;\n\t\tconst current_value = this.selected_mode ? this.selected_mode.get_value() : undefined;\n\t\tif (!current_value && remaining_amount > 0 && this.selected_mode) {\n\t\t\tthis.selected_mode.set_value(remaining_amount);\n\t\t}\n\t}\n\t\n\tattach_shortcuts() {\n\t\tconst shift_label = frappe.utils.is_mac() ? \"\u2318\" : \"Shift\";\n\t\tthis.$component.find(\".submit-order-btn\").attr(\"title\", `${shift_label}+Enter`);\n\t\n\t\t// Ctrl + Enter shortcut for submitting the order\n\t\tfrappe.ui.keys.on(\"shift+enter\", () => {\n\t\t\tconst paymentMethodVisible = this.$component.find(\".payment-section\").is(\":visible\");\n\t\n\t\t\t// Only trigger the click if the payment method section is visible\n\t\t\tif (paymentMethodVisible) {\n\t\t\t\tthis.$component.find(\".submit-order-btn\").click();\n\t\t\t}\n\t\t});\n\t\n\t\t// Tab key shortcut for switching between payment modes\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"shift+tab\",\n\t\t\taction: () => {\n\t\t\t\tconst payment_is_visible = this.$component.is(\":visible\");\n\t\t\t\tlet active_mode = this.$payment_modes.find(\".border-primary\");\n\t\t\t\tactive_mode = active_mode.length ? active_mode.attr(\"data-mode\") : undefined;\n\t\n\t\t\t\tif (!active_mode) return;\n\t\n\t\t\t\tconst mode_of_payments = Array.from(this.$payment_modes.find(\".mode-of-payment\")).map((m) =>\n\t\t\t\t\t$(m).attr(\"data-mode\")\n\t\t\t\t);\n\n\t\t\t\tconst mode_index = mode_of_payments.indexOf(active_mode);\n\t\t\t\tconst next_mode_index = (mode_index + 1) % mode_of_payments.length;\n\t\t\t\tconst next_mode_to_be_clicked = this.$payment_modes.find(\n\t\t\t\t\t`.mode-of-payment[data-mode=\"${mode_of_payments[next_mode_index]}\"]`\n\t\t\t\t);\n\t\n\t\t\t\tif (payment_is_visible && mode_index != next_mode_index) {\n\t\t\t\t\tnext_mode_to_be_clicked.click();\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && this.$payment_modes.find(\".border-primary\").length,\n\t\t\tdescription: __(\"Switch Between Payment Modes\"),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t}\n\t\n\n\ttoggle_numpad() {\n\t\t// pass\n\t}\n\n\trender_payment_section() {\n\t\tthis.render_payment_mode_dom();\n\t\tthis.make_invoice_fields_control();\n\t\tthis.update_totals_section();\n\t\tthis.focus_on_default_mop();\n\t}\n\n\tafter_render() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrm.script_manager.trigger(\"after_payment_render\", frm.doc.doctype, frm.doc.docname);\n\t}\n\n\tedit_cart() {\n\t\tthis.events.toggle_other_sections(false);\n\t\tthis.toggle_component(false);\n\t}\n\n\tcheckout() {\n\t\tthis.events.toggle_other_sections(true);\n\t\tthis.toggle_component(true);\n\t\tthis.render_payment_section();\n\t\tthis.after_render();\n\t}\n\n\ttoggle_remarks_control() {\n\t\tif (this.$remarks.find(\".frappe-control\").length) {\n\t\t\tthis.$remarks.html(\"+ Add Remark\");\n\t\t} else {\n\t\t\tthis.$remarks.html(\"\");\n\t\t\tthis[`remark_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: __(\"Remark\"),\n\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\tonchange: function () { },\n\t\t\t\t},\n\t\t\t\tparent: this.$totals_section.find(`.remarks`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\t\t\tthis[`remark_control`].set_value(\"\");\n\t\t}\n\t}\n\n\trender_payment_mode_dom() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tconst currency = doc.currency;\n\n\t\tconst customer_group = doc.customer_group;\n\t\tconst allowed_payment_modes = [\"2306\", \"2307\"];\n\n\t\tthis.$payment_modes.html(\n\n\t\t\t`<div style=\"display: flex; flex-wrap: wrap; gap: 16px;\">\n\t\t\t\t${payments.map((p, i) => {\n\t\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\t\tconst payment_type = p.type;\n\t\t\t\tconst amount = p.amount > 0 ? format_currency(p.amount, currency) : \"\";\n\n\t\t\t\tconst displayStyle = (p.mode_of_payment === \"2307G\" && customer_group !== \"Government\") ? 'display: none;' : '';\n\n\t\t\t\tlet paymentModeHtml = `\n\t\t\t\t\t\t<div class=\"payment-mode-wrapper\" style=\"flex: 0 0 calc(50% - 16px); min-width: calc(50% - 16px); ${displayStyle}\">\n\t\t\t\t\t\t<div class=\"mode-of-payment\" data-mode=\"${mode}\" data-payment-type=\"${payment_type}\" style=\"border: 1px solid #ccc; border-radius: 8px; padding: 16px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); background-color: #fff;\">\n\t\t\t\t\t\t\t<span>${p.mode_of_payment}</span>\n\t\t\t\t\t\t\t<div class=\"${mode}-amount pay-amount\" style=\"font-weight: bold; justify-content: space-between; align-items: end;\">${amount}</div>\n\t\t\t\t\t\t\t<div class=\"${mode} mode-of-payment-control\"></div>\n\t\t\t\t\t\t\t<div class=\"${mode} cash-button\"></div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t`;\n\n\t\t\t\tswitch (p.mode_of_payment) {\n\t\t\t\t\tcase \"Cards\":\n\t\t\t\t\tcase \"Debit Card\":\n\t\t\t\t\tcase \"Credit Card\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} bank-name\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} holder-name\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} card_type_control\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} card-number\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} expiry-date\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} approval-code\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase \"GCash\":\n\t\t\t\t\tcase \"PayMaya\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} mobile-number\" style=\"margin-top:10px;\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} reference-number\" style=\"margin-top:10px;\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"Cheque\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} bank-name\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} check-name\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} check-number\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} check-date\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"2307G\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} actual-gov-one\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"2307\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} actual-gov-two\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"QR Payment\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} payment-type\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} bank-type\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} qr-reference-number\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"Charge\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t\t<div class=\"${mode} customer\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} charge-invoice-number\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} po-number\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} representative\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} id-number\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} approved-by\"></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 5px; align-items: center;\">\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} save-button\"></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t`;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"Gift Certificate\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t  <div class=\"${mode} gift-code\"></div>\n\t\t\t\t\t\t\t  <div class=\"${mode} button-row\" style=\"display: flex; gap: 3px; align-items: center;\">\n\t\t\t\t\t\t\t  \t\t<div class=\"${mode} button-code mt-2\" ></div>\n\t\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t   `;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"Amesco Plus\":\n\t\t\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t<div class=\"${mode} amesco-code\"></div>\n\t\t\t\t\t\t\t<div class=\"${mode} button-row\" style=\"display: flex; gap: 3px; align-items: center;\">\n\t\t\t\t\t\t\t\t<div class=\"${mode} button-amesco-plus mt-2\" ></div>\n\t\t\t\t\t\t\t\t<div class=\"${mode} discard-button\"></div>\n\t\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t   `;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tpaymentModeHtml += `\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;\n\n\t\t\t\treturn paymentModeHtml;\n\t\t\t}).join(\"\")}\n\t\t\t</div>`\n\t\t);\n\n\n\n\t\tpayments.forEach((p) => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tconst me = this;\n\t\t\tconst frm = this.events.get_frm()\n\n\n\t\t\tthis[`${mode}_control`] = frappe.ui.form.make_control({\n\t\t\t\tdf: {\n\t\t\t\t\tlabel: \"Amount\",\n\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\tplaceholder: __(\"Enter {0} amount.\", [p.mode_of_payment]),\n\t\t\t\t\tread_only: (mode === \"gift_certificate\"),\n\t\t\t\t\tonchange: function () {\n\t\t\t\t\t\tconst current_value = frappe.model.get_value(p.doctype, p.name, \"amount\");\n\t\t\t\t\t\tif (current_value != this.value) {\n\t\t\t\t\t\t\t// frappe.model\n\t\t\t\t\t\t\t// \t// .set_value(p.doctype, p.name, \"amount\", flt(this.value))\n\t\t\t\t\t\t\t// \t.then(() => me.update_totals_section());\n\n\n\n\t\t\t\t\t\t\tconst formatted_currency = format_currency(this.value, currency);\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\treqd: true // Make the amount field required\n\t\t\t\t},\n\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mode-of-payment-control`),\n\t\t\t\trender_input: true,\n\t\t\t});\n\n\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst $amountField = this.$payment_modes.find(`.${mode}.mode-of-payment-control input[data-fieldname=\"amount\"]`);\n\t\t\t\t$amountField.focus();\n\t\t\t\t$amountField.select(); // Selects the text inside the field for easy replacement\n\t\t\t}, 300); // Use a small delay to ensure the element is in the DOM\n\n\t\t\t// Add save and discard buttons for cash mode\n\t\t\tif (mode === \"cash\") {\n\t\t\t\t// Add save button\n\t\t\t\tconst save_button = $('<button/>', {\n\t\t\t\t\ttext: 'Save',\n\t\t\t\t\tclass: 'btn btn-primary',\n\t\t\t\t\tclick: function () {\n\t\t\t\t\t\tconst amount_value = me[`${mode}_control`].get_value();\n\n\t\t\t\t\t\tif (!amount_value) {\n\t\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\n\n\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t.set_value(p.doctype, p.name, \"amount\", flt(amount_value))\n\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\tme.update_totals_section();\n\t\t\t\t\t\t\t\tconst formatted_currency = format_currency(amount_value, currency);\n\t\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(formatted_currency);\n\n\t\t\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\t\t\t\tmessage: __('Cash payment details have been saved.'),\n\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Add event listener for Enter key\n\t\t\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Add discard button\n\t\t\t\tconst discard_button = $('<button/>', {\n\t\t\t\t\ttext: 'Discard',\n\t\t\t\t\tclass: 'btn btn-secondary',\n\t\t\t\t\tclick: function () {\n\t\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0).then(() => {\n\t\t\t\t\t\t\tme.update_totals_section();\n\t\t\t\t\t\t\tme.$payment_modes.find(`.${mode}-amount`).html(format_currency(0, currency));\n\n\t\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\t\tmessage: __('Cash payment details have been discarded.'),\n\t\t\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Add event listener for Enter key\n\t\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\t\tif (e.which === 46 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\t\tdialog.get_secondary_btn().trigger('click');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t// Append the save and discard buttons to the parent container\n\t\t\t\tconst button_container = $('<div/>', { style: 'display: flex; gap: 5px; align-items: center;' });\n\t\t\t\tbutton_container.append(save_button);\n\t\t\t\tbutton_container.append(discard_button);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.cash-button`).append(button_container);\n\n\t\t\t\t// Add keypress event listener for Enter key to trigger save button click\n\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control input`).keypress(function (e) {\n\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t\n\t\t\t}\n\n\n\t\t\tthis[`${mode}_control`].set_value(0);\n\n\t\t\tif (p.mode_of_payment === \"Cards\") {\n\n\t\t\t\tlet existing_custom_bank_name = frappe.model.get_value(p.doctype, p.name, \"custom_bank_name\");\n\t\t\t\t// Create the bank_name_control without onchange\n\t\t\t\tlet bank_name_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Bank',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Bank Name',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.bank-name`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tbank_name_control.set_value(existing_custom_bank_name || '');\n\t\t\t\tbank_name_control.refresh();\n\n\n\t\t\t\tconst selected_customer = cur_frm.doc.customer;\n\n\t\t\t\tlet existing_custom_card_name = frappe.model.get_value(p.doctype, p.name, \"custom_card_name\");\n\t\t\t\tlet name_on_card_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Name on Card',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Card name holder',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.holder-name`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\n\n\t\t\t\tfrappe.db.get_value('Customer', selected_customer, 'customer_name')\n\t\t\t\t\t.then(r => {\n\t\t\t\t\t\tconst result = r.message.customer_name; // Extract the customer_name from the result\n\t\t\t\t\t\tname_on_card_control.set_value(existing_custom_card_name || result || '');\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.error('Error fetching customer name:', error);\n\t\t\t\t\t});\n\n\t\t\t\tname_on_card_control.refresh();\n\n\t\t\t\tlet existing_custom_card_type = frappe.model.get_value(p.doctype, p.name, \"custom_card_type\");\n\t\t\t\tlet card_type_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Card Type',\n\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ label: 'Select Card Type', value: '' },\n\t\t\t\t\t\t\t{ label: 'Visa', value: 'Visa' },\n\t\t\t\t\t\t\t{ label: 'Visa Debit', value: 'Visa Debit' },\n\t\t\t\t\t\t\t{ label: 'Visa Electron', value: 'Visa Electron' },\n\t\t\t\t\t\t\t{ label: 'Credit Card', value: 'Credit Card' },\n\t\t\t\t\t\t\t{ label: 'Mastercard', value: 'Mastercard' },\n\t\t\t\t\t\t\t{ label: 'Mastercard Debit', value: 'Mastercard Debit' },\n\t\t\t\t\t\t\t{ label: 'Maestro', value: 'Maestro' },\n\t\t\t\t\t\t\t{ label: 'American Express (Amex)', value: 'American Express (Amex)' },\n\t\t\t\t\t\t\t{ label: 'Discover', value: 'Discover' },\n\t\t\t\t\t\t\t{ label: 'Diners Club', value: 'Diners Club' },\n\t\t\t\t\t\t\t{ label: 'JCB', value: 'JCB' },\n\t\t\t\t\t\t\t{ label: 'UnionPay', value: 'UnionPay' },\n\t\t\t\t\t\t\t{ label: 'RuPay', value: 'RuPay' },\n\t\t\t\t\t\t\t{ label: 'Interac', value: 'Interac' },\n\t\t\t\t\t\t\t{ label: 'Carte Bancaire (CB)', value: 'Carte Bancaire (CB)' },\n\t\t\t\t\t\t\t{ label: 'Elo', value: 'Elo' },\n\t\t\t\t\t\t\t{ label: 'Mir', value: 'Mir' },\n\t\t\t\t\t\t\t{ label: 'Others', value: 'Others' }\n\t\t\t\t\t\t],\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.card_type_control`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcard_type_control.set_value(existing_custom_card_type || '');\n\t\t\t\tcard_type_control.refresh();\n\n\t\t\t\tlet existing_custom_card_number = frappe.model.get_value(p.doctype, p.name, \"custom_card_number\");\n\t\t\t\tlet card_number_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Card Number',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Last 4 digits',\n\t\t\t\t\t\tmaxlength: 4,\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.card-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcard_number_control.set_value(existing_custom_card_number || '');\n\t\t\t\tcard_number_control.refresh();\n\n\t\t\t\tlet existing_custom_card_expiration_date = frappe.model.get_value(p.doctype, p.name, \"custom_card_expiration_date\");\n\t\t\t\tlet expiry_date_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Card Expiration Date',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'MM/YY',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.expiry-date`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\texpiry_date_control.set_value(existing_custom_card_expiration_date || '');\n\t\t\t\texpiry_date_control.refresh();\n\n\t\t\t\t\t// Add event listener to automatically insert '/' after two digits\n\t\t\t\texpiry_date_control.$input.on('input', function () {\n\t\t\t\t\tlet value = this.value.replace(/\\D/g, ''); // Remove any non-digit characters\n\t\t\t\t\tif (value.length >= 2) {\n\t\t\t\t\t\tthis.value = value.slice(0, 2) + '/' + value.slice(2); // Add '/' after the second digit\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.value = value; // Set the value directly if less than 2 digits\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet existing_custom_approval_code = frappe.model.get_value(p.doctype, p.name, \"custom_approval_code\");\n\t\t\t\tlet custom_approval_code_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Approval Code',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Approval Code',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.approval-code`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_approval_code_control.set_value(existing_custom_approval_code || '');\n\t\t\t\tcustom_approval_code_control.refresh();\n\n\t\t\t\t// let existing_reference_no = frappe.model.get_value(p.doctype, p.name, \"reference_no\");\n\t\t\t\t// let reference_no_control = frappe.ui.form.make_control({\n\t\t\t\t// \tdf: {\n\t\t\t\t// \t\tlabel: 'Reference No',\n\t\t\t\t// \t\tfieldtype: \"Data\",\n\t\t\t\t// \t\tplaceholder: 'Reference No.',\n\t\t\t\t// \t\treqd: true\n\t\t\t\t// \t},\n\t\t\t\t// \tparent: this.$payment_modes.find(`.${mode}.reference-number`),\n\t\t\t\t// \trender_input: true,\n\t\t\t\t// });\n\t\t\t\t// reference_no_control.set_value(existing_reference_no || '');\n\t\t\t\t// reference_no_control.refresh();\n\n\t\t\t\t// Create a save button for all the fields and append it under the reference control\n\t\t\t\tlet save_button = $(`<button class=\"btn btn-primary\"style=\"text-align: right;\"\">Save</button>`);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\t\t\t\t\tlet bank_name = bank_name_control.get_value();\n\t\t\t\t\tlet card_name = name_on_card_control.get_value();\n\t\t\t\t\tlet card_type = card_type_control.get_value();\n\t\t\t\t\tlet card_number = card_number_control.get_value();\n\t\t\t\t\tlet card_expiry_date = expiry_date_control.get_value();\n\t\t\t\t\tlet approval_code = custom_approval_code_control.get_value();\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\t\t\t\t\tif (!amount || !bank_name || !card_name || !card_type || !card_number || !card_expiry_date || !approval_code) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!validateLastFourDigits(card_number)) {\n\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Card number must be exactly 4 digits.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t\t: doc.rounded_total;\n\t\t\t\t\tconst currency = doc.currency;\n\n\t\t\t\t\tif (amount > grand_total) {\n\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Amount must not exceed the grand total.'),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_name\", bank_name);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_name\", card_name);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_type\", card_type);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_number\", card_number);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_expiration_date\", card_expiry_date);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_approval_code\", approval_code);\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Card payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\n\t\t\t\t});\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\t// Clear all the fields\n\t\t\t\t\tthis[`${mode}_control`].set_value(0);\n\t\t\t\t\tbank_name_control.set_value('');\n\t\t\t\t\tname_on_card_control.set_value('');\n\t\t\t\t\tcard_type_control.set_value('');\n\t\t\t\t\tcard_number_control.set_value('');\n\t\t\t\t\texpiry_date_control.set_value('');\n\t\t\t\t\tcustom_approval_code_control.set_value('');\n\n\n\t\t\t\t\t// Set values in the model to null or empty string\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_name\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_name\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_type\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_expiration_date\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_approval_code\", '');\n\n\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t\tbank_name_control,\n\t\t\t\t\tname_on_card_control,\n\t\t\t\t\tcard_type_control,\n\t\t\t\t\tcard_number_control,\n\t\t\t\t\texpiry_date_control,\n\t\t\t\t\tcustom_approval_code_control\n\t\t\t\t]\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\n\n\t\t\t\tfunction validateLastFourDigits(value) {\n\t\t\t\t\tconst regex = /^\\d{4}$/;\n\t\t\t\t\treturn regex.test(value);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (p.mode_of_payment === \"GCash\" || p.mode_of_payment === 'PayMaya') {\n\t\t\t\tlet existing_custom_phone_number = frappe.model.get_value(p.doctype, p.name, \"custom_phone_number\");\n\t\t\t\tlet phone_number_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Number',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: '09876543212',\n\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_phone_number\", this.value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.mobile-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tphone_number_control.set_value(existing_custom_phone_number || '');\n\t\t\t\tphone_number_control.refresh();\n\n\n\n\t\t\t\tlet existing_custom_epayment_reference_number = frappe.model.get_value(p.doctype, p.name, \"reference_no\");\n\n\t\t\t\tlet epayment_reference_number_controller = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Reference No',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Reference No.',\n\t\t\t\t\t\treqd: true\n\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"reference_no\", this.value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.reference-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t\tdefault: p.reference_no || ''\n\t\t\t\t});\n\n\t\t\t\tepayment_reference_number_controller.set_value(existing_custom_epayment_reference_number || '');\n\t\t\t\tepayment_reference_number_controller.refresh();\n\n\n\n\t\t\t\tlet save_button = $('<button class=\"btn btn-primary\" style=\"text-align: right;\">save</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\t// Create discard button\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\n\t\t\t\t// Attach event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\t\t\t\t\tlet phone_number = phone_number_control.get_value();\n\t\t\t\t\tlet reference_no = epayment_reference_number_controller.get_value();\n\n\n\t\t\t\t\tif (!amount || !reference_no) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t\t: doc.rounded_total;\n\t\t\t\t\tconst currency = doc.currency;\n\n\n\t\t\t\t\tif (amount > grand_total) {\n\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Amount must not exceed the grand total.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_phone_number\", phone_number);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\t// Attach event listener to the discard button\n\t\t\n\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\t// Clear all the fields\n\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\tphone_number_control.set_value('');\n\t\t\t\t\tepayment_reference_number_controller.set_value('');\n\n\t\t\t\t\t// Set values in the model to null or empty string\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_phone_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"reference_no\", '');\n\n\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t\tphone_number_control,\n\t\t\t\t\tepayment_reference_number_controller,\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\t\t\t}\n\n\n\t\t\tif (p.mode_of_payment === \"Debit Card\" || p.mode_of_payment === \"Credit Card\") {\n\t\t\t\t// Retrieve existing values\n\t\t\t\tlet existing_custom_bank_name = frappe.model.get_value(p.doctype, p.name, \"custom_bank_name\");\n\t\t\t\tlet existing_custom_card_name = frappe.model.get_value(p.doctype, p.name, \"custom_card_name\");\n\t\t\t\tlet existing_custom_card_type = frappe.model.get_value(p.doctype, p.name, \"custom_card_type\");\n\t\t\t\tlet existing_custom_card_number = frappe.model.get_value(p.doctype, p.name, \"custom_card_number\");\n\t\t\t\tlet existing_custom_card_expiration_date = frappe.model.get_value(p.doctype, p.name, \"custom_card_expiration_date\");\n\t\t\t\tlet existing_custom_approval_code = frappe.model.get_value(p.doctype, p.name, \"custom_approval_code\");\n\n\t\t\t\t// Create controls\n\t\t\t\tlet bank_name_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Bank',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Bank Name',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.bank-name`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tbank_name_control.set_value(existing_custom_bank_name || '');\n\t\t\t\tbank_name_control.refresh();\n\n\n\n\t\t\t\tconst selected_customer = cur_frm.doc.customer;\n\t\t\t\tlet name_on_card_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Name on Card',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Card name holder',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.holder-name`), // Ensure mode is defined and correct\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\n\t\t\t\t// Fetch the customer name and set it to the control when available\n\t\t\t\tfrappe.db.get_value('Customer', selected_customer, 'customer_name')\n\t\t\t\t\t.then(r => {\n\t\t\t\t\t\tconst result = r.message.customer_name; // Extract the customer_name from the result\n\t\t\t\t\t\tname_on_card_control.set_value(existing_custom_card_name || result || '');\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.error('Error fetching customer name:', error);\n\t\t\t\t\t});\n\n\t\t\t\t// Refresh the control to render it properly\n\t\t\t\tname_on_card_control.refresh();\n\n\t\t\t\tlet card_type_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Card Type',\n\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ label: 'Select Card Type', value: '' },\n\t\t\t\t\t\t\t{ label: 'Visa', value: 'Visa' },\n\t\t\t\t\t\t\t{ label: 'Visa Debit', value: 'Visa Debit' },\n\t\t\t\t\t\t\t{ label: 'Visa Electron', value: 'Visa Electron' },\n\t\t\t\t\t\t\t{ label: 'Credit Card', value: 'Credit Card' },\n\t\t\t\t\t\t\t{ label: 'Mastercard', value: 'Mastercard' },\n\t\t\t\t\t\t\t{ label: 'Mastercard Debit', value: 'Mastercard Debit' },\n\t\t\t\t\t\t\t{ label: 'Maestro', value: 'Maestro' },\n\t\t\t\t\t\t\t{ label: 'American Express (Amex)', value: 'American Express (Amex)' },\n\t\t\t\t\t\t\t{ label: 'Discover', value: 'Discover' },\n\t\t\t\t\t\t\t{ label: 'Diners Club', value: 'Diners Club' },\n\t\t\t\t\t\t\t{ label: 'JCB', value: 'JCB' },\n\t\t\t\t\t\t\t{ label: 'UnionPay', value: 'UnionPay' },\n\t\t\t\t\t\t\t{ label: 'RuPay', value: 'RuPay' },\n\t\t\t\t\t\t\t{ label: 'Interac', value: 'Interac' },\n\t\t\t\t\t\t\t{ label: 'Carte Bancaire (CB)', value: 'Carte Bancaire (CB)' },\n\t\t\t\t\t\t\t{ label: 'Elo', value: 'Elo' },\n\t\t\t\t\t\t\t{ label: 'Mir', value: 'Mir' },\n\t\t\t\t\t\t\t{ label: 'Others', value: 'Others' }\n\t\t\t\t\t\t],\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.card_type_control`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcard_type_control.set_value(existing_custom_card_type || '');\n\t\t\t\tcard_type_control.refresh();\t\n\n\t\t\t\t\n\n\n\n\n\t\t\t\tlet card_number_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Card Number',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Last 4 digits',\n\t\t\t\t\t\tmaxlength: 4,\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.card-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcard_number_control.set_value(existing_custom_card_number || '');\n\t\t\t\tcard_number_control.refresh();\n\n\t\t\t\tlet expiry_date_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Card Expiration Date',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'MM/YY',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.expiry-date`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\texpiry_date_control.set_value(existing_custom_card_expiration_date || '');\n\t\t\t\texpiry_date_control.refresh();\n\n\n\t\t\t\texpiry_date_control.$input.on('input', function () {\n\t\t\t\t\tlet value = this.value.replace(/\\D/g, ''); // Remove any non-digit characters\n\t\t\t\t\tif (value.length >= 2) {\n\t\t\t\t\t\tthis.value = value.slice(0, 2) + '/' + value.slice(2); // Add '/' after the second digit\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.value = value; // Set the value directly if less than 2 digits\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet custom_approval_code_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Approval Code',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Approval Code',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.approval-code`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_approval_code_control.set_value(existing_custom_approval_code || '');\n\t\t\t\tcustom_approval_code_control.refresh();\n\n\n\n\n\t\t\t\tlet save_button = $('<button class=\"btn btn-primary\" style=\"text-align: right;\">Save</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\t// Create discard button\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\n\t\t\t\t// Attach event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\t\t\t\t\tlet bank_name = bank_name_control.get_value();\n\t\t\t\t\tlet card_name = name_on_card_control.get_value();\n\t\t\t\t\tlet card_type = card_type_control.get_value();\n\t\t\t\t\tlet card_number = card_number_control.get_value();\n\t\t\t\t\tlet card_expiry_date = expiry_date_control.get_value();\n\t\t\t\t\tlet approval_code = custom_approval_code_control.get_value();\n\n\t\t\t\t\tif (!amount || !bank_name || !card_name || !card_number || !card_expiry_date || !approval_code) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!validateLastFourDigits(card_number)) {\n\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Card number must be exactly 4 digits.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t\t: doc.rounded_total;\n\t\t\t\t\tconst currency = doc.currency;\n\n\n\t\t\t\t\tif (amount > grand_total) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Amount must not exceed the grand total.'),\n\t\t\t\t\t\t\tindicator: 'orange'\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_name\", bank_name);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_name\", card_name);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_type\", card_type);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_number\", card_number);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_expiration_date\", card_expiry_date);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_approval_code\", approval_code);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Card payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\n\t\t\t\t});\n\n\t\t\t\t// Attach event listener to the discard button\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\t// Clear all the fields\n\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\tbank_name_control.set_value('');\n\t\t\t\t\tname_on_card_control.set_value('');\n\t\t\t\t\tcard_number_control.set_value('');\n\t\t\t\t\texpiry_date_control.set_value('');\n\t\t\t\t\tcustom_approval_code_control.set_value('');\n\n\t\t\t\t\t// Set values in the model to null or empty string\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_name\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_name\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_card_expiration_date\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_approval_code\", '');\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tfunction validateLastFourDigits(value) {\n\t\t\t\t\tconst regex = /^\\d{4}$/;\n\t\t\t\t\treturn regex.test(value);\n\t\t\t\t}\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t\tbank_name_control,\n\t\t\t\t\tname_on_card_control,\n\t\t\t\t\tcard_number_control,\n\t\t\t\t\texpiry_date_control,\n\t\t\t\t\tcustom_approval_code_control\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t}\n\n\n\t\t\tif (p.mode_of_payment === \"Cheque\" || p.mode_of_payment === 'Government') {\n\n\t\t\t\tlet existing_custom_bank_name = frappe.model.get_value(p.doctype, p.name, \"custom_check_bank_name\");\n\n\t\t\t\t// Create the bank_name_control with the existing value if it exists\n\t\t\t\tlet bank_name_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Bank Of Cheque',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Bank Of Cheque',\n\t\t\t\t\t\treqd: true\n\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_check_bank_name\", this.value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.bank-name`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tbank_name_control.set_value(existing_custom_bank_name || '');\n\t\t\t\tbank_name_control.refresh();\n\n\n\t\t\t\tconst selected_customer = cur_frm.doc.customer;\n\n\t\t\t\tlet existing_custom_check_name = frappe.model.get_value(p.doctype, p.name, \"custom_name_on_check\");\n\t\t\t\tlet check_name_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Name On Cheque',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Cheque Name',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_name_on_check\", this.value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.check-name`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tfrappe.db.get_value('Customer', selected_customer, 'customer_name')\n\t\t\t\t\t.then(r => {\n\t\t\t\t\t\tconst result = r.message.customer_name; // Extract the customer_name from the result\n\t\t\t\t\t\tcheck_name_control.set_value(existing_custom_check_name || result || '');\n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.error('Error fetching customer name:', error);\n\t\t\t\t\t});\n\t\t\n\t\t\t\tcheck_name_control.refresh();\n\n\n\t\t\t\tlet existing_custom_check_number = frappe.model.get_value(p.doctype, p.name, \"custom_check_number\");\n\t\t\t\tlet check_number_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Cheque Number',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Cheque Number',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_check_number\", this.value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.check-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tcheck_number_control.set_value(existing_custom_check_number || '');\n\t\t\t\tcheck_number_control.refresh();\n\n\t\t\t\tlet existing_custom_check_date = frappe.model.get_value(p.doctype, p.name, \"custom_check_date\");\n\t\t\t\tlet check_date_control = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tfieldname: 'custom_check_date',\n\t\t\t\t\t\tlabel: 'Cheque Date',\n\t\t\t\t\t\tfieldtype: \"Date\",\n\t\t\t\t\t\tplaceholder: 'Cheque Date',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_check_date\", this.get_value());\n\t\t\t\t\t\t// }\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.check-date`),\n\t\t\t\t\trender_input: true\n\t\t\t\t});\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tcheck_date_control.set_value(existing_custom_check_date || frappe.datetime.nowdate());\n\t\t\t\tcheck_date_control.refresh();\n\n\t\t\t\tlet save_button = $(`<button class=\"btn btn-primary\"style=\"text-align: right;\"\">Save</button>`);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\t\t\t\t\tlet bank_name = bank_name_control.get_value();\n\t\t\t\t\tlet check_name = check_name_control.get_value();\n\t\t\t\t\tlet check_number = check_number_control.get_value();\n\t\t\t\t\tlet check_date = check_date_control.get_value();\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\t\t\t\t\tif (!amount || !bank_name || !check_name || !check_number || !check_date) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t\t: doc.rounded_total;\n\t\t\t\t\tconst currency = doc.currency;\n\n\n\t\t\t\t\tif (amount > grand_total) {\n\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Amount must not exceed the grand total.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_check_bank_name\", bank_name);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_name_on_check\", check_name);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_check_number\", check_number);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_check_date\", check_date);\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\n\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Cheque payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\tbank_name_control.set_value('');\n\t\t\t\t\tcheck_name_control.set_value('');\n\t\t\t\t\tcheck_number_control.set_value('');\n\t\t\t\t\tcheck_date_control.set_value('');\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_check_bank_name\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_name_on_check\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_check_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_check_date\", '');\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t\tbank_name_control,\n\t\t\t\t\tcheck_name_control,\n\t\t\t\t\tcheck_number_control,\n\t\t\t\t\tcheck_date_control,\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\t\t\t}\n\n\t\t\tif (p.mode_of_payment === \"2307G\") {\n\t\t\t\t// console.log('Form 2306 Expected: ', doc.custom_2306);\n\n\n\t\t\t\tlet check_form_2306 = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: `Expected 2307G Amount`,\n\t\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\t\tplaceholder: 'Actual 2307G',\n\t\t\t\t\t\tread_only: 1, // Set the field to read-only\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.actual-gov-one`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\n\t\t\t\t// Set the latest value of doc.custom_2306 directly\n\t\t\t\tlet latest_form_2306_value = doc.custom_2306;\n\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_form_2306\", latest_form_2306_value);\n\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tcheck_form_2306.set_value(latest_form_2306_value || '');\n\t\t\t\tcheck_form_2306.refresh();\n\n\n\t\t\t\tlet save_button = $(`<button class=\"btn btn-primary\"style=\"text-align: right;\"\">Save</button>`);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\n\t\t\t\t\tif (!amount) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\n\t\t\t\t});\n\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\tme[`${mode}_control`].set_value('');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\t\t\t}\n\n\t\t\tif (p.mode_of_payment === \"2307\") {\n\n\n\t\t\t\tlet check_form_2307 = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: `Expected 2307 Amount`,\n\t\t\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\t\t\tplaceholder: 'Actual 2307',\n\t\t\t\t\t\tread_only: 1, // Set the field to read-only\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.actual-gov-two`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tlet latest_form_2307_value = doc.custom_2307;\n\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_form_2307\", latest_form_2307_value);\n\n\t\t\t\tcheck_form_2307.set_value(latest_form_2307_value || '');\n\t\t\t\tcheck_form_2307.refresh();\n\n\n\n\t\t\t\tlet save_button = $(`<button class=\"btn btn-primary\"style=\"text-align: right;\"\">Save</button>`);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\n\t\t\t\t\tif (!amount) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\tme[`${mode}_control`].set_value('');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\n\t\t\t}\n\n\t\t\tif (p.mode_of_payment === \"QR Payment\") {\n\n\t\t\t\tlet existing_custom_payment_type = frappe.model.get_value(p.doctype, p.name, \"custom_payment_type\");\n\t\t\t\tlet custom_payment_type = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Payment Type',\n\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ label: 'Select Payment Type', value: '' },\n\t\t\t\t\t\t\t{ label: 'Standee', value: 'Standee' },\n\t\t\t\t\t\t\t{ label: 'Terminal', value: 'Terminal' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tconst value = this.value;\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_payment_type\", value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.payment-type`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tcustom_payment_type.set_value(existing_custom_payment_type || '');\n\t\t\t\tcustom_payment_type.refresh();\n\n\n\t\t\t\tlet existing_custom_bank_type = frappe.model.get_value(p.doctype, p.name, \"custom_bank_type\");\n\t\t\t\tlet custom_bank_type = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Bank',\n\t\t\t\t\t\tfieldtype: \"Select\",\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ label: 'Select Bank Type', value: '' },\n\t\t\t\t\t\t\t{ label: 'SBC', value: 'SBC' },\n\t\t\t\t\t\t\t{ label: 'MBTC', value: 'MBTC' },\n\t\t\t\t\t\t\t{ label: 'MAYA', value: 'MAYA' },\n\t\t\t\t\t\t\t{ label: 'GCASH', value: 'GCASH' },\n\t\t\t\t\t\t\t{ label: 'BDO', value: 'BDO' },\n\t\t\t\t\t\t],\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tconst value = this.value;\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_type\", value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.bank-type`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\t// Set the existing value and refresh the control\n\t\t\t\tcustom_bank_type.set_value(existing_custom_bank_type || '');\n\t\t\t\tcustom_bank_type.refresh();\n\n\n\n\t\t\t\tlet existing_custom_qr_reference_number = frappe.model.get_value(p.doctype, p.name, \"custom_qr_reference_number\");\n\t\t\t\tlet custom_qr_reference_number = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: `Confirmation Code`,\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Reference # or Confirmation Code',\n\t\t\t\t\t\treqd: true\n\n\t\t\t\t\t\t// onchange: function () {\n\t\t\t\t\t\t// \tfrappe.model.set_value(p.doctype, p.name, \"custom_qr_reference_number\", this.value);\n\t\t\t\t\t\t// },\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.qr-reference-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_qr_reference_number.set_value(existing_custom_qr_reference_number || '');\n\t\t\t\tcustom_qr_reference_number.refresh();\n\n\n\t\t\t\tlet save_button = $(`<button class=\"btn btn-primary\"style=\"text-align: right;\"\">Save</button>`);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\t\t\t\t\tlet payment_type = custom_payment_type.get_value();\n\t\t\t\t\tlet bank_type = custom_bank_type.get_value();\n\t\t\t\t\tlet qr_reference_number = custom_qr_reference_number.get_value();\n\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\t\t\t\t\tif (!amount || !payment_type || !bank_type || !qr_reference_number) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t\t\t\t? doc.grand_total\n\t\t\t\t\t\t: doc.rounded_total;\n\t\t\t\t\tconst currency = doc.currency;\n\n\t\t\t\t\tif (amount > grand_total) {\n\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('Amount must not exceed the grand total.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_payment_type\", payment_type);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_type\", bank_type);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_qr_reference_number\", qr_reference_number);\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\tcustom_payment_type.set_value('');\n\t\t\t\t\tcustom_bank_type.set_value('');\n\t\t\t\t\tcustom_qr_reference_number.set_value('');\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_payment_type\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_bank_type\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_qr_reference_number\", '');\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t\tcustom_payment_type,\n\t\t\t\t\tcustom_bank_type,\n\t\t\t\t\tcustom_qr_reference_number,\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\n\n\t\t\t}\n\n\n\t\t\tif (p.mode_of_payment === \"Charge\") {\n\t\t\t\tconst selected_customer = cur_frm.doc.customer;\n\n\n\n\t\t\t\t\n\t\t\t\tlet existing_custom_customer = frappe.model.get_value(p.doctype, p.name, \"custom_customer\");\n\t\t\t\tlet custom_customer = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Customer',\n\t\t\t\t\t\tfieldtype: \"Data\",\n\t\t\t\t\t\tplaceholder: 'Customer Name',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.customer`), // Use [0] to select the DOM element\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\n\t\t\t\t\n\t\t\t\tfrappe.db.get_value('Customer', selected_customer, 'customer_name')\n\t\t\t\t\t.then(r => {\n\t\t\t\t\t\tconst result = r.message.customer_name; // Extract the customer_name from the result\n\t\t\t\t\t\tcustom_customer.set_value(existing_custom_customer || result || ''); \n\t\t\t\t\t})\n\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\tconsole.error('Error fetching customer name:', error);\n\t\t\t\t\t});\n\n\t\t\t\tcustom_customer.refresh();\n\n\n\t\t\t\tlet existing_charge_invoice_number = frappe.model.get_value(p.doctype, p.name, \"custom_charge_invoice_number\");\n\t\t\t\tlet charge_invoice_number = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Charge Invoice Number',\n\t\t\t\t\t\tfieldtype: \"Data\", // Corrected fieldtype\n\t\t\t\t\t\tplaceholder: 'Charge Invoice Number',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.charge-invoice-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcharge_invoice_number.set_value(existing_charge_invoice_number || '');\n\t\t\t\tcharge_invoice_number.refresh();\n\n\n\t\t\t\tlet existing_custom_po_number = frappe.model.get_value(p.doctype, p.name, \"custom_po_number\");\n\t\t\t\tlet custom_po_number = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'PO Number',\n\t\t\t\t\t\tfieldtype: \"Data\", // Corrected fieldtype\n\t\t\t\t\t\tplaceholder: 'PO Number',\n\t\t\t\t\t\treqd: true\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.po-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_po_number.set_value(existing_custom_po_number || '');\n\t\t\t\tcustom_po_number.refresh();\n\n\t\t\t\tlet existing_custom_representative = frappe.model.get_value(p.doctype, p.name, \"custom_representative\");\n\t\t\t\tlet custom_representative = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Representative',\n\t\t\t\t\t\tfieldtype: \"Data\", // Corrected fieldtype\n\t\t\t\t\t\tplaceholder: 'Representative',\n\t\t\t\t\t\treqd: true\n\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.representative`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_representative.set_value(existing_custom_representative || '');\n\t\t\t\tcustom_representative.refresh();\n\n\t\t\t\tlet existing_custom_id_number = frappe.model.get_value(p.doctype, p.name, \"custom_id_number\");\n\t\t\t\tlet custom_id_number = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'ID Number',\n\t\t\t\t\t\tfieldtype: \"Data\", // Corrected fieldtype\n\t\t\t\t\t\tplaceholder: 'ID Number',\n\t\t\t\t\t\treqd: true\n\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.id-number`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_id_number.set_value(existing_custom_id_number || '');\n\t\t\t\tcustom_id_number.refresh();\n\n\t\t\t\tlet existing_custom_approved_by = frappe.model.get_value(p.doctype, p.name, \"custom_approved_by\");\n\t\t\t\tlet custom_approved_by = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Approved By',\n\t\t\t\t\t\tfieldtype: \"Data\", // Corrected fieldtype\n\t\t\t\t\t\tplaceholder: 'Approver name',\n\n\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.approved-by`),\n\t\t\t\t\trender_input: true,\n\t\t\t\t});\n\t\t\t\tcustom_approved_by.set_value(existing_custom_approved_by || '');\n\t\t\t\tcustom_approved_by.refresh();\n\n\n\n\t\t\t\tlet save_button = $(`<button class=\"btn btn-primary\"style=\"text-align: right;\"\">Save</button>`);\n\t\t\t\tthis.$payment_modes.find(`.${mode}.save-button`).append(save_button);\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" style=\"text-align: right; margin-left: 10px;\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\t\t\t\tsave_button.on('click', function () {\n\t\t\t\t\tlet amount = me[`${mode}_control`].get_value(); // Get amount value\n\t\t\t\t\tlet customer = custom_customer.get_value();\n\t\t\t\t\tlet charge_invoice_no = charge_invoice_number.get_value();\n\t\t\t\t\tlet po_number = custom_po_number.get_value();\n\t\t\t\t\tlet representative = custom_representative.get_value();\n\t\t\t\t\tlet id_number = custom_id_number.get_value();\n\t\t\t\t\tlet approved_by = custom_approved_by.get_value();\n\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\t\t\t\t\tif (!amount || !customer || !charge_invoice_no || !po_number || !representative || !id_number) {\n\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\ttitle: __('Validation Warning'),\n\t\t\t\t\t\t\tmessage: __('All fields are required.'),\n\t\t\t\t\t\t\tindicator: 'orange',\n\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amount));\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_customer\", customer);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_charge_invoice_number\", charge_invoice_no)\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_po_number\", po_number);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_representative\", representative);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_id_number\", id_number);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_approved_by\", approved_by);\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\tmessage: __('Payment details have been saved.'),\n\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\tme[`${mode}_control`].set_value(0);\n\t\t\t\t\tcustom_customer.set_value('');\n\t\t\t\t\tcharge_invoice_number.set_value('');\n\t\t\t\t\tcustom_po_number.set_value('');\n\t\t\t\t\tcustom_representative.set_value('');\n\t\t\t\t\tcustom_id_number.set_value('');\n\t\t\t\t\tcustom_approved_by.set_value('');\n\t\t\t\t\t// let reference_no = reference_no_control.get_value();\n\n\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_customer\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_charge_invoice_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_po_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_representative\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_id_number\", '');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_approved_by\", '');\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\n\t\t\t\t});\n\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t\tcustom_customer,\n\t\t\t\t\tcustom_po_number,\n\t\t\t\t\tcharge_invoice_number,\n\t\t\t\t\tcustom_representative,\n\t\t\t\t\tcustom_id_number,\n\t\t\t\t\tcustom_approved_by,\n\t\t\t\t];\n\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t\tif (p.mode_of_payment === \"Gift Certificate\") {\n\n\t\t\t\t// Create input field\n\t\t\t\tlet code_input = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\tlabel: 'Gift Code',\n\t\t\t\t\t\tplaceholder: 'Enter Gift Code'\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.gift-code`)[0],\n\t\t\t\t\trender_input: true\n\t\t\t\t});\n\t\t\t\n\t\t\t\tcode_input.refresh();\n\t\t\t\n\t\t\t\t// Create button\n\t\t\t\tlet button = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Add Gift Code',\n\t\t\t\t\t\tfieldtype: 'Button',\n\t\t\t\t\t\tbtn_size: 'sm', // xs, sm, lg\n\t\t\t\t\t\tclick: function () {\n\t\t\t\t\t\t\tlet code_value = code_input.get_value();\n\t\t\t\t\t\t\tif (code_value) {\n\t\t\t\t\t\t\t\tfrappe.db.get_doc(\"Amesco Gift Certificate\", code_value)\n\t\t\t\t\t\t\t\t\t.then(gift_cert => {\n\t\t\t\t\t\t\t\t\t\t// Add the gift amount to the existing payment amount\n\t\t\t\t\t\t\t\t\t\tif (gift_cert.is_used !== 1) {\n\t\t\t\t\t\t\t\t\t\t\tlet current_amount = flt(frappe.model.get_value(p.doctype, p.name, \"amount\"));\n\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", current_amount + flt(gift_cert.amount));\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t// Push the gift code and its amount to the codes array\n\t\t\t\t\t\t\t\t\t\t\tfrm.add_child(\"custom_gift_cert_used\", {\n\t\t\t\t\t\t\t\t\t\t\t\tcode: code_value,\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: __('Success'),\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: __('Gift Certificate code added successfully.'),\n\t\t\t\t\t\t\t\t\t\t\t\tindicator: 'green',\n\t\t\t\t\t\t\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\t\t\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t// Clear input field for the next gift code\n\t\t\t\t\t\t\t\t\t\t\tcode_input.set_value('');\n\t\t\t\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\t\t\t\t\t\t\t\tindicator: 'red',\n\t\t\t\t\t\t\t\t\t\t\t\tmessage: __('Gift Code Already Used. Please check the code and try again.')\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch(error => {\n\t\t\t\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\t\t\t\t\t\t\tindicator: 'red',\n\t\t\t\t\t\t\t\t\t\t\tmessage: __('Invalid Gift Code. Please check the code and try again.')\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.msgprint({\n\t\t\t\t\t\t\t\t\ttitle: __('Error'),\n\t\t\t\t\t\t\t\t\tindicator: 'red',\n\t\t\t\t\t\t\t\t\tmessage: __('Please enter a gift code before clicking Add Gift Code.')\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.button-code`)[0], // Ensure correct parent DOM element\n\t\t\t\t\trender_input: true\n\t\t\t\t});\n\t\t\t\n\t\t\t\tbutton.refresh();\n\t\t\t\n\t\t\t\t// Create discard button\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\">Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\t\t\t\n\t\t\t\tconst me = this;\n\t\t\t\n\t\t\t\t// Attach an event listener to the discard button\n\t\t\t\tdiscard_button.on('click', function () {\n\t\t\t\t\tme[`${mode}_control`].set_value('');\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function () {\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t$(document).on('keydown', function (e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\n\t\t\t\t// Attach keypress event to the code input field\n\t\t\t\tcode_input.$input && code_input.$input.keypress(function (e) {\n\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\tbutton.$input.trigger('click'); // Trigger the button click\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (p.mode_of_payment === \"Amesco Plus\") {\n\t\t\t\tlet button = frappe.ui.form.make_control({\n\t\t\t\t\tdf: {\n\t\t\t\t\t\tlabel: 'Scan',\n\t\t\t\t\t\tfieldtype: 'Button',\n\t\t\t\t\t\tbtn_size: 'sm', // xs, sm, lg\n\t\t\t\t\t\tclick: function () {\n\t\t\t\t\t\t\t// console.log('Click');\n\t\t\t\t\t\t\tnew frappe.ui.Scanner({\n\t\t\t\t\t\t\t\tdialog: true, // open camera scanner in a dialog\n\t\t\t\t\t\t\t\tmultiple: false, // stop after scanning one value\n\t\t\t\t\t\t\t\ton_scan(data) {\n\t\t\t\t\t\t\t\t\t// Assuming the scanned data is comma-separated\n\t\t\t\t\t\t\t\t\tlet scannedData = data.decodedText.split(',');\n\t\t\t\t\t\t\t\t\tconsole.log(\"scannedData\", scannedData);\n\t\t\t\t\t\t\t\t\t// Extracting fields from the scanned data\n\t\t\t\t\t\t\t\t\tlet voucher_code = scannedData[0]; //'AVQR8105441319'\n\t\t\t\t\t\t\t\t\tlet user_id = scannedData[1];\n\t\t\t\t\t\t\t\t\t// let date = scannedData[3];\n\t\t\t\t\t\t\t\t\tlet email = scannedData[4];\n\t\t\t\t\t\t\t\t\tlet amesco_points = scannedData[2];\n\n\t\t\t\t\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\t\t\t\t\tmethod: \"custom_app.customapp.doctype.used_ameco_plus_code.used_ameco_plus_code.check_used_amesco_plus_code\",\n\t\t\t\t\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\t\t\t\t\tcode: voucher_code\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tcallback: function(response) {\n\t\t\t\t\t\t\t\t\t\t\tif (response.message) {\n\t\t\t\t\t\t\t\t\t\t\t\tfrappe.msgprint(__('Amesco Plus voucher is already used.'));\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tlet details_dialog = new frappe.ui.Dialog({\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: __('Scanned Amesco Plus User'),\n\t\t\t\t\t\t\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'Voucher Code',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldname: 'voucher_code',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: voucher_code\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'User ID',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldname: 'user_id',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: user_id\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'Email',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldname: 'email',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: email\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: 'Redeem Points',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldname: 'points',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefault: amesco_points\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\tprimary_action_label: __('Ok'),\n\t\t\t\t\t\t\t\t\t\t\t\tprimary_action: function () {\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_am_voucher_code\", voucher_code);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_am_plus_user_id\", user_id);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"custom_am_plus_user_email\", email);\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", flt(amesco_points));\n\t\t\t\t\t\t\t\t\t\t\t\t\tfrm.add_child(\"custom_ameco_plus_code_used\", {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcode: voucher_code,\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\tdetails_dialog.hide();\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\tdetails_dialog.show();\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tparent: this.$payment_modes.find(`.${mode}.button-amesco-plus`)[0],\n\t\t\t\t\trender_input: true\n\t\t\t\t});\n\t\t\t\tbutton.refresh();\n\n\t\t\t\tlet discard_button = $('<button class=\"btn btn-secondary\" >Discard</button>');\n\t\t\t\tthis.$payment_modes.find(`.${mode}.discard-button`).append(discard_button);\n\t\t\t\tconst me = this;\n\t\t\t\t// Attach an event listener to the save button\n\n\t\t\t\tdiscard_button.on('click', function() {\n\t\t\t\t\tme[`${mode}_control`].set_value('');\n\t\t\t\t\t// let reference_no = reference_no_control.get_value()\n\t\t\t\t\tfrappe.model.set_value(p.doctype, p.name, \"amount\", 0);\n\t\t\t\t\t// frappe.model.set_value(p.doctype, p.name, \"reference_no\", reference_no);\n\t\t\t\n\t\t\t\t\tconst dialog = frappe.msgprint({\n\t\t\t\t\t\tmessage: __('Payment details have been discarded.'),\n\t\t\t\t\t\tindicator: 'blue',\n\t\t\t\t\t\tprimary_action: {\n\t\t\t\t\t\t\tlabel: __('OK'),\n\t\t\t\t\t\t\taction: function() {\n\t\t\t\t\t\t\t\t// Close the dialog\n\t\t\t\t\t\t\t\tfrappe.msg_dialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\t$(document).on('keydown', function(e) {\n\t\t\t\t\t\tif (e.which === 13 && dialog.$wrapper.is(':visible')) { // 13 is the Enter key code\n\t\t\t\t\t\t\tdialog.get_primary_btn().trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\n\t\t\t\t\t// Remove event listener when dialog is closed\n\t\t\t\t\tdialog.$wrapper.on('hidden.bs.modal', function () {\n\t\t\t\t\t\t$(document).off('keydown');\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tconst controls = [\n\t\t\t\t\tme[`${mode}_control`],\n\t\t\t\t];\n\t\t\t\tcontrols.forEach(control => {\n\t\t\t\t\tcontrol.$input && control.$input.keypress(function (e) {\n\t\t\t\t\t\tif (e.which === 13) { // Enter key pressed\n\t\t\t\t\t\t\tsave_button.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\n\n\n\t\t\t}\n\t\t\t// this[`${mode}_control`].toggle_label(true);\n\t\t\tthis[`${mode}_control`].set_value(p.amount);\n\t\t});\n\t\tthis.render_loyalty_points_payment_mode();\n\t\tthis.attach_cash_shortcuts(doc);\n\t}\n\n\n\n\tfocus_on_default_mop() {\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst payments = doc.payments;\n\t\tpayments.forEach((p) => {\n\t\t\tconst mode = p.mode_of_payment.replace(/ +/g, \"_\").toLowerCase();\n\t\t\tif (p.default) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.$payment_modes.find(`.${mode}.mode-of-payment-control`).parent().click();\n\t\t\t\t}, 500);\n\t\t\t}\n\t\t});\n\t}\n\nattach_cash_shortcuts(doc) {\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? doc.grand_total\n\t\t\t: doc.rounded_total;\n\t\tconst currency = doc.currency;\n\n\t\tconst shortcuts = this.get_cash_shortcuts(flt(grand_total));\n\n\t\tthis.$payment_modes.find(\".cash-shortcuts\").remove();\n\t\tlet shortcuts_html = shortcuts\n\t\t\t.map((s) => {\n\t\t\t\treturn `<div class=\"shortcut\" data-value=\"${s}\">${format_currency(s, currency, 0)}</div>`;\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tthis.$payment_modes\n\t\t\t.find('[data-payment-type=\"Cash\"]')\n\t\t\t.find(\".mode-of-payment-control\")\n\t\t\t.after(`<div class=\"cash-shortcuts\">${shortcuts_html}</div>`);\n\t}\n\n\tget_cash_shortcuts(grand_total) {\n\t\tlet steps = [1, 5, 10];\n\t\tconst digits = String(Math.round(grand_total)).length;\n\t\n\t\tsteps = steps.map((x) => x * 10 ** (digits - 2));\n\t\n\t\tconst get_nearest = (amount, x) => {\n\t\t\tlet nearest_x = Math.ceil(amount / x) * x;\n\t\t\treturn nearest_x === amount ? nearest_x + x : nearest_x;\n\t\t};\n\t\n\t\tlet shortcuts = steps.reduce((finalArr, x) => {\n\t\t\tlet nearest_x = get_nearest(grand_total, x);\n\t\t\tnearest_x = finalArr.indexOf(nearest_x) != -1 ? nearest_x + x : nearest_x;\n\t\t\treturn [...finalArr, nearest_x];\n\t\t}, []);\n\t\n\t\t// Add 500 and 1000 if grand total is above 100\n\t\tif (grand_total > 100) {\n\t\t\tif (!shortcuts.includes(500)) {\n\t\t\t\tshortcuts.push(500);\n\t\t\t}\n\t\t\tif (!shortcuts.includes(1000)) {\n\t\t\t\tshortcuts.push(1000);\n\t\t\t}\n\t\t}\n\t\n\t\t// Sort shortcuts in ascending order\n\t\tshortcuts.sort((a, b) => a - b);\n\t\n\t\treturn shortcuts;\n\t}\n\n\n\trender_loyalty_points_payment_mode() {\n\t\tconst me = this;\n\t\tconst doc = this.events.get_frm().doc;\n\t\tconst { loyalty_program, loyalty_points, conversion_factor } = this.events.get_customer_details();\n\n\t\tthis.$payment_modes.find(`.mode-of-payment[data-mode=\"loyalty-amount\"]`).parent().remove();\n\n\t\tif (!loyalty_program) return;\n\n\t\tlet description, read_only, max_redeemable_amount;\n\t\tif (!loyalty_points) {\n\t\t\tdescription = __(\"You don't have enough points to redeem.\");\n\t\t\tread_only = true;\n\t\t} else {\n\t\t\tmax_redeemable_amount = flt(\n\t\t\t\tflt(loyalty_points) * flt(conversion_factor),\n\t\t\t\tprecision(\"loyalty_amount\", doc)\n\t\t\t);\n\t\t\tdescription = __(\"You can redeem upto {0}.\", [format_currency(max_redeemable_amount)]);\n\t\t\tread_only = false;\n\t\t}\n\n\t\tconst margin = this.$payment_modes.children().length % 2 === 0 ? \"pr-2\" : \"pl-2\";\n\t\tconst amount = doc.loyalty_amount > 0 ? format_currency(doc.loyalty_amount, doc.currency) : \"\";\n\t\tthis.$payment_modes.append(\n\t\t\t`<div class=\"payment-mode-wrapper\">\n\t\t\t\t<div class=\"mode-of-payment loyalty-card\" data-mode=\"loyalty-amount\" data-payment-type=\"loyalty-amount\">\n\t\t\t\t\tRedeem Loyalty Points\n\t\t\t\t\t<div class=\"loyalty-amount-amount pay-amount\">${amount}</div>\n\t\t\t\t\t<div class=\"loyalty-amount-name\">${loyalty_program}</div>\n\t\t\t\t\t<div class=\"loyalty-amount mode-of-payment-control\"></div>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t);\n\n\t\tthis[\"loyalty-amount_control\"] = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Redeem Loyalty Points\"),\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tplaceholder: __(\"Enter amount to be redeemed.\"),\n\t\t\t\toptions: \"company:currency\",\n\t\t\t\tread_only,\n\t\t\t\tonchange: async function () {\n\t\t\t\t\tif (!loyalty_points) return;\n\n\t\t\t\t\tif (this.value > max_redeemable_amount) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"You cannot redeem more than {0}.\", [\n\t\t\t\t\t\t\t\tformat_currency(max_redeemable_amount),\n\t\t\t\t\t\t\t]),\n\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"submit\");\n\t\t\t\t\t\tme[\"loyalty-amount_control\"].set_value(0);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst redeem_loyalty_points = this.value > 0 ? 1 : 0;\n\t\t\t\t\tawait frappe.model.set_value(\n\t\t\t\t\t\tdoc.doctype,\n\t\t\t\t\t\tdoc.name,\n\t\t\t\t\t\t\"redeem_loyalty_points\",\n\t\t\t\t\t\tredeem_loyalty_points\n\t\t\t\t\t);\n\t\t\t\t\tfrappe.model.set_value(\n\t\t\t\t\t\tdoc.doctype,\n\t\t\t\t\t\tdoc.name,\n\t\t\t\t\t\t\"loyalty_points\",\n\t\t\t\t\t\tparseInt(this.value / conversion_factor)\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tdescription,\n\t\t\t},\n\t\t\tparent: this.$payment_modes.find(`.loyalty-amount.mode-of-payment-control`),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis[\"loyalty-amount_control\"].toggle_label(false);\n\n\t\t// this.render_add_payment_method_dom();\n\t}\n\n\trender_add_payment_method_dom() {\n\t\tconst docstatus = this.events.get_frm().doc.docstatus;\n\t\tif (docstatus === 0)\n\t\t\tthis.$payment_modes.append(\n\t\t\t\t`<div class=\"w-full pr-2\">\n\t\t\t\t\t<div class=\"add-mode-of-payment w-half text-grey mb-4 no-select pointer\">+ Add Payment Method</div>\n\t\t\t\t</div>`\n\t\t\t);\n\t}\n\n\tupdate_totals_section(doc) {\n\t\tif (!doc) doc = this.events.get_frm().doc;\n\t\tconst paid_amount = doc.paid_amount;\n\t\tconst grand_total = cint(frappe.sys_defaults.disable_rounded_total)\n\t\t\t? doc.grand_total\n\t\t\t: doc.rounded_total;\n\t\tconst remaining = grand_total - doc.paid_amount;\n\t\tconst change = doc.change_amount || remaining <= 0 ? -1 * remaining : undefined;\n\t\tconst currency = doc.currency;\n\t\tconst label = change ? __(\"Change\") : __(\"To Be Paid\");\n\n\t\tthis.$totals.html(\n\t\t\t`<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__(\"Grand Total\")}</div>\n\t\t\t\t<div class=\"value\">${format_currency(grand_total, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${__(\"Paid Amount\")}</div>\n\t\t\t\t<div class=\"value\">${format_currency(paid_amount, currency)}</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator-y\"></div>\n\t\t\t<div class=\"col\">\n\t\t\t\t<div class=\"total-label\">${label}</div>\n\t\t\t\t<div class=\"value\">${format_currency(change || remaining, currency)}</div>\n\t\t\t</div>`\n\t\t);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css(\"display\", \"flex\") : this.$component.css(\"display\", \"none\");\n\t}\n};", "custom_app.PointOfSale.PastOrderList = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.make_filter_section();\n\t\tthis.bind_events();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-list\">\n\t\t\t\t<div class=\"filter-section\">\n\t\t\t\t\t<div class=\"label\">${__(\"Pending Orders\")} <span class=\"invoice-count ml-3 badge rounded-pill bg-danger text-white\"></span> </div>\n\t\t\t\t\t<div class=\"search-field\"></div>\n\t\t\t\t\t<div class=\"status-field\"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoices-container\"></div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".past-order-list\");\n\t\tthis.$invoices_container = this.$component.find(\".invoices-container\");\n\t\tthis.$invoice_count = this.$component.find(\".invoice-count\");\n\t}\n\n\tbind_events() {\n\t\tthis.search_field.$input.on(\"input\", (e) => {\n\t\t\tclearTimeout(this.last_search);\n\t\t\tthis.last_search = setTimeout(() => {\n\t\t\t\tconst search_term = e.target.value;\n\t\t\t\tthis.refresh_list(search_term, this.status_field.get_value());\n\t\t\t}, 300);\n\t\t});\n\t\tconst me = this;\n\t\tthis.$invoices_container.on(\"click\", \".invoice-wrapper\", function () {\n\t\t\tconst invoice_name = unescape($(this).attr(\"data-invoice-name\"));\n\n\t\t\tme.events.open_invoice_data(invoice_name);\n\t\t});\n\n\n\t\tthis.$invoices_container.off('keydown', '.invoice-wrapper').on('keydown', '.invoice-wrapper', function(event) {\n\t\t\tconst $items = me.$invoices_container.find('.invoice-wrapper');\n\t\t\tconst currentIndex = $items.index($(this));\n\t\t\tlet nextIndex = currentIndex;\n\t\n\t\t\tswitch (event.which) {\n\t\t\t\tcase 13: // Enter key\n\t\t\t\t\t$(this).trigger('click'); // Trigger click event immediately on Enter key press\n\t\t\t\t\tbreak;\n\t\t\t\tcase 38: // Up arrow key\n\t\t\t\t\tnextIndex = currentIndex > 0 ? currentIndex - 1 : $items.length - 1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 40: // Down arrow key\n\t\t\t\t\tnextIndex = currentIndex < $items.length - 1 ? currentIndex + 1 : 0;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn; // Exit if other keys are pressed\n\t\t\t}\n\t\n\t\t\t$items.eq(nextIndex).focus(); // Move focus to the next item\n\t\t});\n\t\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: 'ctrl+i',\n\t\t\taction: () => {\n\t\t\t\tconst $items = me.$invoices_container.find('.invoice-wrapper');\n\t\t\t\tif ($items.length) {\n\t\t\t\t\t$items.first().focus(); // Focus on the first cart item\n\t\t\t\t}\n\t\t\t},\n\t\t\tcondition: () => me.$invoices_container.is(':visible'),\n\t\t\tdescription: __('Activate Cart Item Focus'),\n\t\t\tignore_inputs: true,\n\t\t\tpage: cur_page.page.page // Replace with your actual page context\n\t\t});\n\n\n\n\n\t}\n\n\tmake_filter_section() {\n\t\tconst me = this;\n\t\tthis.search_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Search\"),\n\t\t\t\tfieldtype: \"Data\",\n\t\t\t\tplaceholder: __(\"Search by invoice id or customer name\"),\n\t\t\t},\n\t\t\tparent: this.$component.find(\".search-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.status_field = frappe.ui.form.make_control({\n\t\t\tdf: {\n\t\t\t\tlabel: __(\"Invoice Status\"),\n\t\t\t\tfieldtype: \"Select\",\n\t\t\t\toptions: `Draft`,\n\t\t\t\tplaceholder: __(\"Filter by invoice status\"),\n\t\t\t\tonchange: function () {\n\t\t\t\t\tif (me.$component.is(\":visible\")) me.refresh_list();\n\t\t\t\t},\n\t\t\t},\n\t\t\tparent: this.$component.find(\".status-field\"),\n\t\t\trender_input: true,\n\t\t});\n\t\tthis.search_field.toggle_label(true);\n\t\tthis.status_field.toggle_label(false);\n\t\tthis.status_field.set_value(\"Draft\");\n\n\t\tsetTimeout(() => {\n\t\t\tthis.search_field.$input.focus();\n\t\t}, 100);\n\t}\n\n\trefresh_list() {\n\t\tfrappe.dom.freeze();\n\t\tthis.events.reset_summary();\n\t\tconst search_term = this.search_field.get_value();\n\t\tconst status = this.status_field.get_value();\n\t\tconst pos_profile = this.events.pos_profile();\n\t\tconst source_warehouse = this.events.source_warehouse();\n\n\t\tthis.$invoices_container.html(\"\");\n\n\t\treturn frappe.call({\n\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.get_past_order_list\",\n\t\t\tfreeze: true,\n\t\t\targs: { search_term, status, pos_profile },\n\t\t\tcallback: (response) => {\n\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\tresponse.message.forEach((invoice) => {\n\t\t\t\t\tconst invoice_html = this.get_invoice_html(invoice);\n\t\t\t\t\tthis.$invoices_container.append(invoice_html);\n\t\t\t\t});\n\t\t\t\n\t\t\t\tthis.$invoice_count.text(response.message.length);\n\t\t\t},\n\t\t});\n\t}\n\n\tget_invoice_html(invoice) {\n\t\tconst posting_datetime = moment(invoice.posting_date + \" \" + invoice.posting_time).format(\n\t\t\t\"Do MMMM, h:mma\"\n\t\t);\n\t\treturn `<div class=\"invoice-wrapper\" tabindex=\"0\" data-invoice-name=\"${escape(invoice.name)}\">\n\t\t\t\t<div class=\"invoice-name-date\">\n\t\t\t\t\t<div class=\"invoice-name\">${invoice.name}</div>\n\t\t\t\t\t<div class=\"invoice-date\">\n\t\t\t\t\t\t<svg class=\"mr-2\" width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"1\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n\t\t\t\t\t\t\t<path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"/><circle cx=\"12\" cy=\"7\" r=\"4\"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t${frappe.ellipsis(invoice.customer_name, 20)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-total-status\">\n\t\t\t\t\t<div class=\"invoice-total\">${format_currency(invoice.grand_total, invoice.currency) || 0}</div>\n\t\t\t\t\t<div class=\"invoice-date\">${posting_datetime}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"seperator\"></div>`;\n\t}\n\n\ttoggle_component(show) {\n\t\tshow\n\t\t\t? this.$component.css(\"display\", \"flex\") && this.refresh_list()\n\t\t\t: this.$component.css(\"display\", \"none\");\n\t}\n};\n", "custom_app.PointOfSale.PastOrderSummary = class {\n\tconstructor({ wrapper, events }) {\n\t\tthis.wrapper = wrapper;\n\t\tthis.events = events;\n\n\t\tthis.init_component();\n\t}\n\n\tinit_component() {\n\t\tthis.prepare_dom();\n\t\tthis.init_email_print_dialog();\n\t\tthis.bind_events();\n\t\tthis.attach_shortcuts();\n\t}\n\n\tprepare_dom() {\n\t\tthis.wrapper.append(\n\t\t\t`<section class=\"past-order-summary\">\n\t\t\t\t<div class=\"no-summary-placeholder\">\n\t\t\t\t\t${__(\"Select an invoice to load summary data\")}\n\t\t\t\t</div>\n\t\t\t\t<div class=\"invoice-summary-wrapper\" style=\"width:50rem !important;\">\n\t\t\t\t\t<div class=\"abs-container\">\n\t\t\t\t\t\t<div class=\"upper-section\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__(\"Items\")}</div>\n\t\t\t\t\t\t<div class=\"items-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__(\"Totals\")}</div>\n\t\t\t\t\t\t<div class=\"totals-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"label\">${__(\"Payments\")}</div>\n\t\t\t\t\t\t<div class=\"payments-container summary-container\"></div>\n\t\t\t\t\t\t<div class=\"summary-btns\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</section>`\n\t\t);\n\n\t\tthis.$component = this.wrapper.find(\".past-order-summary\");\n\t\tthis.$summary_wrapper = this.$component.find(\".invoice-summary-wrapper\");\n\t\tthis.$summary_container = this.$component.find(\".abs-container\");\n\t\tthis.$upper_section = this.$summary_container.find(\".upper-section\");\n\t\tthis.$items_container = this.$summary_container.find(\".items-container\");\n\t\tthis.$totals_container = this.$summary_container.find(\".totals-container\");\n\t\tthis.$payment_container = this.$summary_container.find(\".payments-container\");\n\t\tthis.$summary_btns = this.$summary_container.find(\".summary-btns\");\n\t}\n\n\tinit_email_print_dialog() {\n\t\tconst email_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: \"Email Receipt\",\n\t\t\tfields: [\n\t\t\t\t{ fieldname: \"email_id\", fieldtype: \"Data\", options: \"Email\", label: \"Email ID\", reqd: 1 },\n\t\t\t\t{ fieldname: \"content\", fieldtype: \"Small Text\", label: \"Message (if any)\" },\n\t\t\t],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.send_email();\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Send\"),\n\t\t});\n\t\tthis.email_dialog = email_dialog;\n\n\t\tconst print_dialog = new frappe.ui.Dialog({\n\t\t\ttitle: \"Print Receipt\",\n\t\t\tfields: [{ fieldname: \"print\", fieldtype: \"Data\", label: \"Print Preview\" }],\n\t\t\tprimary_action: () => {\n\t\t\t\tthis.print_receipt();\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Print\"),\n\t\t});\n\t\tthis.print_dialog = print_dialog;\n\t}\n\n\tget_upper_section_html(doc) {\n\n\t\t// console.log(\"Paid Amount\",doc)\n\t\tconst { status } = doc;\n\t\tlet indicator_color = \"\";\n\n\t\tconst sold_by = status === \"Draft\" ? doc.custom_pa_name : doc.custom_cashier_name;\n\n\t\t[\"Paid\", \"Consolidated\"].includes(status) && (indicator_color = \"green\");\n\t\tstatus === \"Draft\" && (indicator_color = \"red\");\n\t\tstatus === \"Return\" && (indicator_color = \"grey\");\n\n\t\treturn `<div class=\"left-section\">\n\t\t\t\t\t<div class=\"customer-name\">${doc.customer_name}</div>\n\t\t\t\t\t<div class=\"customer-email\">${this.customer_email}</div>\n\t\t\t\t\t<div class=\"cashier\"> Take by:  ${__(sold_by)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"right-section\">\n\t\t\t\t\t<div class=\"paid-amount\">${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t\t<div class=\"invoice-name\">${doc.name}</div>\n\t\t\t\t\t<span class=\"indicator-pill whitespace-nowrap ${indicator_color}\"><span>${doc.status}</span></span>\n\t\t\t\t</div>`;\n\t}\n\n\tget_item_html(doc, item_data) {\n\t\treturn `<div class=\"item-row-wrapper\">\n\t\t\t\t\t<div class=\"item-name\">${item_data.item_name}</div>\n\t\t\t\t\t<div class=\"item-qty\"></div>\n\t\t\t\t\t<div class=\"item-rate-disc\">${get_rate_discount_html()}</div>\n\t\t\t\t</div>`;\n\t\n\t\tfunction get_rate_discount_html() {\n\t\t\tlet rate_html = '';\n\t\t\tlet amount_html = `<span class=\"item-amount\" style=\"padding-left:1rem;\">${format_currency(item_data.amount, doc.currency)}</span>`;\n\t\t\tlet qty_html = `<span class=\"qty\" style=\"padding-left:1rem;\">${item_data.qty || 0} ${item_data.uom}</span>`;\n\t\n\t\t\tif (item_data.rate && item_data.price_list_rate && item_data.rate !== item_data.price_list_rate) {\n\t\t\t\trate_html = `<span class=\"item-disc\">(${item_data.discount_percentage}% off)</span>\n\t\t\t\t\t\t\t <div class=\"item-rate\">${format_currency(item_data.rate, doc.currency)}</div>`;\n\t\t\t} else {\n\t\t\t\trate_html = `<div class=\"item-rate\">${format_currency(\n\t\t\t\t\titem_data.price_list_rate || item_data.rate,\n\t\t\t\t\tdoc.currency\n\t\t\t\t)}</div>`;\n\t\t\t}\n\t\n\t\t\treturn `${rate_html} ${qty_html} ${amount_html}`;\n\t\t}\n\t}\n\t\n\n\tget_discount_html(doc) {\n\t\tif (doc.discount_amount) {\n\t\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t\t<div>Discount (${doc.additional_discount_percentage} %)</div>\n\t\t\t\t\t\t<div>${format_currency(doc.discount_amount, doc.currency)}</div>\n\t\t\t\t\t</div>`;\n\t\t} else {\n\t\t\treturn ``;\n\t\t}\n\t}\n\n\tget_vatable_sales_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__(\"VATable Sales\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.custom_vatable_sales, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_vatable_exempt_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__(\"VAT-Exempt Sales\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.custom_vat_exempt_sales, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_zero_rated_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__(\"Zero-Rated\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.custom_zero_rated_sales, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_vat_amount_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__(\"VAT 12%\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.custom_vat_amount, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_net_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper\">\n\t\t\t\t\t<div>${__(\"Net Total\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.net_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\t// get_taxes_html(doc) {\n\t// \tif (!doc.taxes.length) return \"\";\n\n\t// \tlet taxes_html = doc.taxes\n\t// \t\t.map((t) => {\n\t// \t\t\t// if tax rate is 0, don't print it.\n\t// \t\t\tconst description = /[0-9]+/.test(t.description)\n\t// \t\t\t\t? t.description\n\t// \t\t\t\t: t.rate != 0\n\t// \t\t\t\t\t? `${t.description} @ ${t.rate}%`\n\t// \t\t\t\t\t: t.description;\n\t// \t\t\treturn `\n\t// \t\t\t<div class=\"tax-row\">\n\t// \t\t\t\t<div class=\"tax-label\">${description}</div>\n\t// \t\t\t\t<div class=\"tax-value\">${format_currency(t.tax_amount_after_discount_amount, doc.currency)}</div>\n\t// \t\t\t</div>\n\t// \t\t`;\n\t// \t\t})\n\t// \t\t.join(\"\");\n\n\t// \treturn `<div class=\"taxes-wrapper\">${taxes_html}</div>`;\n\t// }\n\n\n\tget_grand_total_html(doc) {\n\t\treturn `<div class=\"summary-row-wrapper grand-total\">\n\t\t\t\t\t<div>${__(\"Grand Total\")}</div>\n\t\t\t\t\t<div>${format_currency(doc.grand_total, doc.currency)}</div>\n\t\t\t\t</div>`;\n\t}\n\n\tget_payment_html(doc, payment) {\n\t\treturn `<div class=\"summary-row-wrapper payments\">\n\t\t\t\t\t<div>${__(payment.mode_of_payment)}</div>\n\t\t\t\t\t<div>${format_currency(payment.amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"summary-row-wrapper change\">\n\t\t\t\t\t<div>${__('Change')}</div>\n\t\t\t\t\t<div>${format_currency(doc.change_amount, doc.currency)}</div>\n\t\t\t\t</div>\n\t\t\t\t`; // added change for payments\n\t}\n\n\tbind_events() {\n\t\tthis.$summary_container.on(\"click\", \".return-btn\", () => {\n\t\t\tthis.events.process_return(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".edit-btn\", () => {\n\t\t\tthis.events.edit_order(this.doc.name);\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".delete-btn\", () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".delete-btn\", () => {\n\t\t\tthis.events.delete_order(this.doc.name);\n\t\t\tthis.show_summary_placeholder();\n\t\t\t// this.toggle_component(false);\n\t\t\t// this.$component.find('.no-summary-placeholder').removeClass('d-none');\n\t\t\t// this.$summary_wrapper.addClass('d-none');\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".new-btn\", () => {\n\t\t\tthis.events.new_order();\n\t\t\tthis.toggle_component(false);\n\t\t\tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".email-btn\", () => {\n\t\t\tthis.email_dialog.fields_dict.email_id.set_value(this.customer_email);\n\t\t\tthis.email_dialog.show();\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".print-btn\", () => {\n\t\t\tthis.print_receipt();\n\t\t});\n\n\t\tthis.$summary_container.on(\"click\", \".proceed-btn\", () => {\n\t\t\tthis.events.proceed_order(this.doc.name);\n\t\t\tthis.toggle_component(false); // Show the payment component\n\t\t\tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"flex\");\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t});\n\n\n\t\t// this.$summary_container.on(\"click\", \".order-btn\", () => {\n\t\t// \tthis.events.order_list();\n\t\t// \tthis.toggle_component(false);\n\t\t// \tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"flex\");\n\t\t// \tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t// });\n\n\t}\n\n\tprint_receipt() {\n\t\tconst frm = this.events.get_frm();\n\t\tfrappe.utils.print(\n\t\t\tthis.doc.doctype,\n\t\t\tthis.doc.name,\n\t\t\tfrm.pos_print_format,\n\t\t\tthis.doc.letter_head,\n\t\t\tthis.doc.language || frappe.boot.lang\n\t\t);\n\t}\n\n\tattach_shortcuts() {\n\t\tconst ctrl_label = frappe.utils.is_mac() ? \"\u2318\" : \"Ctrl\";\n\t\tthis.$summary_container.find(\".print-btn\").attr(\"title\", `${ctrl_label}+P`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+p\",\n\t\t\taction: () => this.$summary_container.find(\".print-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && this.$summary_container.find(\".print-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Print Receipt\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t\tthis.$summary_container.find(\".new-btn\").attr(\"title\", `${ctrl_label}+Enter`);\n\t\tfrappe.ui.keys.on(\"ctrl+enter\", () => {\n\t\t\tconst summary_is_visible = this.$component.is(\":visible\");\n\t\t\tif (summary_is_visible && this.$summary_container.find(\".new-btn\").is(\":visible\")) {\n\t\t\t\tthis.$summary_container.find(\".new-btn\").click();\n\t\t\t}\n\t\t});\n\t\tthis.$summary_container.find(\".edit-btn\").attr(\"title\", `${ctrl_label}+>`);\n\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+>\",\n\t\t\taction: () => this.$summary_container.find(\".edit-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && this.$summary_container.find(\".edit-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Edit Receipt\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\n\t\tthis.$summary_container.find(\".proceed-btn\").attr(\"title\", `${ctrl_label}+O`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+o\",\n\t\t\taction: () => this.$summary_container.find(\".proceed-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && this.$summary_container.find(\".proceed-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Proceed Order\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\n\t\tthis.$summary_container.find(\".edit-btn\").attr(\"title\", `${ctrl_label}+E`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+e\",\n\t\t\taction: () => this.$summary_container.find(\".edit-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && this.$summary_container.find(\".edit-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Edit Order\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\n\n\t\tthis.$summary_container.find(\".delete-btn\").attr(\"title\", `${ctrl_label}+X`);\n\t\tfrappe.ui.keys.add_shortcut({\n\t\t\tshortcut: \"ctrl+x\",\n\t\t\taction: () => this.$summary_container.find(\".delete-btn\").click(),\n\t\t\tcondition: () =>\n\t\t\t\tthis.$component.is(\":visible\") && this.$summary_container.find(\".delete-btn\").is(\":visible\"),\n\t\t\tdescription: __(\"Delete Order\"),\n\t\t\tpage: cur_page.page.page,\n\t\t});\n\t}\n\n\tsend_email() {\n\t\tconst frm = this.events.get_frm();\n\t\tconst recipients = this.email_dialog.get_values().email_id;\n\t\tconst content = this.email_dialog.get_values().content;\n\t\tconst doc = this.doc || frm.doc;\n\t\tconst print_format = frm.pos_print_format;\n\n\t\tfrappe.call({\n\t\t\tmethod: \"frappe.core.doctype.communication.email.make\",\n\t\t\targs: {\n\t\t\t\trecipients: recipients,\n\t\t\t\tsubject: __(frm.meta.name) + \": \" + doc.name,\n\t\t\t\tcontent: content ? content : __(frm.meta.name) + \": \" + doc.name,\n\t\t\t\tdoctype: doc.doctype,\n\t\t\t\tname: doc.name,\n\t\t\t\tsend_email: 1,\n\t\t\t\tprint_format,\n\t\t\t\tsender_full_name: frappe.user.full_name(),\n\t\t\t\t_lang: doc.language,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tif (!r.exc) {\n\t\t\t\t\tfrappe.utils.play_sound(\"email\");\n\t\t\t\t\tif (r.message[\"emails_not_sent_to\"]) {\n\t\t\t\t\t\tfrappe.msgprint(\n\t\t\t\t\t\t\t__(\"Email not sent to {0} (unsubscribed / disabled)\", [\n\t\t\t\t\t\t\t\tfrappe.utils.escape_html(r.message[\"emails_not_sent_to\"]),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Email sent successfully.\"),\n\t\t\t\t\t\t\tindicator: \"green\",\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tthis.email_dialog.hide();\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__(\"There were errors while sending email. Please try again.\"));\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tadd_summary_btns(map) {\n\t\tthis.$summary_btns.html(\"\");\n\t\tmap.forEach((m) => {\n\t\t\tif (m.condition) {\n\t\t\t\tm.visible_btns.forEach((b) => {\n\t\t\t\t\tconst class_name = b.split(\" \")[0].toLowerCase();\n\t\t\t\t\tconst btn = __(b);\n\t\t\t\t\tthis.$summary_btns.append(\n\t\t\t\t\t\t`<div class=\"summary-btn btn btn-default ${class_name}-btn\">${btn}</div>`\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis.$summary_btns.children().last().removeClass(\"mr-4\");\n\t}\n\n\ttoggle_summary_placeholder(show) {\n\t\tif (show) {\n\t\t\tthis.$summary_wrapper.css(\"display\", \"none\");\n\t\t\tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"flex\");\n\t\t} else {\n\t\t\tthis.$summary_wrapper.css(\"display\", \"flex\");\n\t\t\tthis.$component.find(\".no-summary-placeholder\").css(\"display\", \"none\");\n\t\t}\n\t}\n\n\tget_condition_btn_map(after_submission) {\n\t\tif (after_submission)\n\t\t\treturn [{ condition: true, visible_btns: [\"Print Receipt\", \"Email Receipt\", \"New Order\"] }];\n\n\t\treturn [\n\t\t\t{ condition: this.doc.docstatus === 0, visible_btns: [\"Edit Order\", \"Proceed Order\"] },\n\t\t\t{\n\t\t\t\tcondition: !this.doc.is_return && this.doc.docstatus === 1,\n\t\t\t\tvisible_btns: [\"Print Receipt\", \"Email Receipt\", \"Return\"],\n\t\t\t},\n\t\t\t{\n\t\t\t\tcondition: this.doc.is_return && this.doc.docstatus === 1,\n\t\t\t\tvisible_btns: [\"Print Receipt\", \"Email Receipt\"],\n\t\t\t},\n\t\t];\n\t}\n\n\tload_summary_of(doc, after_submission = false) {\n\t\tafter_submission\n\t\t\t? this.$component.css(\"grid-column\", \"span 10 / span 10\")\n\t\t\t: this.$component.css(\"grid-column\", \"span 6 / span 6\");\n\n\t\tthis.toggle_summary_placeholder(false);\n\n\t\tthis.doc = doc;\n\n\t\tthis.attach_document_info(doc);\n\n\t\tthis.attach_items_info(doc);\n\n\t\tthis.attach_totals_info(doc);\n\n\t\tthis.attach_payments_info(doc);\n\n\t\tconst condition_btns_map = this.get_condition_btn_map(after_submission);\n\n\t\tthis.add_summary_btns(condition_btns_map);\n\t}\n\n\tattach_document_info(doc) {\n\t\tfrappe.db.get_value(\"Customer\", this.doc.customer, \"email_id\").then(({ message }) => {\n\t\t\tthis.customer_email = message.email_id || \"\";\n\t\t\tconst upper_section_dom = this.get_upper_section_html(doc);\n\t\t\tthis.$upper_section.html(upper_section_dom);\n\t\t});\n\t}\n\n\tattach_items_info(doc) {\n\t\tthis.$items_container.html(\"\");\n\t\tdoc.items.forEach((item) => {\n\t\t\tconst item_dom = this.get_item_html(doc, item);\n\t\t\tthis.$items_container.append(item_dom);\n\t\t\tthis.set_dynamic_rate_header_width();\n\t\t});\n\t}\n\n\tset_dynamic_rate_header_width() {\n\t\tconst rate_cols = Array.from(this.$items_container.find(\".item-rate-disc\"));\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", \"\");\n\t\tlet max_width = rate_cols.reduce((max_width, elm) => {\n\t\t\tif ($(elm).width() > max_width) max_width = $(elm).width();\n\t\t\treturn max_width;\n\t\t}, 0);\n\n\t\tmax_width += 1;\n\t\tif (max_width == 1) max_width = \"\";\n\n\t\tthis.$items_container.find(\".item-rate-disc\").css(\"width\", max_width);\n\t}\n\n\tattach_payments_info(doc) {\n\t\tthis.$payment_container.html(\"\");\n\t\tdoc.payments.forEach((p) => {\n\t\t\tif (p.amount) {\n\t\t\t\tconst payment_dom = this.get_payment_html(doc, p);\n\t\t\t\tthis.$payment_container.append(payment_dom);\n\t\t\t}\n\t\t});\n\t\tif (doc.redeem_loyalty_points && doc.loyalty_amount) {\n\t\t\tconst payment_dom = this.get_payment_html(doc, {\n\t\t\t\tmode_of_payment: \"Loyalty Points\",\n\t\t\t\tamount: doc.loyalty_amount,\n\t\t\t});\n\t\t\tthis.$payment_container.append(payment_dom);\n\t\t}\n\t}\n\n\tattach_totals_info(doc) {\n\t\tthis.$totals_container.html(\"\");\n\n\t\tconst net_total_dom = this.get_net_total_html(doc);\n\t\tconst vatable_sale_dom =this.get_vatable_sales_html(doc);\n\t\tconst vat_exempt_dom =this.get_vatable_exempt_html(doc);\n\t\tconst zero_rated_dom = this.get_zero_rated_html(doc);\n\t\tconst vat_amount_dom = this.get_vat_amount_html(doc);\n\t\t// const taxes_dom = this.get_taxes_html(doc);\n\t\tconst discount_dom = this.get_discount_html(doc);\n\t\tconst grand_total_dom = this.get_grand_total_html(doc);\n\t\tthis.$totals_container.append(net_total_dom);\n\t\tthis.$totals_container.append(vatable_sale_dom);\n\t\tthis.$totals_container.append(vat_exempt_dom);\n\t\tthis.$totals_container.append(zero_rated_dom);\n\t\tthis.$totals_container.append(vat_amount_dom);\n\t\t// this.$totals_container.append(taxes_dom);\n\t\tthis.$totals_container.append(discount_dom);\n\t\tthis.$totals_container.append(grand_total_dom);\n\t}\n\n\ttoggle_component(show) {\n\t\tshow ? this.$component.css(\"display\", \"flex\") : this.$component.css(\"display\", \"none\");\n\t}\n};\n", "custom_app.PointOfSale.Controller = class {\n\tconstructor(wrapper) {\n\t\tthis.wrapper = $(wrapper).find(\".layout-main-section\");\n\t\tthis.page = wrapper.page;\n\n\t\tthis.check_opening_entry();\n\t}\n\n\tfetch_opening_entry() {\n\t\treturn frappe.call(\"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.check_opening_entry\", {\n\t\t\tuser: frappe.session.user,\n\t\t});\n\t}\n\n\tcheck_opening_entry() {\n\t\tthis.fetch_opening_entry().then((r) => {\n\t\t\tif (r.message.length) {\n\t\t\t\t// assuming only one opening voucher is available for the current user\n\t\t\t\tlet data = r.message[0];\n\t\t\t\tlocalStorage.setItem('pos_profile', data.pos_profile);\n\n\t\t\t\tconsole.log('r.message:', r.message[0].pos_profile);\n\t\t\t\tconsole.log('user: ', frappe.session.user);\n\n\t\t\t\tlet saved_pos_profile = localStorage.getItem('pos_profile');\n\n\t\t\t\tif (saved_pos_profile) {\n\t\t\t\t\tdata.pos_profile = saved_pos_profile;\n\t\t\t\t\tconsole.log('savedPosProfile:', 'true');\n\t\t\t\t}\n\n\t\t\t\tthis.prepare_app_defaults(data);\n\t\t\t\t\n\t\t\t} else {\n\t\t\t\tthis.create_opening_voucher();\n\t\t\t}\n\t\t});\n\t}\n\n\n\t// Example JavaScript code to make the API call\n\n\n\tcreate_opening_voucher() {\n\t\tconst me = this;\n\t\tconst table_fields = [\n\t\t\t{\n\t\t\t\tfieldname: \"mode_of_payment\",\n\t\t\t\tfieldtype: \"Link\",\n\t\t\t\tin_list_view: 1,\n\t\t\t\tlabel: \"Mode of Payment\",\n\t\t\t\toptions: \"Mode of Payment\",\n\t\t\t\tread_only: 1, \n\t\t\t\treqd: 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tfieldname: \"opening_amount\",\n\t\t\t\tfieldtype: \"Currency\",\n\t\t\t\tin_list_view: 1,\n\t\t\t\tlabel: \"Opening Amount\",\n\t\t\t\tread_only: 1, \n\t\t\t\toptions: \"company:company_currency\",\n\t\t\t\tchange: function () {\n\t\t\t\t\tdialog.fields_dict.balance_details.df.data.some((d) => {\n\t\t\t\t\t\tif (d.idx == this.doc.idx) {\n\t\t\t\t\t\t\td.opening_amount = this.value;\n\t\t\t\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t\tconst fetch_pos_payment_methods = () => {\n\t\t\tconst pos_profile = dialog.fields_dict.pos_profile.get_value();\n\t\t\tif (!pos_profile) return;\n\n\t\t\tfrappe.db.get_doc(\"POS Profile\", pos_profile).then(({ payments }) => {\n\t\t\t\tdialog.fields_dict.balance_details.df.data = [];\n\n\t\t\t\tpayments.forEach((pay) => {\n\t\t\t\t\tconst { mode_of_payment } = pay;\n\n\t\t\t\t\t// Only include \"Cash\" payment method\n\t\t\t\t\tif (mode_of_payment === \"Cash\") {\n\t\t\t\t\t\tconst opening_amount = \"1500\";\n\t\t\t\t\t\tdialog.fields_dict.balance_details.df.data.push({ mode_of_payment, opening_amount });\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdialog.fields_dict.balance_details.grid.refresh();\n\t\t\t});\n\t\t};\n\n\n\t\tconst get_next_shift = async (pos_profile) => {\n\t\t\tconst res = await frappe.call({\n\t\t\t\tmethod: 'custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.get_shift_count',\n\t\t\t\targs: { pos_profile }\n\t\t\t});\n\n\t\t\t// Second Frappe call to get the max_shift value from the POS Profile\n\t\t\tconst max_shift_response = await frappe.call({\n\t\t\t\tmethod: 'custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.get_pos_profile_shift',\n\t\t\t\targs: { pos_profile }\n\t\t\t});\n\n\t\t\tconst max_shift = max_shift_response.message; // Adjust 'max_shift' to the actual field name\n\n\t\t\tif (res.message >= max_shift) {\n\t\t\t\tfrappe.msgprint(__('You have already reached the maximum of shifts for todays opening'));\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\tthrow new Error('Max shifts reached');\n\t\t\t}\n\t\t\treturn `Shift ${res.message + 1}`;\n\t\t};\n\n\t\tconst dialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(\"Create POS Opening Entry\"),\n\t\t\tstatic: true,\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\tlabel: __(\"Company\"),\n\t\t\t\t\tdefault: frappe.defaults.get_default(\"company\"),\n\t\t\t\t\toptions: \"Company\",\n\t\t\t\t\tfieldname: \"company\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldtype: \"Link\",\n\t\t\t\t\tlabel: __(\"POS Profile\"),\n\t\t\t\t\toptions: \"POS Profile\",\n\t\t\t\t\tfieldname: \"pos_profile\",\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tget_query: () => pos_profile_query(),\n\t\t\t\t\tonchange: () => fetch_pos_payment_methods(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tfieldname: \"balance_details\",\n\t\t\t\t\tfieldtype: \"Table\",\n\t\t\t\t\tlabel: \"Opening Balance Details\",\n\t\t\t\t\tcannot_add_rows: false,\n\t\t\t\t\tin_place_edit: true,\n\t\t\t\t\treqd: 1,\n\t\t\t\t\tdata: [],\n\t\t\t\t\tfields: table_fields,\n\t\t\t\t\tread_only: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t\tprimary_action: async function ({ company, pos_profile, balance_details }) {\n\t\t\t\ttry {\n\t\t\t\t\tconst custom_shift = await get_next_shift(pos_profile);\n\n\t\t\t\t\t// Validate balance details\n\t\t\t\t\tif (!balance_details.length) {\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"Please add Mode of payments and opening balance details.\"),\n\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn frappe.utils.play_sound(\"error\");\n\t\t\t\t\t}\n\n\t\t\t\t\t// Filter balance details\n\t\t\t\t\tbalance_details = balance_details.filter((d) => d.mode_of_payment);\n\n\t\t\t\t\t// Call the custom method to create the opening voucher\n\t\t\t\t\tconst method = \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.create_opening_voucher\";\n\t\t\t\t\tconst res = await frappe.call({\n\t\t\t\t\t\tmethod,\n\t\t\t\t\t\targs: { pos_profile, company, balance_details, custom_shift },\n\t\t\t\t\t\tfreeze: true,\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!res.exc) {\n\t\t\t\t\t\tme.prepare_app_defaults(res.message);\n\t\t\t\t\t}\n\n\t\t\t\t\tdialog.hide();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"Error creating POS Opening Entry:\", error);\n\t\t\t\t}\n\t\t\t},\n\t\t\tprimary_action_label: __(\"Submit\"),\n\t\t});\n\t\tdialog.show();\n\t\tconst pos_profile_query = () => {\n\t\t\treturn {\n\t\t\t\tquery: \"erpnext.accounts.doctype.pos_profile.pos_profile.pos_profile_query\",\n\t\t\t\tfilters: { company: dialog.fields_dict.company.get_value() },\n\t\t\t};\n\t\t};\n\t}\n\n\tasync prepare_app_defaults(data) {\n\t\tthis.pos_opening = data.name;\n\t\tthis.company = data.company;\n\t\tthis.pos_profile = data.pos_profile;\n\t\tthis.pos_opening_time = data.period_start_date;\n\t\tthis.item_stock_map = {};\n\t\tthis.settings = {};\n\n\t\t// console.log('this.setting:', this.settings)\n\n\t\tfrappe.db.get_value(\"Stock Settings\", undefined, \"allow_negative_stock\").then(({ message }) => {\n\t\t\tthis.allow_negative_stock = flt(message.allow_negative_stock) || false;\n\t\t});\n\n\t\tfrappe.call({\n\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.get_pos_profile_data\",\n\t\t\targs: { pos_profile: this.pos_profile },\n\t\t\tcallback: (res) => {\n\t\t\t\tconst profile = res.message;\n\n\n\t\t\t\tObject.assign(this.settings, profile);\n\n\t\t\t\tthis.settings.customer_groups = profile.customer_groups.map((group) => group.name);\n\t\t\t\tthis.make_app();\n\t\t\t},\n\t\t});\n\t}\n\n\tset_opening_entry_status() {\n\t\tthis.page.set_title_sub(\n\t\t\t`<span class=\"indicator orange\">\n\t\t\t\t<a class=\"text-muted\" href=\"#Form/POS%20Opening%20Entry/${this.pos_opening}\">\n\t\t\t\t\tOpened at ${moment(this.pos_opening_time).format(\"Do MMMM, h:mma\")}\n\t\t\t\t</a>\n\t\t\t</span>`\n\t\t);\n\t}\n\n\n\n\t//Customized Layout For Cashier\n\tmake_app() {\n\t\tthis.prepare_dom();\n\t\tthis.prepare_components();\n\t\tthis.toggle_recent_order_list(true);\n\t\tthis.add_buttons_to_toolbar();\n\t\tthis.prepare_menu();\n\t\tthis.make_new_invoice();\n\n\n\n\t}\n\t//Customized Layout For Cashier\n\tprepare_dom() {\n\t\tthis.wrapper.append(`<div class=\"point-of-sale-app\"></div>`);\n\n\t\tthis.$components_wrapper = this.wrapper.find(\".point-of-sale-app\");\n\t}\n\t//Customized Layout For Cashier\n\tprepare_components() {\n\t\tthis.init_recent_order_list();\n\t\tthis.init_order_summary();\n\t\tthis.init_item_selector();\n\t\tthis.init_item_details();\n\t\tthis.init_item_cart();\n\t\tthis.init_payments();\n\n\t}\n\n\tprepare_menu() {\n\t\tthis.page.clear_menu();\n\n\t\t// this.page.add_menu_item(__(\"Open Form View\"), this.open_form_view.bind(this), false, \"Ctrl+F\");\n\t\tthis.page.add_menu_item(__(\"Item Selector (F1)\"), this.add_new_order.bind(this), false, \"f1\");\n\t\tthis.page.add_menu_item(\n\t\t\t__(\"Pending Transaction (F2)\"),\n\t\t\tthis.order_list.bind(this),\n\t\t\tfalse,\n\t\t\t\"f2\"\n\t\t);\n\n\t\tthis.page.add_menu_item(__(\"Save as Draft\"), this.save_draft_invoice.bind(this), false, \"f3\");\n\n\t\t// this.page.add_menu_item(__(\"Cash Count\"), this.cash_count.bind(this), false, \"f4\");\n\n\t\tthis.page.add_menu_item(__(\"Check Encashment\"), this.check_encashment.bind(this), false, \"f6\");\n\t\tthis.page.add_menu_item(__('Z Reading (BIR)'), this.z_reading.bind(this), false, \"f5\");\n\t\tthis.page.add_menu_item(__('DSRS'), this.dsrs_reading.bind(this), false, \"f0\");\n\t\tthis.page.add_menu_item(__(\"Close the POS(X Reading)\"), this.close_pos.bind(this), false, \"Shift+Ctrl+C\");\n\t}\n\n\n\tadd_buttons_to_toolbar() {\n\t\tconst buttons = [\n\n\t\t\t{label: __(\"Item Selector (F1)\"), action: this.add_new_order.bind(this), shortcut: \"f1\"},\n\t\t\t{label: __(\"Pending Transaction (F2)\"), action: this.order_list.bind(this), shortcut: \"f2\"},\n\t\t\t{label: __(\"Save as Draft (F3)\"), action: this.save_draft_invoice.bind(this), shortcut: \"f3\"},\n\t\t\t{ label: __(\"Amesco Plus Member\"), action: this.amesco_plus_scan.bind(this), shortcut: \"f4\" },\n\t\t\t// {label: __(\"Cash Count\"), action: this.cash_count.bind(this), shortcut: \"Ctrl+B\"},\n\t\t\t// {label: __(\"Cash Voucher\"), action: this.cash_voucher.bind(this), shortcut: \"Ctrl+X\"},\n\t\t\t{label: __(\"Close the POS(X Reading)\"), action: this.close_pos.bind(this), shortcut: \"Shift+Ctrl+C\"}\n\n\t\t];\n\n\t\t// Clear existing buttons to avoid duplication\n\t\t$('.page-actions .btn-custom').remove();\n\n\t\tbuttons.forEach(btn => {\n\t\t\tthis.page.add_button(btn.label, btn.action, { shortcut: btn.shortcut }).addClass('btn-custom');\n\t\t});\n\t}\n\n\tshowPasswordDialog(title, onSuccess) {\n\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(title),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Authorize'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet password = values.password;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t\t\t\t\targs: { password: password},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (r.message.name) {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Verified'),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tpasswordDialog.show();\n\t}\n\n\n\tshowSystemManagerPasswordDialog(title, onSuccess) {\n\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __(title),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Authorize'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet password = values.password;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_system_manager_password\",\n\t\t\t\t\targs: { password: password},\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (r.message.name) {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Verified'),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\tonSuccess();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tpasswordDialog.show();\n\t}\n\n\tz_reading() {\n\t\tconst onSuccess = () => {\n\t\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\t\t\tfrappe.db.get_doc('POS Profile', this.frm.doc.pos_profile)\n\t\t\t.then(pos_profile => {\n\t\t\t\tlet voucher = frappe.model.get_new_doc(\"POS Z Reading\");\n\t\t\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\t\t\tvoucher.date_from = pos_profile.custom_start_operating_date;\n\t\t\t\tvoucher.date_to = frappe.datetime.now_datetime();\n\t\t\t\tfrappe.set_route(\"Form\", \"POS Z Reading\", voucher.name);\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(\"Error fetching POS Profile:\", error);\n\t\t\t\tfrappe.msgprint(__('Failed to fetch POS Profile. Please try again.'));\n\t\t\t});\n\t\t};\n\n\t\tthis.showSystemManagerPasswordDialog('System Manager Authorization Required for Z Reading', onSuccess);\n\t}\n\n\tdsrs_reading() {\n\t\tconst onSuccess = () => {\n\t\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\t\t\tlet voucher = frappe.model.get_new_doc(\"POS Daily Sales Report Summary\");\n\t\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\t\tvoucher.custom_date_created = frappe.datetime.now_datetime();\n\t\t\tfrappe.set_route(\"Form\", \"POS Daily Sales Report Summary\", voucher.name);\n\t\t};\n\n\t\tthis.showPasswordDialog('OIC Authorization Required for DSRS', onSuccess);\n\t}\n\n\t//Cash Voucher\n\tcash_voucher() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\t\tlet voucher = frappe.model.get_new_doc(\"Cash Voucher Entry\");\n\t\tvoucher.custom_pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.custom_cashier = frappe.session.user;\n\t\tvoucher.custom_opening_entry = this.pos_opening;\n\t\tfrappe.set_route(\"Form\", \"Cash Voucher Entry\", voucher.name);\n\t}\n\n\n\t//Check Encashment\n\tcheck_encashment() {\n\n\t\tconst onSuccess = () => {\n\t\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\t\t\tlet voucher = frappe.model.get_new_doc(\"Check Encashment Entry\")\n\t\t\t\tvoucher.custom_pos_profile = this.frm.doc.pos_profile;\n\t\t\t\tvoucher.custom_received_by = frappe.session.user;\n\t\t\t\tvoucher.custom_opening_entry = this.pos_opening;\n\t\t\t\tfrappe.set_route(\"Form\", \"Check Encashment Entry\", voucher.name)\n\t\t\n\t\t\t.catch(error => {\n\t\t\t\tconsole.error(\"Error fetching POS Profile:\", error);\n\t\t\t\tfrappe.msgprint(__('Failed to fetch POS Profile. Please try again.'));\n\t\t\t});\n\t\t};\n\t\tthis.showPasswordDialog('OIC Authorization Required for Check Encashment Entry', onSuccess);\n\t}\n\n\tadd_new_order() {\n\t\tfrappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.frm.call(\"reset_mode_of_payments\"),\n\t\t\t() => this.cart.load_invoice(),\n\t\t\t() => this.remove_pos_cart_items(),\n\t\t\t() => this.make_new_invoice(),\n\t\t\t() => this.item_selector.toggle_component(),\n\t\t\t() => this.item_details.toggle_item_details_section(),\n\t\t\t() => this.toggle_recent_order_list(false),\n\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t// () => this.item_selector.refresh(),\n\t\t]);\n\t}\n\n\n\tremove_pos_cart_items() {\n\t\t// console.log('Remove cart items')\n\t\tlocalStorage.removeItem('posCartItems');\n\t}\n\n\torder_list() {\n\t\tfrappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.frm.call(\"reset_mode_of_payments\"),\n\t\t\t() => this.cart.load_invoice(),\n\t\t\t() => this.make_new_invoice(),\n\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t() => this.item_details.toggle_item_details_section(),\n\t\t\t() => this.toggle_recent_order_list(true),\n\t\t\t() => window.location.reload(),\n\t\t\t() => frappe.dom.unfreeze(),\n\n\t\t]);\n\t}\n\n\tamesco_plus_scan() {\n\t\tconst me = this;\n\t\tconst doc = me.frm;\n\t\n\t\t// Create a dialog with a data field for manual input\n\t\tlet manualInputDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Enter Scanned Data'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tlabel: 'Scanned Data',\n\t\t\t\t\tfieldname: 'scanned_data',\n\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\treqd: 1, // Make this field mandatory\n\t\t\t\t\tdescription: 'Enter the scanned data (comma-separated format)'\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Submit'),\n\t\t\tprimary_action(values) {\n\t\t\t\tlet scannedData = values.scanned_data.split(',');  // Assuming the data is comma-separated\n\t\n\t\t\t\tif (scannedData.length >= 5) {\n\t\t\t\t\t// Extracting fields from the scanned data\n\t\t\t\t\tlet user_id = scannedData[0];\n\t\t\t\t\tlet userName = scannedData[2];\n\t\t\t\t\tlet email = scannedData[3];\n\t\t\t\t\tlet points = scannedData[4];\n\t\n\t\t\t\t\t// Set the extracted values in the document\n\t\t\t\t\tdoc.set_value('custom_ameso_user', email);\n\t\t\t\t\tdoc.set_value('custom_amesco_user_id', user_id);\n\t\n\t\t\t\t\t// Display the extracted user details in another dialog\n\t\t\t\t\tlet userDetailsDialog = new frappe.ui.Dialog({\n\t\t\t\t\t\ttitle: __('Scanned User Details'),\n\t\t\t\t\t\tfields: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Name',\n\t\t\t\t\t\t\t\tfieldname: 'user_name',\n\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\tdefault: userName\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Email',\n\t\t\t\t\t\t\t\tfieldname: 'email',\n\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\tdefault: email\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlabel: 'Points',\n\t\t\t\t\t\t\t\tfieldname: 'points',\n\t\t\t\t\t\t\t\tfieldtype: 'Data',\n\t\t\t\t\t\t\t\tread_only: 1,\n\t\t\t\t\t\t\t\tdefault: points\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tprimary_action_label: __('Close'),\n\t\t\t\t\t\tprimary_action: function() {\n\t\t\t\t\t\t\tuserDetailsDialog.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\n\t\t\t\t\t// Show the dialog with the user details\n\t\t\t\t\tuserDetailsDialog.show();\n\t\n\t\t\t\t} else {\n\t\t\t\t\tfrappe.msgprint(__('Invalid data format. Please enter at least 5 comma-separated values.'));\n\t\t\t\t}\n\t\n\t\t\t\t// Hide the manual input dialog after submission\n\t\t\t\tmanualInputDialog.hide();\n\t\t\t}\n\t\t});\n\t\n\t\t// Show the manual input dialog\n\t\tmanualInputDialog.show();\n\t}\n\n\n\tset_discount_log(doc, user, email) {\n\t\tdoc.set_value('custom_ameso_user', updated_discount_log);\n\t\tdoc.set_value('custom_manual_dicsount', updated_discount_log);\n\t}\n\t\n\t\n\t\n\t// Define the handle_scanned_barcode function\n\thandle_scanned_barcode(barcode) {\n\t\t// Logic to handle the scanned barcode\n\t\tconsole.log(\"Scanned Barcode:\", barcode);\n\t\t// Add your barcode handling logic here\n\t}\n\n\n\n\n\n\topen_form_view() {\n\t\tfrappe.model.sync(this.frm.doc);\n\t\tfrappe.set_route(\"Form\", this.frm.doc.doctype, this.frm.doc.name);\n\t}\n\n\ttoggle_recent_order() {\n\t\tconst show = this.recent_order_list.$component.is(\":hidden\");\n\t\tthis.toggle_recent_order_list(show);\n\t\tthis.payment.toggle_component(false);\n\t\tthis.item_details.toggle_component(false); /// Add to fix ui hide payment is Order list toggled in Menu\n\t}\n\n\tsave_draft_invoice() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"You must add atleast one item to save it as draft.\"),\n\t\t\t\tindicator: \"red\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tthis.frm\n\t\t\t.save(undefined, undefined, undefined, () => {\n\t\t\t\tfrappe.show_alert({\n\t\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\t\tindicator: \"red\",\n\t\t\t\t});\n\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t() => this.toggle_recent_order_list(show),\n\t\t\t\t]);\n\t\t\t});\n\t}\n\n\n\tsave_draft() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\n\t\tif (this.frm.doc.items.length == 0) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __(\"You must add atleast one item to complete the order.\"),\n\t\t\t\tindicator: \"red\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Enter Your Password'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Ok'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet password = values.password;\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.packing_list.packing_list.get_user_details_by_password\",\n\t\t\t\t\targs: { password: password },\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (r.message.name) {\n\t\t\t\t\t\t\tthis.set_pharmacist_assist(this.frm, r.message.name)\n\t\t\t\t\t\t\tthis.frm\n\t\t\t\t\t\t\t\t.save(undefined, undefined, undefined, () => {\n\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t]);\n\n\t\t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\t\t\tlocalStorage.removeItem('posCartItems'); // remove stored data from local storage\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: `${r.message.error}`,\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t})\n\t\tpasswordDialog.show();\n\t}\n\n\tclose_pos() {\n\n\t\tconst me = this;\n\t\t// Show password dialog for OIC authentication\n\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Authorization Required OIC'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\t// size: 'small',\n\t\t\tprimary_action_label: __('Authorize'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet password = values.password;\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t\t\t\t\targs: { password: password },\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (!r.message.error) {\n\t\t\t\t\t\t\t// Password is correct and user has the allowed roles\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Verified'),\n\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t});\n\t\t\t\t\n\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\t\t\t\t\n\t\t\t\t\t\t\tlet voucher = frappe.model.get_new_doc(\"POS Closing Entry\");\n\t\t\t\t\t\t\tvoucher.pos_profile = this.frm.doc.pos_profile;\n\t\t\t\t\t\t\tvoucher.user = frappe.session.user;\n\t\t\t\t\t\t\tvoucher.company = this.frm.doc.company;\n\t\t\t\t\t\t\tvoucher.pos_opening_entry = this.pos_opening;\n\t\t\t\t\t\t\tvoucher.period_end_date = frappe.datetime.now_datetime();\n\t\t\t\t\t\t\tvoucher.posting_date = frappe.datetime.now_date();\n\t\t\t\t\t\t\tvoucher.posting_time = frappe.datetime.now_time();\n\t\t\t\t\t\t\tfrappe.set_route(\"Form\", \"POS Closing Entry\", voucher.name);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Show alert for incorrect password or unauthorized user\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user'),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t}\n\t\t});\n\n\t\tpasswordDialog.show();\n\n\n\t}\n\n\tcash_count() {\n\t\tif (!this.$components_wrapper.is(\":visible\")) return;\n\t\tlet voucher = frappe.model.get_new_doc(\"Cash Count Denomination Entry\");\n\t\tvoucher.custom_pos_profile = this.frm.doc.pos_profile;\n\t\tvoucher.user = frappe.session.user;\n\t\tvoucher.custom_pos_opening_entry_id = this.pos_opening;\n\t\tfrappe.set_route(\"Form\", \"Cash Count Denomination Entry\", voucher.name);\n\t}\n\n\tinit_item_selector() {\n\t\tthis.selected_uom = \"PC\";\n\t\tthis.item_selector = new custom_app.PointOfSale.ItemSelector({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tpos_profile: this.pos_profile,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\titem_selected: (args) => {\n\t\t\t\t\t// Fetch the warehouse from POS Profile\n\t\t\t\t\tfrappe.call({\n\t\t\t\t\t\tmethod: 'custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.get_pos_warehouse',\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tpos_profile: this.pos_profile\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t\tconst posWarehouse = r.message;\n\t\t\t\t\t\t\t\tconst selectedWarehouse = localStorage.getItem('selected_warehouse');\n\n\t\t\t\t\t\t\t\tif (posWarehouse === selectedWarehouse || selectedWarehouse === null) {\n\t\t\t\t\t\t\t\t\tthis.on_cart_update(args); // Proceed if warehouses match\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\t\tmessage: __(\"You cannot add items from a different branch.\"),\n\t\t\t\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __(\"Could not retrieve the warehouse for the POS Profile.\"),\n\t\t\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tget_frm: () => this.frm || {},\n\t\t\t\tget_pos_profile: () => {\n\t\t\t\t\treturn this.pos_profile\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_item_cart() {\n\t\tthis.cart = new custom_app.PointOfSale.ItemCart({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tcart_item_clicked: (item) => {\n\t\t\t\t\tconst item_row = this.get_item_from_frm(item);\n\t\t\t\t\tthis.item_details.toggle_item_details_section(item_row);\n\t\t\t\t},\n\n\t\t\t\tnumpad_event: (value, action) => this.update_item_field(value, action),\n\n\t\t\t\tcheckout: () => this.save_and_checkout(),\n\n\t\t\t\tedit_cart: () => this.payment.edit_cart(),\n\n\t\t\t\tcustomer_details_updated: (details) => {\n\t\t\t\t\tthis.customer_details = details;\n\t\t\t\t\t// will add/remove LP payment method\n\t\t\t\t\tthis.payment.render_loyalty_points_payment_mode();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_item_details() {\n\t\tthis.item_details = new custom_app.PointOfSale.ItemDetails({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tsettings: this.settings,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\ttoggle_item_selector: (minimize) => {\n\t\t\t\t\tthis.item_selector.resize_selector(minimize);\n\t\t\t\t\tthis.cart.toggle_numpad(minimize);\n\t\t\t\t},\n\n\t\t\t\tform_updated: (item, field, value) => {\n\t\t\t\t\tconst item_row = frappe.model.get_doc(item.doctype, item.name);\n\t\t\t\t\tif (item_row && item_row[field] != value) {\n\t\t\t\t\t\tconst args = {\n\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t\titem: this.item_details.current_item,\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn this.on_cart_update(args);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t},\n\n\t\t\t\thighlight_cart_item: (item) => {\n\t\t\t\t\tconst cart_item = this.cart.get_cart_item(item);\n\t\t\t\t\tthis.cart.toggle_item_highlight(cart_item);\n\t\t\t\t},\n\n\t\t\t\titem_field_focused: (fieldname) => {\n\t\t\t\t\tthis.cart.toggle_numpad_field_edit(fieldname);\n\t\t\t\t},\n\t\t\t\tset_value_in_current_cart_item: (selector, value) => {\n\t\t\t\t\tthis.cart.update_selector_value_in_cart_item(\n\t\t\t\t\t\tselector,\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\tthis.item_details.current_item\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tclone_new_batch_item_in_frm: (batch_serial_map, item) => {\n\t\t\t\t\t// called if serial nos are 'auto_selected' and if those serial nos belongs to multiple batches\n\t\t\t\t\t// for each unique batch new item row is added in the form & cart\n\t\t\t\t\tObject.keys(batch_serial_map).forEach((batch) => {\n\t\t\t\t\t\tconst item_to_clone = this.frm.doc.items.find((i) => i.name == item.name);\n\t\t\t\t\t\tconst item_to_clone2 = this.frm.doc.items.find((i) => i.latest_expiry_date == item.latest_expiry_date);\n\t\t\t\t\t\tconst new_row = this.frm.add_child(\"items\", { ...item_to_clone });\n\t\t\t\t\t\t// update new serialno and batch\n\t\t\t\t\t\tnew_row.batch_no = batch;\n\t\t\t\t\t\tnew_row.serial_no = batch_serial_map[batch].join(`\\n`);\n\t\t\t\t\t\tnew_row.qty = batch_serial_map[batch].length;\n\t\t\t\t\t\tthis.frm.doc.items.forEach((row) => {\n\t\t\t\t\t\t\tif (item.item_code === row.item_code) {\n\t\t\t\t\t\t\t\tthis.update_cart_html(row);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremove_item_from_cart: () => this.remove_item_from_cart(),\n\t\t\t\tget_item_stock_map: () => this.item_stock_map,\n\t\t\t\tclose_item_details: () => {\n\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\tthis.cart.prev_action = null;\n\t\t\t\t\tthis.cart.toggle_item_highlight();\n\t\t\t\t},\n\t\t\t\tget_available_stock: (item_code, warehouse) => this.get_available_stock(item_code, warehouse),\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_payments() {\n\t\tthis.payment = new custom_app.PointOfSale.Payment({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm || {},\n\n\t\t\t\tget_customer_details: () => this.customer_details || {},\n\n\t\t\t\ttoggle_other_sections: (show) => {\n\t\t\t\t\tif (show) {\n\t\t\t\t\t\tthis.item_details.$component.is(\":visible\")\n\t\t\t\t\t\t\t? this.item_details.$component.css(\"display\", \"none\")\n\t\t\t\t\t\t\t: \"\";\n\t\t\t\t\t\tthis.item_selector.toggle_component(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.item_selector.toggle_component(true);\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tsubmit_invoice: () => {\n\t\t\t\t\t// Calculate the total payment amount\n\t\t\t\t\tlet payment_amount = this.frm.doc.payments.reduce((sum, payment) => sum + payment.amount, 0);\n\n\t\t\t\t\t// Check if payment is sufficient\n\t\t\t\t\tif (parseFloat(payment_amount.toFixed(2)) < this.frm.doc.grand_total) {\n\n\t\t\t\t\t\t// Show dialog indicating insufficient payment\n\t\t\t\t\t\tconst insufficientPaymentDialog = new frappe.ui.Dialog({\n\t\t\t\t\t\t\ttitle: __('Insufficient Payment'),\n\t\t\t\t\t\t\tprimary_action_label: __('OK'),\n\t\t\t\t\t\t\tprimary_action: () => {\n\t\t\t\t\t\t\t\tinsufficientPaymentDialog.hide();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tinsufficientPaymentDialog.body.innerHTML = `\n\t\t\t\t\t\t\t<div style=\"text-align: center; font-size: 30px; margin: 20px 0;\">\n\t\t\t\t\t\t\t\t${__('The payment amount is not enough to cover the grand total.')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;\n\n\t\t\t\t\t\tinsufficientPaymentDialog.show();\n\t\t\t\t\t\treturn; // Exit the function if payment is not sufficient\n\t\t\t\t\t}\n\n\t\t\t\t\t// Proceed with submitting the invoice if payment is sufficient\n\t\t\t\t\tlet errorOccurred = false; // Flag to track if an error occurred\n\n\t\t\t\t\tthis.frm.save('Submit', undefined, undefined, () => {\n\t\t\t\t\t\t// Error handling during save\n\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\tmessage: __(\"There was an error saving the document.\"),\n\t\t\t\t\t\t\tindicator: \"red\",\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfrappe.utils.play_sound(\"error\"); \n\t\t\t\t\t\terrorOccurred = true; // Set error flag\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (errorOccurred) return; // Skip further actions if an error occurred\n\n\t\t\t\t\t\tthis.toggle_components(false);\n\t\t\t\t\t\t// Customized Layout to toggle off Cart\n\t\t\t\t\t\tthis.cart.toggle_component(false);\n\t\t\t\t\t\tthis.order_summary.toggle_component(false);\n\t\t\t\t\t\tthis.remove_pos_cart_items();\n\t\t\t\t\t\tthis.order_summary.load_summary_of(this.frm.doc, true);\n\t\t\t\t\t\tthis.order_summary.print_receipt();\n\n\n\t\t\t\t\t\t// Calculate the change\n\t\t\t\t\t\tlet change_amount = payment_amount - this.frm.doc.grand_total;\n\n\t\t\t\t\t\t// Show change in a dialog\n\t\t\t\t\t\tconst changeDialog = new frappe.ui.Dialog({\n\t\t\t\t\t\t\ttitle: __('Change Amount'),\n\t\t\t\t\t\t\tprimary_action_label: __('OK (Press Enter)'),\n\t\t\t\t\t\t\tprimary_action: () => {\n\t\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\t\tchangeDialog.hide();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Add custom HTML with large text for the change amount\n\t\t\t\t\t\tchangeDialog.body.innerHTML = `\n\t\t\t\t\t\t\t<div style=\"text-align: center; font-size: 60px; margin: 20px 0;\">\n\t\t\t\t\t\t\t\t${format_currency(change_amount)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;\n\n\t\t\t\t\t\tchangeDialog.show();\n\n\t\t\t\t\t\t$(document).on('keydown', function(e) {\n\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t// Trigger primary action (OK button) on Enter key press\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\tchangeDialog.primary_action();\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_recent_order_list() {\n\t\tthis.recent_order_list = new custom_app.PointOfSale.PastOrderList({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\topen_invoice_data: (name) => {\n\t\t\t\t\tfrappe.db.get_doc(\"POS Invoice\", name).then((doc) => {\n\t\t\t\t\t\tthis.order_summary.load_summary_of(doc);\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\t// return pos profile\n\t\t\t\tpos_profile: () => {\n\t\t\t\t\treturn this.pos_profile;\n\t\t\t\t},\n\n\t\t\t\tsource_warehouse: () => {\n\t\t\t\t\treturn this.settings.warehouse;\n\t\t\t\t},\n\n\t\t\t\treset_summary: () => this.order_summary.toggle_summary_placeholder(true),\n\t\t\t},\n\t\t});\n\t}\n\n\tinit_order_summary() {\n\t\tthis.order_summary = new custom_app.PointOfSale.PastOrderSummary({\n\t\t\twrapper: this.$components_wrapper,\n\t\t\tevents: {\n\t\t\t\tget_frm: () => this.frm,\n\n\t\t\t\tprocess_return: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\n\t\t\t\t\tfrappe.db.get_doc(\"POS Invoice\", name).then((doc) => {\n\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t() => this.make_return_invoice(doc),\n\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t]);\n\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\tedit_order: (name) => {\n\t\t\t\t\tthis.oic_edit_confirm(name); // Call password authentication before edit order\n\t\t\t\t},\n\n\n\t\t\t\tdelete_order: (name) => {\n\t\t\t\t\tthis.oic_delete_confirm(name)\n\t\t\t\t},\n\n\t\t\t\tnew_order: () => {\n\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.make_new_invoice(),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\t\t\t\t},\n\n\t\t\t\tproceed_order: (name) => {\n\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t\t\t\t\tfrappe.run_serially([\n\n\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t() => this.save_and_checkout(true),\n\t\t\t\t\t\t() => this.cart.toggle_checkout_btn(false),\n\n\t\t\t\t\t]);\n\t\t\t\t},\n\n\n\t\t\t\torder_list: () => {\n\n\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t() => frappe.dom.freeze(),\n\t\t\t\t\t\t() => this.item_selector.toggle_component(false),\n\t\t\t\t\t\t() => this.toggle_recent_order_list(true),\n\t\t\t\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t\t\t]);\n\n\t\t\t\t},\n\n\n\t\t\t},\n\t\t});\n\t}\n\n\n\n\t// oic_edit_confirm(name) {\n\t// \tconst passwordDialog = new frappe.ui.Dialog({\n\t// \t\ttitle: __('Enter OIC Password'),\n\t// \t\tfields: [\n\t// \t\t\t{\n\t// \t\t\t\tfieldname: 'password',\n\t// \t\t\t\tfieldtype: 'Password',\n\t// \t\t\t\tlabel: __('Password'),\n\t// \t\t\t\treqd: 1\n\t// \t\t\t}\n\t// \t\t],\n\t// \t\tprimary_action_label: __('Edit Order'),\n\t// \t\tprimary_action: (values) => {\n\t// \t\t\tlet password = values.password;\n\t// \t\t\tlet role = \"oic\";\n\n\t// \t\t\tfrappe.call({\n\t// \t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t// \t\t\t\targs: { password: password, role: role },\n\t// \t\t\t\tcallback: (r) => {\n\t// \t\t\t\t\tif (r.message) {\n\t// \t\t\t\t\t\tthis.recent_order_list.toggle_component(false);\n\t// \t\t\t\t\t\tfrappe.run_serially([\n\t// \t\t\t\t\t\t\t() => this.frm.refresh(name),\n\t// \t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t// \t\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t// \t\t\t\t\t\t\t() => this.toggle_recent_order_list(false), // Toggle false order list to remove order summary\n\t// \t\t\t\t\t\t]);\n\t// \t\t\t\t\t\tpasswordDialog.hide();\n\t// \t\t\t\t\t} else {\n\t// \t\t\t\t\t\tfrappe.show_alert({\n\t// \t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t// \t\t\t\t\t\t\tindicator: 'red'\n\t// \t\t\t\t\t\t});\n\t// \t\t\t\t\t}\n\t// \t\t\t\t}\n\t// \t\t\t});\n\t// \t\t}\n\t// \t});\n\n\t// \tpasswordDialog.show();\n\t// \tthis.toggle_components(true); //Toggle True so order summary stays while authentication modal is activated\n\t// }\n\n\n\n\n\toic_edit_confirm(name) {\n\t\t// Cleanup any existing dialog\n\t\tif (this.passwordDialog) {\n\t\t\tthis.passwordDialog.$wrapper.remove();\n\t\t\tdelete this.passwordDialog;\n\t\t}\n\t\n\t\tlet isAuthorized = false;\n\t\n\t\t// Create a new password dialog\n\t\tthis.passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Authorization Required OIC'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldtype: 'HTML',\n\t\t\t\t\tfieldname: 'password_html',\n\t\t\t\t\toptions: `\n\t\t\t\t\t\t<div class=\"form-group\">\n\t\t\t\t\t\t\t<label for=\"password_field\">${__('Password')}</label>\n\t\t\t\t\t\t\t<input type=\"password\" id=\"password_field\" class=\"form-control\" required>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Authorize'),\n\t\t\tprimary_action: () => {\n\t\t\t\tlet password = document.getElementById('password_field').value;\n\t\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.packing_list.packing_list.confirm_user_password\",\n\t\t\t\t\targs: { password: password },\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\tif (r.message.name) {\n\t\t\t\t\t\t\t\tisAuthorized = true;\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __('Verified'),\n\t\t\t\t\t\t\t\t\tindicator: 'green'\n\t\t\t\t\t\t\t\t});\n\t\n\t\t\t\t\t\t\t\tfrappe.run_serially([\n\t\t\t\t\t\t\t\t\t() => this.frm.refresh(name),\n\t\t\t\t\t\t\t\t\t() => this.cart.load_invoice(),\n\t\t\t\t\t\t\t\t\t() => this.item_selector.toggle_component(true),\n\t\t\t\t\t\t\t\t\t() => this.toggle_recent_order_list(false),\n\t\t\t\t\t\t\t\t\t() => this.item_selector.load_items_data(), \n\t\t\t\t\t\t\t\t]).then(() => {\n\t\t\t\t\t\t\t\t\tthis.passwordDialog.hide();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\n\t\t// Bind an event to reload the window when the dialog is hidden\n\t\tthis.passwordDialog.$wrapper.on('hidden.bs.modal', () => {\n\t\t\tif (!isAuthorized) {\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t});\n\t\n\t\t// Show the dialog\n\t\tthis.passwordDialog.show();\n\t\n\t\t\n\t\t// Ensure the password field gains focus every time the dialog is opened\n\t\tthis.passwordDialog.$wrapper.on('shown.bs.modal', () => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tdocument.getElementById('password_field').focus();\n\t\t\t}, 100); // Slight delay to ensure field is rendered before focusing\n\t\t});\n\t}\n\n\toic_delete_confirm(name) {\n\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Enter OIC Password'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Authenticate'),\n\t\t\tprimary_action: (values) => {\n\t\t\t\tlet password = values.password;\n\t\t\t\tlet role = \"oic\";\n\n\t\t\t\tfrappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t\t\t\t\targs: { password: password, role: role },\n\t\t\t\t\tcallback: (r) => {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t// Password authenticated, proceed with order deletion\n\t\t\t\t\t\t\tfrappe.model.delete_doc(this.frm.doc.doctype, name, () => {\n\t\t\t\t\t\t\t\tthis.recent_order_list.refresh_list();\n\t\t\t\t\t\t\t\tthis.recent_order_list.toggle_component(true);\n\t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfrappe.show_alert({\n\t\t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t\t\t\t\t\t\t\tindicator: 'red'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tpasswordDialog.show();\n\t}\n\n\n\n\n\ttoggle_recent_order_list(show) {\n\t\t// Toggle recent order list component\n\t\tthis.recent_order_list.toggle_component(show);\n\n\t\t// Toggle order summary component\n\t\tthis.order_summary.toggle_component(show);\n\n\t\t// Toggle item cart component\n\t\tthis.cart.toggle_component(!show);\n\t\tthis.item_selector.toggle_component(!show);\n\n\t\t// Hide item details and payment if recent order is toggled off\n\t\t!show ? this.item_details.toggle_component(false) || this.payment.toggle_component(false) : \"\";\n\t}\n\n\ttoggle_components(show) {\n\t\tthis.cart.toggle_component(!show);\n\t\tthis.item_selector.toggle_component(show);\n\n\t\t// do not show item details or payment if recent order is toggled off\n\t\t!show ? this.item_details.toggle_component(false) || this.payment.toggle_component(false) : \"\";\n\t}\n\n\tmake_new_invoice() {\n\t\treturn frappe.run_serially([\n\t\t\t() => frappe.dom.freeze(),\n\t\t\t() => this.make_sales_invoice_frm(),\n\t\t\t() => this.set_pos_profile_data(),\n\t\t\t() => this.set_pos_profile_status(),\n\t\t\t() => this.cart.load_invoice(), // Load the invoice first\n\t\t\t() => frappe.dom.unfreeze(),\n\t\t\t() => this.cart.toggle_component(false) // Hide the cart component after loading the invoice\n\t\t]);\n\t}\n\n\tmake_sales_invoice_frm() {\n\t\tconst doctype = \"POS Invoice\";\n\t\treturn new Promise((resolve) => {\n\t\t\tif (this.frm) {\n\t\t\t\tthis.frm = this.get_new_frm(this.frm);\n\t\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\tthis.frm.doc.is_pos = 1;\n\t\t\t\tresolve();\n\t\t\t} else {\n\t\t\t\tfrappe.model.with_doctype(doctype, () => {\n\t\t\t\t\tthis.frm = this.get_new_frm();\n\t\t\t\t\tthis.frm.doc.items = [];\n\t\t\t\t\tthis.frm.doc.is_pos = 1;\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tget_new_frm(_frm) {\n\t\tconst doctype = \"POS Invoice\";\n\t\tconst page = $(\"<div>\");\n\t\tconst frm = _frm || new frappe.ui.form.Form(doctype, page, false);\n\t\tconst name = frappe.model.make_new_doc_and_get_name(doctype, true);\n\t\tfrm.refresh(name);\n\n\t\treturn frm;\n\t}\n\n\tasync make_return_invoice(doc) {\n\t\tfrappe.dom.freeze();\n\t\tthis.frm = this.get_new_frm(this.frm);\n\t\tthis.frm.doc.items = [];\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.make_sales_return\",\n\t\t\targs: {\n\t\t\t\tsource_name: doc.name,\n\t\t\t\ttarget_doc: this.frm.doc,\n\t\t\t},\n\t\t\tcallback: (r) => {\n\t\t\t\tfrappe.model.sync(r.message);\n\t\t\t\tfrappe.get_doc(r.message.doctype, r.message.name).__run_link_triggers = false;\n\t\t\t\tthis.set_pos_profile_data().then(() => {\n\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t});\n\t\t\t},\n\t\t});\n\t}\n\n\tset_pos_profile_data() {\n\t\tif (this.company && !this.frm.doc.company) this.frm.doc.company = this.company;\n\t\tif (\n\t\t\t(this.pos_profile && !this.frm.doc.pos_profile) |\n\t\t\t(this.frm.doc.is_return && this.pos_profile != this.frm.doc.pos_profile)\n\t\t) {\n\t\t\tthis.frm.doc.pos_profile = this.pos_profile;\n\t\t}\n\n\t\tif (!this.frm.doc.company) return;\n\n\t\treturn this.frm.trigger(\"set_pos_data\");\n\t}\n\n\tset_pos_profile_status() {\n\t\tthis.page.set_indicator(this.pos_profile, \"blue\");\n\t}\n\n\tasync on_cart_update(args) {\n\t\tfrappe.dom.freeze();\n\t\tlet item_row = undefined;\n\t\ttry {\n\t\t\tlet { field, value, item } = args;\n\t\t\titem_row = this.get_item_from_frm(item);\n\t\t\tconst item_row_exists = !$.isEmptyObject(item_row);\n\n\t\t\tconst from_selector = field === \"qty\" && value === \"+1\";\n\t\t\tif (from_selector) value = flt(item_row.stock_qty) + flt(value);\n\n\t\t\tif (item_row_exists) {\n\t\t\t\tif (field === \"qty\") value = flt(value);\n\n\t\t\t\tif ([\"qty\", \"conversion_factor\"].includes(field) && value > 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed =\n\t\t\t\t\t\tfield === \"qty\" ? value * item_row.conversion_factor : item_row.qty * value;\n\t\t\t\t\tawait this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tif (this.is_current_item_being_edited(item_row) || from_selector) {\n\t\t\t\t\tawait frappe.model.set_value(item_row.doctype, item_row.name, field, value);\n\t\t\t\t\tthis.update_cart_html(item_row);\n\n\t\t\t\t\t// await this.auto_add_batch(item_row);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!this.frm.doc.customer) return this.raise_customer_selection_alert();\n\n\t\t\t\tconst { item_code, batch_no, serial_no, rate, uom } = item;\n\n\t\t\t\tif (!item_code) return;\n\n\t\t\t\tconst new_item = { item_code, batch_no, rate, uom, [field]: value };\n\n\t\t\t\tif (serial_no && serial_no !== \"undefined\") {\n\t\t\t\t\tawait this.check_serial_no_availablilty(item_code, this.frm.doc.set_warehouse, serial_no);\n\t\t\t\t\tnew_item[\"serial_no\"] = serial_no;\n\t\t\t\t}\n\n\n\t\t\t\tif (field === \"serial_no\") new_item[\"qty\"] = value.split(`\\n`).length || 0;\n\n\t\t\t\titem_row = this.frm.add_child(\"items\", new_item);\n\n\t\t\t\tif (field === \"qty\" && value !== 0 && !this.allow_negative_stock) {\n\t\t\t\t\tconst qty_needed = value * item_row.conversion_factor;\n\t\t\t\t\tawait this.check_stock_availability(item_row, qty_needed, this.frm.doc.set_warehouse);\n\t\t\t\t}\n\n\t\t\t\tawait this.trigger_new_item_events(item_row);\n\n\t\t\t\tthis.update_cart_html(item_row);\n\t\t\t\t\n\t\t\t\t// await this.auto_add_batch(item_row);\n\n\t\t\t\tif (this.item_details.$component.is(\":visible\")) this.edit_item_details_of(item_row);\n\n\t\t\t\tif (\n\t\t\t\t\tthis.check_serial_batch_selection_needed(item_row) &&\n\t\t\t\t\t!this.item_details.$component.is(\":visible\")\n\t\t\t\t)\n\t\t\t\t\tthis.edit_item_details_of(item_row);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t} finally {\n\t\t\tfrappe.dom.unfreeze();\n\t\t\treturn item_row; // eslint-disable-line no-unsafe-finally\n\t\t}\n\t}\n\n\traise_customer_selection_alert() {\n\t\tfrappe.dom.unfreeze();\n\t\tfrappe.show_alert({\n\t\t\tmessage: __(\"You must select a customer before adding an item.\"),\n\t\t\tindicator: \"orange\",\n\t\t});\n\t\tfrappe.utils.play_sound(\"error\");\n\t}\n\n\tget_item_from_frm({ name, item_code, batch_no, uom, rate }) {\n\t\tlet item_row = null;\n\t\tif (name) {\n\t\t\titem_row = this.frm.doc.items.find((i) => i.name == name);\n\t\t} else {\n\t\t\t// if item is clicked twice from item selector\n\t\t\t// then \"item_code, batch_no, uom, rate\" will help in getting the exact item\n\t\t\t// to increase the qty by one\n\t\t\tconst has_batch_no = batch_no !== \"null\" && batch_no !== null;\n\t\t\titem_row = this.frm.doc.items.find(\n\t\t\t\t(i) =>\n\t\t\t\t\ti.item_code === item_code &&\n\t\t\t\t\t(!has_batch_no || (has_batch_no && i.batch_no === batch_no)) &&\n\t\t\t\t\ti.uom === uom &&\n\t\t\t\t\ti.rate === flt(rate)\n\t\t\t);\n\t\t}\n\n\t\treturn item_row || {};\n\t}\n\n\tedit_item_details_of(item_row) {\n\t\tthis.item_details.toggle_item_details_section(item_row);\n\t}\n\n\tis_current_item_being_edited(item_row) {\n\t\treturn item_row.name == this.item_details.current_item.name;\n\t}\n\n\tupdate_cart_html(item_row, remove_item) {\n\t\tthis.cart.update_item_html(item_row, remove_item);\n\t\tthis.cart.update_totals_section(this.frm);\n\t}\n\n\tcheck_serial_batch_selection_needed(item_row) {\n\t\t// right now item details is shown for every type of item.\n\t\t// if item details is not shown for every item then this fn will be needed\n\t\tconst serialized = item_row.has_serial_no;\n\t\tconst batched = item_row.has_batch_no;\n\t\tconst no_serial_selected = !item_row.serial_no;\n\t\tconst no_batch_selected = !item_row.batch_no;\n\n\t\tif (\n\t\t\t(serialized && no_serial_selected) ||\n\t\t\t(batched && no_batch_selected) ||\n\t\t\t(serialized && batched && (no_batch_selected || no_serial_selected))\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync trigger_new_item_events(item_row) {\n\t\tawait this.frm.script_manager.trigger(\"item_code\", item_row.doctype, item_row.name);\n\t\tawait this.frm.script_manager.trigger(\"qty\", item_row.doctype, item_row.name);\n\t}\n\n\tasync check_stock_availability(item_row, qty_needed, warehouse) {\n\t\tconst resp = (await this.get_available_stock(item_row.item_code, warehouse)).message;\n\t\tconst available_qty = resp[0];\n\t\tconst is_stock_item = resp[1];\n\n\t\tfrappe.dom.unfreeze();\n\t\tconst bold_uom = item_row.stock_uom.bold();\n\t\tconst bold_item_code = item_row.item_code.bold();\n\t\tconst bold_warehouse = warehouse.bold();\n\t\tconst bold_available_qty = available_qty.toString().bold();\n\t\tif (!(available_qty > 0)) {\n\t\t\tif (is_stock_item) {\n\t\t\t\tfrappe.model.clear_doc(item_row.doctype, item_row.name);\n\t\t\t\tfrappe.throw({\n\t\t\t\t\ttitle: __(\"Not Available\"),\n\t\t\t\t\tmessage: __(\"Item Code: {0} is not available under warehouse {1}.\", [\n\t\t\t\t\t\tbold_item_code,\n\t\t\t\t\t\tbold_warehouse,\n\t\t\t\t\t]),\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (is_stock_item && available_qty < qty_needed) {\n\t\t\tfrappe.throw({\n\t\t\t\tmessage: __(\n\t\t\t\t\t\"Stock quantity not enough for Item Code: {0} under warehouse {1}. Available quantity {2} {3}.\",\n\t\t\t\t\t[bold_item_code, bold_warehouse, bold_available_qty, bold_uom]\n\t\t\t\t),\n\t\t\t\tindicator: \"orange\",\n\t\t\t});\n\t\t\tfrappe.utils.play_sound(\"error\");\n\t\t}\n\t\tfrappe.dom.freeze();\n\t}\n\n\tasync check_serial_no_availablilty(item_code, warehouse, serial_no) {\n\t\tconst method = \"erpnext.stock.doctype.serial_no.serial_no.get_pos_reserved_serial_nos\";\n\t\tconst args = { filters: { item_code, warehouse } };\n\t\tconst res = await frappe.call({ method, args });\n\n\t\tif (res.message.includes(serial_no)) {\n\t\t\tfrappe.throw({\n\t\t\t\ttitle: (\"Not Available\"),\n\t\t\t\tmessage: (\"Serial No: {0} has already been transacted into another POS Invoice.\", [\n\t\t\t\t\tserial_no.bold(),\n\t\t\t\t]),\n\t\t\t});\n\t\t}\n\t}\n\n\tget_available_stock(item_code, warehouse) {\n\t\tconst me = this;\n\t\treturn frappe.call({\n\t\t\tmethod: \"erpnext.accounts.doctype.pos_invoice.pos_invoice.get_stock_availability\",\n\t\t\targs: {\n\t\t\t\titem_code: item_code,\n\t\t\t\twarehouse: warehouse,\n\t\t\t},\n\t\t\tcallback(res) {\n\t\t\t\tif (!me.item_stock_map[item_code]) me.item_stock_map[item_code] = {};\n\t\t\t\tme.item_stock_map[item_code][warehouse] = res.message;\n\t\t\t},\n\t\t});\n\t}\n\n\n\tasync auto_add_batch(item_row) {\n\t\ttry {\n\t\t\tlet batches = await frappe.db.get_list('Batch', {\n\t\t\t\tfilters: {\n\t\t\t\t\titem: item_row.item_code,\n\t\t\t\t\texpiry_date: ['>=', frappe.datetime.now_date()]\n\t\t\t\t},\n\t\t\t\tfields: ['name', 'expiry_date'],\n\t\t\t\torder_by: 'expiry_date desc'\n\t\t\t});\n\t\n\t\t\tif (batches.length > 0) {\n\t\t\t\tlet latest_batch = batches[0];\n\t\t\t\tlet entries = [{\n\t\t\t\t\tbatch_no: latest_batch.name,\n\t\t\t\t\tqty: item_row.qty,\n\t\t\t\t\tname: \"row 1\",\n\t\t\t\t\twarehouse: this.frm.doc.set_warehouse\n\t\t\t\t}];\n\t\n\t\t\t\tconst res = await frappe.call({\n\t\t\t\t\tmethod: \"erpnext.stock.doctype.serial_and_batch_bundle.serial_and_batch_bundle.add_serial_batch_ledgers\",\n\t\t\t\t\targs: {\n\t\t\t\t\t\tentries: entries,\n\t\t\t\t\t\tchild_row: item_row,\n\t\t\t\t\t\tdoc: this.frm.doc,\n\t\t\t\t\t\twarehouse: this.frm.doc.set_warehouse\n\t\t\t\t\t},\n\t\t\t\t});\n\t\n\t\t\t\tfrappe.model.set_value(item_row.doctype, item_row.name, {\n\t\t\t\t\tserial_and_batch_bundle: res.message.name,\n\t\t\t\t\tqty: Math.abs(res.message.total_qty),\n\t\t\t\t});\n\t\t\t} \n\t\t} catch (error) {\n\t\t\tfrappe.show_alert({\n\t\t\t\tmessage: __('Batch fetch failed. Please try again.'),\n\t\t\t\tindicator: 'red',\n\t\t\t});\n\t\t\tconsole.error(error);\n\t\t}\n\t}\n\n\tasync update_item_field(value, field_or_action) {\n\n\n\n\t\tif (field_or_action === \"checkout\") {\n\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t} else if (field_or_action === \"remove\") {\n\t\t\tthis.remove_item_from_cart();\n\t\t} else {\n\t\t\tconst field_control = this.item_details[`${field_or_action}_control`];\n\t\t\tif (!field_control) return;\n\t\t\tfield_control.set_focus();\n\t\t\tvalue != \"\" && field_control.set_value(value);\n\t\t}\n\t}\n\n\t// remove_item_from_cart() {\n\t// \t//Authenticate OIC to Remove\n\t// \tconst passwordDialog = new frappe.ui.Dialog({\n\t// \t\ttitle: __('Enter OIC Password'),\n\t// \t\tfields: [\n\t// \t\t\t{\n\t// \t\t\t\tfieldname: 'password',\n\t// \t\t\t\tfieldtype: 'Password',\n\t// \t\t\t\tlabel: __('Password'),\n\t// \t\t\t\treqd: 1\n\t// \t\t\t}\n\t// \t\t],\n\t// \t\tprimary_action_label: __('Remove'),\n\t// \t\tprimary_action: (values) => {\n\t// \t\t\tlet password = values.password;\n\t// \t\t\tlet role = \"oic\";\n\t\n\t// \t\t\tfrappe.call({\n\t// \t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n\t// \t\t\t\targs: { password: password, role: role },\n\t// \t\t\t\tcallback: (r) => {\n\t// \t\t\t\t\tif (r.message) {\n\t// \t\t\t\t\t\t// Password authenticated, proceed with item removal\n\t// \t\t\t\t\t\tfrappe.dom.freeze();\n\t// \t\t\t\t\t\tconst { doctype, name, current_item } = this.item_details;\n\t\n\t// \t\t\t\t\t\tfrappe.model\n\t// \t\t\t\t\t\t\t.set_value(doctype, name, \"qty\", 0)\n\t// \t\t\t\t\t\t\t.then(() => {\n\t// \t\t\t\t\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t// \t\t\t\t\t\t\t\tthis.update_cart_html(current_item, true);\n\t// \t\t\t\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t// \t\t\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t// \t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t// \t\t\t\t\t\t\t})\n\t// \t\t\t\t\t\t\t.catch((e) => {\n\t// \t\t\t\t\t\t\t\tconsole.log(e);\n\t// \t\t\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t// \t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t// \t\t\t\t\t\t\t});\n\t// \t\t\t\t\t} else {\n\t// \t\t\t\t\t\tfrappe.show_alert({\n\t// \t\t\t\t\t\t\tmessage: __('Incorrect password or user is not an OIC'),\n\t// \t\t\t\t\t\t\tindicator: 'red'\n\t// \t\t\t\t\t\t});\n\t// \t\t\t\t\t}\n\t// \t\t\t\t}\n\t// \t\t\t});\n\t// \t\t}\n\t// \t});\n\t\n\t// \tpasswordDialog.show();\n\t// }\n\t\n\n\tremove_item_from_cart() {\n\n\t\tconst passwordDialog = new frappe.ui.Dialog({\n\t\t\ttitle: __('Enter OIC Password'),\n\t\t\tfields: [\n\t\t\t\t{\n\t\t\t\t\tfieldname: 'password',\n\t\t\t\t\tfieldtype: 'Password',\n\t\t\t\t\tlabel: __('Password'),\n\t\t\t\t\treqd: 1\n\t\t\t\t}\n\t\t\t],\n\t\t\tprimary_action_label: __('Ok'),\n\t\t\tprimary_action: (values) => {\n\n                let password = values.password;\n                frappe.call({\n\t\t\t\t\tmethod: \"custom_app.customapp.page.amesco_point_of_sale.amesco_point_of_sale.confirm_user_password\",\n                    args: { password: password },\n                    callback: (r) => {\n                        if (r.message) {\n                            if(r.message.name) {\n\t\t\t\t\t\t\t\tfrappe.dom.freeze();\n\t\t\t\t\t\t\t\tconst { doctype, name, current_item } = this.item_details;\n\t\t\n\t\t\t\t\t\t\t\tfrappe.model\n\t\t\t\t\t\t\t\t\t.set_value(doctype, name, \"qty\", 0)\n\t\t\t\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\t\t\t\tfrappe.model.clear_doc(doctype, name);\n\t\t\t\t\t\t\t\t\t\tthis.update_cart_html(current_item, true);\n\t\t\t\t\t\t\t\t\t\tthis.item_details.toggle_item_details_section(null);\n\t\t\t\t\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t.catch((e) => {\n\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\t\t\t\tfrappe.dom.unfreeze();\n\t\t\t\t\t\t\t\t\t\tpasswordDialog.hide();\n\t\t\t\t\t\t\t\t\t});\n                            }else{\n                                frappe.show_alert({\n                                    message: ('Incorrect password'),\n                                    indicator: 'red'\n                                });\n                            }\n                        } else {\n                            frappe.show_alert({\n                                message: ('Incorrect password'),\n                                indicator: 'red'\n                            });\n                        }\n                    }\n                });\n            }\n\t\t})\n\t\tpasswordDialog.show();\n\t}\n\n\n\tasync save_and_checkout() {\n\t\tif (this.frm.is_dirty()) {\n\t\t\tlet save_error = false;\n\t\t\t// await this.frm.save(null, null, null, () => (save_error = true));\n\t\t\t// only move to payment section if save is successful\n\t\t\t!save_error && this.payment.checkout();\n\t\t\t// show checkout button on error\n\t\t\tsave_error &&\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.cart.toggle_checkout_btn(true);\n\t\t\t\t}, 300); // wait for save to finish\n\t\t} else {\n\t\t\tthis.payment.checkout();\n\t\t}\n\t}\n\n};\n"],
  "mappings": "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",
  "names": ["require_onscan", "__commonJSMin", "exports", "module", "global", "factory", "onScan", "oDomElement", "oOptions", "oDefaults", "sScanned", "iQty", "oDebug", "sChar", "oEvent", "iKeyCode", "sPasted", "iCode", "sDecoded", "mStringOrArray", "mKey", "oEventProps", "oVars", "ignoreSelectors", "oFocused", "i", "sScanCode", "oScannerData", "iSingleScanQty", "iFirstCharTime", "iLastCharTime", "oScanError", "oExtended", "prop", "e", "bScanFinished", "character", "sPasteString", "import_onscan", "frm", "wrapper", "events", "pos_profile", "settings", "css", "style", "selectedWarehouse", "res", "message", "start", "page_length", "search_term", "doc", "price_list", "item_group", "selected_warehouse", "items", "item", "item_html", "me", "item_code", "item_image", "serial_no", "batch_no", "barcode", "actual_qty", "uom", "price_list_rate", "description", "latest_expiry_date", "batch_number", "custom_is_vatable", "custom_generic_name", "precision", "indicator_color", "qty_to_display", "no_vat", "item_description", "$img", "item_abbr", "value", "onScan", "oEvent", "iCode", "sDecoded", "sScancode", "selectedUOM", "$item", "rate", "qty", "response", "uomPrices", "uomOptions", "defaultUOM", "defaultRate", "dialog", "warehouses", "warehouse_data_promises", "warehouse", "resolve", "reject", "error", "warehouses_with_qty", "renderWarehousesTable", "data", "tableHtml", "row", "quantity", "totalAmount", "conversion_factor", "itemCode", "batchNo", "serialNo", "$quantityField", "e", "key", "isCtrlPressed", "ctrl_label", "selector_is_visible", "dialog_is_open", "index", "highlightedItem", "minimize", "show", "wrapper", "events", "settings", "me", "e", "show", "$cart_item", "item_row_name", "password", "r", "can_edit_discount", "passwordDialog", "values", "role", "frm", "event", "keysToPrevent", "key", "row", "btn", "shortcut_key", "fieldname", "shortcut_label", "ctrl_label", "item_cart_visible", "checkout_btn_invisible", "item", "item_is_highlighted", "allowed_customer_group", "filters", "allowed_doctor_group", "customer", "resolve", "message", "loyalty_program", "loyalty_points", "conversion_factor", "__spreadProps", "__spreadValues", "doctor", "discount", "email_id", "mobile_no", "image", "customer_name", "customer_group", "get_customer_description", "first_name", "last_name", "prc_number", "get_doctor_description", "grand_total", "value", "currency", "items", "total_item_qty", "taxes", "taxes_html", "t", "name", "item_selector", "remove_item", "$item", "cartItems", "cartItem", "item_row", "existingItemIndex", "no_of_cart_items", "currentCustomer", "customCustomer2Value", "item_data", "$item_to_update", "tax_rate", "no_vat", "get_item_image_html", "get_description_html", "getVatType", "get_rate_discount_html", "set_dynamic_rate_header_width", "rate_cols", "max_width", "elm", "error", "item_name", "$items", "currentIndex", "nextIndex", "$img", "item_abbr", "selector", "show_checkout", "toggle", "$no_item_element", "$btn", "current_action", "action_is_field_edit", "action_is_allowed", "action_is_pressed_twice", "first_click_event", "field_to_edit_changed", "label", "curr_action", "curr_action_is_highlighted", "curr_action_is_action", "$customer_form", "dfs", "df", "handle_customer_field_change", "current_value", "current_customer", "res", "transaction_container", "elapsed_time", "invoice", "posting_datetime", "indicator_color", "wrapper", "events", "settings", "item", "current_item_changed", "hide_item_details", "item_row", "serialized", "batched", "no_bundle_selected", "item_name", "description", "image", "price_list_rate", "get_description_html", "$img", "item_abbr", "fields_to_display", "fieldname", "idx", "field_meta", "df", "me", "__spreadProps", "__spreadValues", "selected_uom", "default_uom", "conversion_factor", "amount", "doc", "passwordDialog", "values", "password", "r", "current_discount_log", "discount_log", "updated_discount_log", "fields", "label", "frm", "available_qty", "is_stock_item", "bold_item_code", "bold_warehouse", "value", "field_control", "selected_serial_nos", "s", "batch_serial_map", "acc", "batch_no", "batch_serial_nos", "serial_nos_belongs_to_other_batch", "show", "wrapper", "events", "cols", "keys", "css_classes", "fieldnames_map", "fieldnames", "get_keys", "row", "i", "a2", "number", "j", "class_to_append", "fieldname", "me", "$btn", "events", "wrapper", "doc", "fields", "frm", "df", "df_events", "__spreadValues", "me", "$btn", "button_value", "highlight_numpad_btn", "hideAllFields", "focusAndHighlightAmountField", "mode_clicked", "$amountField", "e", "scrollLeft", "mode", "_a", "contact", "request_button", "value", "paid_amount", "items", "payments", "grand_total", "message", "total_paid_amount", "sum", "p", "rounded_total_paid", "rounded_grand_total", "cash_payment_present", "validate_payment_methods", "has_error", "payment_method", "cash_missing_fields", "validate_fields", "show_validation_warning", "gc_missing_fields", "missing_fields", "debit_missing_fields", "cheque_missing_fields", "cards_missing_fields", "qr_missing_fields", "gcash_maya_missing_fields", "gov_missing_fields", "required_fields", "payment_entry", "field", "dialog", "is_cash_shortcuts_invisible", "formatted_currency", "cdt", "cdn", "default_mop", "data", "response", "amount", "success", "failure_message", "title", "remaining_amount", "shift_label", "payment_is_visible", "active_mode", "mode_of_payments", "m", "mode_index", "next_mode_index", "next_mode_to_be_clicked", "currency", "customer_group", "allowed_payment_modes", "i", "payment_type", "paymentModeHtml", "save_button", "amount_value", "discard_button", "button_container", "validateLastFourDigits", "existing_custom_bank_name", "bank_name_control", "selected_customer", "existing_custom_card_name", "name_on_card_control", "r", "result", "error", "existing_custom_card_type", "card_type_control", "existing_custom_card_number", "card_number_control", "existing_custom_card_expiration_date", "expiry_date_control", "existing_custom_approval_code", "custom_approval_code_control", "bank_name", "card_name", "card_type", "card_number", "card_expiry_date", "approval_code", "control", "existing_custom_phone_number", "phone_number_control", "existing_custom_epayment_reference_number", "epayment_reference_number_controller", "phone_number", "reference_no", "existing_custom_check_name", "check_name_control", "existing_custom_check_number", "check_number_control", "existing_custom_check_date", "check_date_control", "check_name", "check_number", "check_date", "check_form_2306", "latest_form_2306_value", "check_form_2307", "latest_form_2307_value", "existing_custom_payment_type", "custom_payment_type", "existing_custom_bank_type", "custom_bank_type", "existing_custom_qr_reference_number", "custom_qr_reference_number", "bank_type", "qr_reference_number", "existing_custom_customer", "custom_customer", "existing_charge_invoice_number", "charge_invoice_number", "existing_custom_po_number", "custom_po_number", "existing_custom_representative", "custom_representative", "existing_custom_id_number", "custom_id_number", "existing_custom_approved_by", "custom_approved_by", "customer", "charge_invoice_no", "po_number", "representative", "id_number", "approved_by", "code_input", "button", "code_value", "gift_cert", "current_amount", "scannedData", "voucher_code", "user_id", "email", "amesco_points", "details_dialog", "shortcuts", "shortcuts_html", "s", "steps", "digits", "x", "get_nearest", "nearest_x", "finalArr", "b", "loyalty_program", "loyalty_points", "conversion_factor", "description", "read_only", "max_redeemable_amount", "margin", "redeem_loyalty_points", "remaining", "change", "label", "show", "wrapper", "events", "e", "search_term", "me", "invoice_name", "event", "$items", "currentIndex", "nextIndex", "status", "pos_profile", "source_warehouse", "response", "invoice", "invoice_html", "posting_datetime", "show", "wrapper", "events", "email_dialog", "print_dialog", "doc", "status", "indicator_color", "sold_by", "item_data", "get_rate_discount_html", "rate_html", "amount_html", "qty_html", "payment", "frm", "ctrl_label", "recipients", "content", "print_format", "r", "map", "m", "b", "class_name", "btn", "show", "after_submission", "condition_btns_map", "message", "upper_section_dom", "item", "item_dom", "rate_cols", "max_width", "elm", "p", "payment_dom", "net_total_dom", "vatable_sale_dom", "vat_exempt_dom", "zero_rated_dom", "vat_amount_dom", "discount_dom", "grand_total_dom", "wrapper", "r", "data", "saved_pos_profile", "me", "table_fields", "dialog", "d", "fetch_pos_payment_methods", "pos_profile", "payments", "pay", "mode_of_payment", "opening_amount", "get_next_shift", "res", "max_shift", "pos_profile_query", "company", "balance_details", "custom_shift", "method", "error", "message", "profile", "group", "buttons", "btn", "title", "onSuccess", "passwordDialog", "values", "password", "voucher", "doc", "manualInputDialog", "scannedData", "user_id", "userName", "email", "points", "userDetailsDialog", "user", "barcode", "show", "args", "posWarehouse", "selectedWarehouse", "item", "item_row", "value", "action", "details", "minimize", "field", "cart_item", "fieldname", "selector", "batch_serial_map", "batch", "item_to_clone", "i", "item_to_clone2", "new_row", "__spreadValues", "row", "item_code", "warehouse", "payment_amount", "sum", "payment", "insufficientPaymentDialog", "errorOccurred", "change_amount", "changeDialog", "e", "name", "isAuthorized", "role", "doctype", "resolve", "_frm", "page", "frm", "item_row_exists", "from_selector", "qty_needed", "batch_no", "serial_no", "rate", "uom", "new_item", "has_batch_no", "remove_item", "serialized", "batched", "no_serial_selected", "no_batch_selected", "resp", "available_qty", "is_stock_item", "bold_uom", "bold_item_code", "bold_warehouse", "bold_available_qty", "batches", "entries", "field_or_action", "field_control", "current_item", "save_error"]
}
